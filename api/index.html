
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../old_good_GUI-Profiling-Logger/">
      
      
        <link rel="next" href="../uml/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>API Reference - GOLIAT Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GOLIAT Documentation" class="md-header__button md-logo" aria-label="GOLIAT Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GOLIAT Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../architecture_overview/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../COLORING_RULES/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../uml/" class="md-tabs__link">
        
  
  
    
  
  UML Diagram

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GOLIAT Documentation" class="md-nav__button md-logo" aria-label="GOLIAT Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GOLIAT Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../COLORING_RULES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coloring rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../old_good_GUI-Profiling-Logger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Legacy GUI/Profiling/Logger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src" class="md-nav__link">
    <span class="md-ellipsis">
      src
    </span>
  </a>
  
    <nav class="md-nav" aria-label="src">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis" class="md-nav__link">
    <span class="md-ellipsis">
      analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis.analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis.analyzer.Analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis.analyzer.Analyzer.run_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      run_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.plotter" class="md-nav__link">
    <span class="md-ellipsis">
      plotter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plotter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis.plotter.Plotter" class="md-nav__link">
    <span class="md-ellipsis">
      Plotter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plotter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis.plotter.Plotter.plot_peak_sar_line" class="md-nav__link">
    <span class="md-ellipsis">
      plot_peak_sar_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.plotter.Plotter.plot_far_field_distribution_boxplot" class="md-nav__link">
    <span class="md-ellipsis">
      plot_far_field_distribution_boxplot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.plotter.Plotter.plot_sar_heatmap" class="md-nav__link">
    <span class="md-ellipsis">
      plot_sar_heatmap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.plotter.Plotter.plot_peak_sar_heatmap" class="md-nav__link">
    <span class="md-ellipsis">
      plot_peak_sar_heatmap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.strategies" class="md-nav__link">
    <span class="md-ellipsis">
      strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.analysis.strategies.BaseAnalysisStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      BaseAnalysisStrategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.strategies.NearFieldAnalysisStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      NearFieldAnalysisStrategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.analysis.strategies.FarFieldAnalysisStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      FarFieldAnalysisStrategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.antenna" class="md-nav__link">
    <span class="md-ellipsis">
      antenna
    </span>
  </a>
  
    <nav class="md-nav" aria-label="antenna">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.antenna.Antenna" class="md-nav__link">
    <span class="md-ellipsis">
      Antenna
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Antenna">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.antenna.Antenna.get_config_for_frequency" class="md-nav__link">
    <span class="md-ellipsis">
      get_config_for_frequency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.antenna.Antenna.get_model_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.antenna.Antenna.get_source_entity_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_source_entity_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.antenna.Antenna.get_centered_antenna_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_centered_antenna_path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.colors" class="md-nav__link">
    <span class="md-ellipsis">
      colors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="colors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.colors.get_color" class="md-nav__link">
    <span class="md-ellipsis">
      get_color
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.config.Config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_setting" class="md-nav__link">
    <span class="md-ellipsis">
      get_setting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_simulation_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_simulation_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_antenna_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_antenna_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_gridding_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_gridding_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_phantom_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_phantom_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_phantom_placements" class="md-nav__link">
    <span class="md-ellipsis">
      get_phantom_placements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_material_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_material_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_solver_settings" class="md-nav__link">
    <span class="md-ellipsis">
      get_solver_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_antenna_component_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_antenna_component_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_manual_isolve" class="md-nav__link">
    <span class="md-ellipsis">
      get_manual_isolve
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_freespace_expansion" class="md-nav__link">
    <span class="md-ellipsis">
      get_freespace_expansion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_excitation_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_excitation_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_bandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      get_bandwidth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_placement_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      get_placement_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_profiling_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_profiling_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_line_profiling_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_line_profiling_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_server" class="md-nav__link">
    <span class="md-ellipsis">
      get_server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_osparc_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_osparc_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.Config.get_only_write_input_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_only_write_input_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.config.deep_merge" class="md-nav__link">
    <span class="md-ellipsis">
      deep_merge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_extractor" class="md-nav__link">
    <span class="md-ellipsis">
      data_extractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data_extractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_extractor.get_parameter_from_json" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameter_from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_extractor.get_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager" class="md-nav__link">
    <span class="md-ellipsis">
      gui_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gui_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI" class="md-nav__link">
    <span class="md-ellipsis">
      QueueGUI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QueueGUI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.update_overall_progress" class="md-nav__link">
    <span class="md-ellipsis">
      update_overall_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.update_stage_progress" class="md-nav__link">
    <span class="md-ellipsis">
      update_stage_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.start_stage_animation" class="md-nav__link">
    <span class="md-ellipsis">
      start_stage_animation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.end_stage_animation" class="md-nav__link">
    <span class="md-ellipsis">
      end_stage_animation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.update_profiler" class="md-nav__link">
    <span class="md-ellipsis">
      update_profiler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.process_events" class="md-nav__link">
    <span class="md-ellipsis">
      process_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.QueueGUI.is_stopped" class="md-nav__link">
    <span class="md-ellipsis">
      is_stopped
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.ProgressGUI" class="md-nav__link">
    <span class="md-ellipsis">
      ProgressGUI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProgressGUI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.gui_manager.ProgressGUI.process_queue" class="md-nav__link">
    <span class="md-ellipsis">
      process_queue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.logging_manager" class="md-nav__link">
    <span class="md-ellipsis">
      logging_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logging_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.logging_manager.ColorFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      ColorFormatter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.logging_manager.LoggingMixin" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingMixin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.logging_manager.setup_loggers" class="md-nav__link">
    <span class="md-ellipsis">
      setup_loggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.logging_manager.shutdown_loggers" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown_loggers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch" class="md-nav__link">
    <span class="md-ellipsis">
      osparc_batch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="osparc_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui" class="md-nav__link">
    <span class="md-ellipsis">
      gui
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gui">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI" class="md-nav__link">
    <span class="md-ellipsis">
      BatchGUI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BatchGUI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.init_ui" class="md-nav__link">
    <span class="md-ellipsis">
      init_ui
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.force_stop_run" class="md-nav__link">
    <span class="md-ellipsis">
      force_stop_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.stop_and_cancel_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      stop_and_cancel_jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.hide_to_tray" class="md-nav__link">
    <span class="md-ellipsis">
      hide_to_tray
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.show_from_tray" class="md-nav__link">
    <span class="md-ellipsis">
      show_from_tray
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.tray_icon_activated" class="md-nav__link">
    <span class="md-ellipsis">
      tray_icon_activated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.gui.BatchGUI.closeEvent" class="md-nav__link">
    <span class="md-ellipsis">
      closeEvent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner" class="md-nav__link">
    <span class="md-ellipsis">
      runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.setup_console_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_console_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.setup_job_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_job_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.find_input_files" class="md-nav__link">
    <span class="md-ellipsis">
      find_input_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.get_osparc_client_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_osparc_client_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.submit_job" class="md-nav__link">
    <span class="md-ellipsis">
      submit_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.download_and_process_results" class="md-nav__link">
    <span class="md-ellipsis">
      download_and_process_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.get_progress_report" class="md-nav__link">
    <span class="md-ellipsis">
      get_progress_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.main_process_logic" class="md-nav__link">
    <span class="md-ellipsis">
      main_process_logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.clear_log_directory" class="md-nav__link">
    <span class="md-ellipsis">
      clear_log_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.clear_temp_download_directory" class="md-nav__link">
    <span class="md-ellipsis">
      clear_temp_download_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.runner.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.worker" class="md-nav__link">
    <span class="md-ellipsis">
      worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.worker.Worker" class="md-nav__link">
    <span class="md-ellipsis">
      Worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.worker.Worker.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.worker.Worker.request_progress_report" class="md-nav__link">
    <span class="md-ellipsis">
      request_progress_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.worker.Worker.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.osparc_batch.worker.Worker.cancel_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      cancel_jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.profiler" class="md-nav__link">
    <span class="md-ellipsis">
      profiler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="profiler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.profiler.Profiler" class="md-nav__link">
    <span class="md-ellipsis">
      Profiler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Profiler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.profiler.Profiler.get_weighted_progress" class="md-nav__link">
    <span class="md-ellipsis">
      get_weighted_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.profiler.Profiler.get_subtask_estimate" class="md-nav__link">
    <span class="md-ellipsis">
      get_subtask_estimate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.profiler.Profiler.get_time_remaining" class="md-nav__link">
    <span class="md-ellipsis">
      get_time_remaining
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.profiler.Profiler.update_and_save_estimates" class="md-nav__link">
    <span class="md-ellipsis">
      update_and_save_estimates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.profiler.Profiler.save_estimates" class="md-nav__link">
    <span class="md-ellipsis">
      save_estimates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager" class="md-nav__link">
    <span class="md-ellipsis">
      project_manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="project_manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectCorruptionError" class="md-nav__link">
    <span class="md-ellipsis">
      ProjectCorruptionError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager" class="md-nav__link">
    <span class="md-ellipsis">
      ProjectManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProjectManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.create_or_open_project" class="md-nav__link">
    <span class="md-ellipsis">
      create_or_open_project
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.create_new" class="md-nav__link">
    <span class="md-ellipsis">
      create_new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.project_manager.ProjectManager.reload_project" class="md-nav__link">
    <span class="md-ellipsis">
      reload_project
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.results_extractor" class="md-nav__link">
    <span class="md-ellipsis">
      results_extractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="results_extractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.results_extractor.ResultsExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      ResultsExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResultsExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.results_extractor.ResultsExtractor.extract" class="md-nav__link">
    <span class="md-ellipsis">
      extract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups" class="md-nav__link">
    <span class="md-ellipsis">
      setups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.base_setup" class="md-nav__link">
    <span class="md-ellipsis">
      base_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="base_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.base_setup.BaseSetup" class="md-nav__link">
    <span class="md-ellipsis">
      BaseSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.base_setup.BaseSetup.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.base_setup.BaseSetup.run_full_setup" class="md-nav__link">
    <span class="md-ellipsis">
      run_full_setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.boundary_setup" class="md-nav__link">
    <span class="md-ellipsis">
      boundary_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boundary_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.boundary_setup.BoundarySetup" class="md-nav__link">
    <span class="md-ellipsis">
      BoundarySetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BoundarySetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.boundary_setup.BoundarySetup.setup_boundary_conditions" class="md-nav__link">
    <span class="md-ellipsis">
      setup_boundary_conditions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.far_field_setup" class="md-nav__link">
    <span class="md-ellipsis">
      far_field_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="far_field_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.far_field_setup.FarFieldSetup" class="md-nav__link">
    <span class="md-ellipsis">
      FarFieldSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FarFieldSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.far_field_setup.FarFieldSetup.run_full_setup" class="md-nav__link">
    <span class="md-ellipsis">
      run_full_setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.gridding_setup" class="md-nav__link">
    <span class="md-ellipsis">
      gridding_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gridding_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.gridding_setup.GriddingSetup" class="md-nav__link">
    <span class="md-ellipsis">
      GriddingSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GriddingSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.gridding_setup.GriddingSetup.setup_gridding" class="md-nav__link">
    <span class="md-ellipsis">
      setup_gridding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.material_setup" class="md-nav__link">
    <span class="md-ellipsis">
      material_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="material_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.material_setup.MaterialSetup" class="md-nav__link">
    <span class="md-ellipsis">
      MaterialSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MaterialSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.material_setup.MaterialSetup.assign_materials" class="md-nav__link">
    <span class="md-ellipsis">
      assign_materials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.near_field_setup" class="md-nav__link">
    <span class="md-ellipsis">
      near_field_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="near_field_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.near_field_setup.NearFieldSetup" class="md-nav__link">
    <span class="md-ellipsis">
      NearFieldSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NearFieldSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.near_field_setup.NearFieldSetup.run_full_setup" class="md-nav__link">
    <span class="md-ellipsis">
      run_full_setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.phantom_setup" class="md-nav__link">
    <span class="md-ellipsis">
      phantom_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="phantom_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.phantom_setup.PhantomSetup" class="md-nav__link">
    <span class="md-ellipsis">
      PhantomSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PhantomSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.phantom_setup.PhantomSetup.ensure_phantom_is_loaded" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_phantom_is_loaded
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.placement_setup" class="md-nav__link">
    <span class="md-ellipsis">
      placement_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="placement_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.placement_setup.PlacementSetup" class="md-nav__link">
    <span class="md-ellipsis">
      PlacementSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlacementSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.placement_setup.PlacementSetup.place_antenna" class="md-nav__link">
    <span class="md-ellipsis">
      place_antenna
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.setups.source_setup" class="md-nav__link">
    <span class="md-ellipsis">
      source_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="source_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.source_setup.SourceSetup" class="md-nav__link">
    <span class="md-ellipsis">
      SourceSetup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceSetup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.setups.source_setup.SourceSetup.setup_source_and_sensors" class="md-nav__link">
    <span class="md-ellipsis">
      setup_source_and_sensors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.simulation_runner" class="md-nav__link">
    <span class="md-ellipsis">
      simulation_runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="simulation_runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.simulation_runner.SimulationRunner" class="md-nav__link">
    <span class="md-ellipsis">
      SimulationRunner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimulationRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.simulation_runner.SimulationRunner.run_all" class="md-nav__link">
    <span class="md-ellipsis">
      run_all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.simulation_runner.SimulationRunner.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.studies" class="md-nav__link">
    <span class="md-ellipsis">
      studies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="studies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.studies.base_study" class="md-nav__link">
    <span class="md-ellipsis">
      base_study
    </span>
  </a>
  
    <nav class="md-nav" aria-label="base_study">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.studies.base_study.BaseStudy" class="md-nav__link">
    <span class="md-ellipsis">
      BaseStudy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseStudy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.studies.base_study.BaseStudy.subtask" class="md-nav__link">
    <span class="md-ellipsis">
      subtask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.studies.base_study.BaseStudy.start_stage_animation" class="md-nav__link">
    <span class="md-ellipsis">
      start_stage_animation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.studies.base_study.BaseStudy.end_stage_animation" class="md-nav__link">
    <span class="md-ellipsis">
      end_stage_animation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.studies.base_study.BaseStudy.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.studies.far_field_study" class="md-nav__link">
    <span class="md-ellipsis">
      far_field_study
    </span>
  </a>
  
    <nav class="md-nav" aria-label="far_field_study">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.studies.far_field_study.FarFieldStudy" class="md-nav__link">
    <span class="md-ellipsis">
      FarFieldStudy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.studies.near_field_study" class="md-nav__link">
    <span class="md-ellipsis">
      near_field_study
    </span>
  </a>
  
    <nav class="md-nav" aria-label="near_field_study">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.studies.near_field_study.NearFieldStudy" class="md-nav__link">
    <span class="md-ellipsis">
      NearFieldStudy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.utils.StudyCancelledError" class="md-nav__link">
    <span class="md-ellipsis">
      StudyCancelledError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler" class="md-nav__link">
    <span class="md-ellipsis">
      Profiler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Profiler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.start_study" class="md-nav__link">
    <span class="md-ellipsis">
      start_study
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.start_run" class="md-nav__link">
    <span class="md-ellipsis">
      start_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.end_run" class="md-nav__link">
    <span class="md-ellipsis">
      end_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.get_average_run_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_run_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.get_time_remaining" class="md-nav__link">
    <span class="md-ellipsis">
      get_time_remaining
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.save_estimates" class="md-nav__link">
    <span class="md-ellipsis">
      save_estimates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.Profiler.subtask" class="md-nav__link">
    <span class="md-ellipsis">
      subtask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.format_time" class="md-nav__link">
    <span class="md-ellipsis">
      format_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.non_blocking_sleep" class="md-nav__link">
    <span class="md-ellipsis">
      non_blocking_sleep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.profile" class="md-nav__link">
    <span class="md-ellipsis">
      profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.profile_subtask" class="md-nav__link">
    <span class="md-ellipsis">
      profile_subtask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.ensure_s4l_running" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_s4l_running
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.open_project" class="md-nav__link">
    <span class="md-ellipsis">
      open_project
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.delete_project_file" class="md-nav__link">
    <span class="md-ellipsis">
      delete_project_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.utils.suppress_stdout_stderr" class="md-nav__link">
    <span class="md-ellipsis">
      suppress_stdout_stderr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../uml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UML Diagram
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>
<p>This page provides comprehensive API documentation for all modules in the GOLIAT simulation framework.</p>


<div class="doc doc-object doc-module">



<h2 id="src" class="doc doc-heading">
            <code>src</code>


<a href="#src" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h3 id="src.analysis" class="doc doc-heading">
            <code>analysis</code>


<a href="#src.analysis" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="src.analysis.analyzer" class="doc doc-heading">
            <code>analyzer</code>


<a href="#src.analysis.analyzer" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.analysis.analyzer.Analyzer" class="doc doc-heading">
            <code>Analyzer</code>


<a href="#src.analysis.analyzer.Analyzer" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">


        <p>Analyzes the results of simulation studies using a strategy pattern.</p>








              <details class="quote">
                <summary>Source code in <code>src\analysis\analyzer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Analyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes the results of simulation studies using a strategy pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">BaseAnalysisStrategy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">base_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_base_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">get_results_base_dir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span> <span class="o">=</span> <span class="n">Plotter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">get_plots_dir</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_organ_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tissue_group_definitions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;eyes_group&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;eye&quot;</span><span class="p">,</span> <span class="s2">&quot;cornea&quot;</span><span class="p">,</span> <span class="s2">&quot;sclera&quot;</span><span class="p">,</span> <span class="s2">&quot;lens&quot;</span><span class="p">,</span> <span class="s2">&quot;vitreous&quot;</span><span class="p">],</span>
            <span class="s2">&quot;skin_group&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;skin&quot;</span><span class="p">],</span>
            <span class="s2">&quot;brain_group&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">,</span> <span class="s2">&quot;commissura&quot;</span><span class="p">,</span> <span class="s2">&quot;midbrain&quot;</span><span class="p">,</span> <span class="s2">&quot;pineal&quot;</span><span class="p">,</span> <span class="s2">&quot;hypophysis&quot;</span><span class="p">,</span> <span class="s2">&quot;medulla&quot;</span><span class="p">,</span> <span class="s2">&quot;pons&quot;</span><span class="p">,</span> <span class="s2">&quot;thalamus&quot;</span><span class="p">,</span> <span class="s2">&quot;hippocampus&quot;</span><span class="p">,</span> <span class="s2">&quot;cerebellum&quot;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">run_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main method to run the full analysis pipeline using the selected strategy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Results Analysis for Phantom: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">load_and_process_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- No results found to analyze. ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
            <span class="k">return</span>

        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">)</span>
        <span class="n">all_organ_results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_organ_results</span><span class="p">)</span>

        <span class="n">results_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_units_and_cache</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_reports</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Analysis Finished ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_process_single_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">pos_name</span><span class="p">,</span> <span class="n">orient_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;FarFieldAnalysisStrategy&#39;</span><span class="p">:</span>
            <span class="c1"># For far-field, pos_name is the full placement directory name</span>
            <span class="n">detailed_placement_name</span> <span class="o">=</span> <span class="n">pos_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">detailed_placement_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">pos_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">orient_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_base_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="n">detailed_placement_name</span><span class="p">)</span>
        <span class="n">pickle_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s2">&quot;sar_stats_all_tissues.pkl&quot;</span><span class="p">)</span>
        <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s2">&quot;sar_results.json&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">json_path</span><span class="p">)):</span>
            <span class="k">return</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Processing: </span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz, </span><span class="si">{</span><span class="n">detailed_placement_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;progress&#39;</span><span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">sar_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="n">simulated_power_w</span> <span class="o">=</span> <span class="n">sar_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_power_W&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
            <span class="n">normalization_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">get_normalization_factor</span><span class="p">(</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">simulated_power_w</span><span class="p">)</span>
            <span class="n">result_entry</span><span class="p">,</span> <span class="n">organ_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span>
                <span class="n">pickle_data</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">detailed_placement_name</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span>
                <span class="n">simulated_power_w</span><span class="p">,</span> <span class="n">normalization_factor</span>
            <span class="p">)</span>
            <span class="n">result_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">apply_bug_fixes</span><span class="p">(</span><span class="n">result_entry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_entry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_organ_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">organ_entries</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - ERROR: Could not process data for </span><span class="si">{</span><span class="n">detailed_placement_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_convert_units_and_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">organ_results_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts SAR units to mW/kg and caches both summary and organ-level results.&quot;&quot;&quot;</span>
        <span class="n">sar_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;SAR&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
        <span class="n">results_df</span><span class="p">[</span><span class="n">sar_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">sar_columns</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="n">output_pickle_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_base_dir</span><span class="p">,</span> <span class="s2">&quot;aggregated_results.pkl&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_pickle_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">cached_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;summary_results&#39;</span><span class="p">:</span> <span class="n">results_df</span><span class="p">,</span>
            <span class="s1">&#39;organ_results&#39;</span><span class="p">:</span> <span class="n">organ_results_df</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_pickle_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cached_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Aggregated summary and organ results (in mW/kg) cached to: </span><span class="si">{</span><span class="n">output_pickle_path</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">results_df</span>

    <span class="k">def</span> <span class="nf">_export_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">):</span>
        <span class="n">results_for_export</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;input_power_w&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Full Normalized Results per Simulation (in mW/kg) ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">results_for_export</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;placement&#39;</span><span class="p">]))</span>
        <span class="n">summary_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">calculate_summary_stats</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Summary Statistics (Mean) of Normalized SAR per Scenario and Frequency (in mW/kg) ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">summary_stats</span><span class="p">)</span>
        <span class="n">detailed_csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_base_dir</span><span class="p">,</span> <span class="s1">&#39;normalized_results_detailed.csv&#39;</span><span class="p">)</span>
        <span class="n">summary_csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_base_dir</span><span class="p">,</span> <span class="s1">&#39;normalized_results_summary.csv&#39;</span><span class="p">)</span>
        <span class="n">organ_csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_base_dir</span><span class="p">,</span> <span class="s1">&#39;normalized_results_organs.csv&#39;</span><span class="p">)</span>
        <span class="n">results_for_export</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">detailed_csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">summary_stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">summary_csv_path</span><span class="p">)</span>
        <span class="n">all_organ_results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">organ_csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Detailed results saved to: </span><span class="si">{</span><span class="n">detailed_csv_path</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Summary statistics saved to: </span><span class="si">{</span><span class="n">summary_csv_path</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Organ-level results saved to: </span><span class="si">{</span><span class="n">organ_csv_path</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates all plots using the Plotter class.&quot;&quot;&quot;</span>
        <span class="c1"># This method is now delegated to the strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.analysis.analyzer.Analyzer.run_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_analysis</span><span class="p">()</span></code>

<a href="#src.analysis.analyzer.Analyzer.run_analysis" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Main method to run the full analysis pipeline using the selected strategy.</p>


            <details class="quote">
              <summary>Source code in <code>src\analysis\analyzer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main method to run the full analysis pipeline using the selected strategy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Results Analysis for Phantom: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">load_and_process_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- No results found to analyze. ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
        <span class="k">return</span>

    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">)</span>
    <span class="n">all_organ_results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_organ_results</span><span class="p">)</span>

    <span class="n">results_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_units_and_cache</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_reports</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Analysis Finished ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.analysis.plotter" class="doc doc-heading">
            <code>plotter</code>


<a href="#src.analysis.plotter" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.analysis.plotter.Plotter" class="doc doc-heading">
            <code>Plotter</code>


<a href="#src.analysis.plotter.Plotter" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>src\analysis\plotter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Plotter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plots_dir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span> <span class="o">=</span> <span class="n">plots_dir</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Plots will be saved to &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="si">}</span><span class="s2">&#39; directory. ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;info&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">plot_average_sar_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">avg_results</span><span class="p">,</span> <span class="n">progress_info</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">avg_results</span><span class="p">[[</span><span class="s1">&#39;SAR_head&#39;</span><span class="p">,</span> <span class="s1">&#39;SAR_trunk&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">progress_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> MHz</span><span class="se">\n</span><span class="s2">(</span><span class="si">{</span><span class="n">progress_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0/0&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">avg_results</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">progress_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average Normalized SAR for Scenario: </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz) and Completion Progress&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized SAR (mW/kg)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Head SAR&#39;</span><span class="p">,</span> <span class="s1">&#39;Trunk SAR&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;average_sar_bar_</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_whole_body_sar_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avg_results</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">avg_results</span><span class="p">[</span><span class="s1">&#39;SAR_whole_body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">avg_results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Whole-Body SAR&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Whole-Body SAR (mW/kg)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s1">&#39;average_whole_body_sar_bar.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_peak_sar_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_stats</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the peak SAR across frequencies for far-field.&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;peak_sar&#39;</span> <span class="ow">in</span> <span class="n">summary_stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">summary_stats</span><span class="p">[</span><span class="s1">&#39;peak_sar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Peak SAR (10g) Across All Tissues&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Peak SAR (mW/kg)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">summary_stats</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;No Peak SAR data found&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Peak SAR (10g) Across All Tissues&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s1">&#39;line_peak_sar_summary.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_pssar_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">avg_results</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">pssar_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">avg_results</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;psSAR10g&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">pssar_columns</span><span class="p">:</span>
            <span class="n">avg_results</span><span class="p">[</span><span class="n">pssar_columns</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average Normalized psSAR10g for Scenario: </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized psSAR10g (mW/kg)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">LEGEND_LABELS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">pssar_columns</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">avg_results</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;No psSAR10g data found&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average Normalized psSAR10g for Scenario: </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;pssar10g_line_</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_sar_distribution_boxplots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">scenario_results_df</span><span class="p">):</span>
        <span class="n">pssar_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">scenario_results_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;psSAR10g&#39;</span><span class="p">)]</span>
        <span class="n">sar_metrics_for_boxplot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SAR_head&#39;</span><span class="p">,</span> <span class="s1">&#39;SAR_trunk&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pssar_columns</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">sar_metrics_for_boxplot</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scenario_results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">scenario_results_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Distribution of Normalized </span><span class="si">{</span><span class="n">METRIC_LABELS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">)</span><span class="si">}</span><span class="s1"> for Scenario: </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized SAR (mW/kg)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;boxplot_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_far_field_distribution_boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;SAR_whole_body&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a boxplot for the distribution of a given metric in far-field results.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: No data for metric &#39;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&#39; to generate boxplot.&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
            <span class="k">return</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">results_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Distribution of Normalized </span><span class="si">{</span><span class="n">METRIC_LABELS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized SAR (mW/kg)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;boxplot_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">_distribution.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_plot_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to plot a single heatmap.&quot;&quot;&quot;</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                    <span class="n">cbar</span><span class="o">=</span><span class="n">cbar</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax</span> <span class="k">if</span> <span class="n">cbar</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_sar_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organ_df</span><span class="p">,</span> <span class="n">group_df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates the combined heatmap for Min, Avg, and Max SAR.&quot;&quot;&quot;</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sar&#39;</span><span class="p">])</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">organ_pivot</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">mean_organ_sar</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_organ_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">metric_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sar&#39;</span><span class="p">]</span>
        <span class="n">sorted_columns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">organ_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">metric_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="p">[</span><span class="n">sorted_columns</span><span class="p">]</span>

        <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;avg_sar&#39;</span><span class="p">)</span>
        <span class="n">mean_group_sar</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_group_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_pivot</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                 <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">ax_organ</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax_group</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">ax_organ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_organ</span><span class="p">,</span> <span class="n">organ_pivot</span><span class="p">,</span> <span class="s1">&#39;Min, Avg, and Max SAR (mW/kg) per Tissue&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_labels</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)</span>

        <span class="n">group_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eyes_group&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_group&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;brain_group&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
        <span class="n">tissue_to_group</span> <span class="o">=</span> <span class="p">{</span><span class="n">tissue</span><span class="p">:</span> <span class="n">group</span> <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">tissues</span> <span class="ow">in</span> <span class="n">tissue_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">tissues</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_organ</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">tissue_to_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_colors</span><span class="p">:</span>
                <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

        <span class="n">ax_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_group</span><span class="p">,</span> <span class="n">group_pivot</span><span class="p">,</span> <span class="s1">&#39;Organ Group Summary (Avg SAR)&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_group</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
        <span class="n">ax_group</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_group</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_group&quot;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s1">&#39;heatmap_sar_summary.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_peak_sar_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organ_df</span><span class="p">,</span> <span class="n">group_df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Peak SAR&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a combined heatmap for a given peak SAR metric.&quot;&quot;&quot;</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">value_col</span><span class="p">)</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">organ_pivot</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">mean_organ_sar</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_organ_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">value_col</span><span class="p">)</span>
        <span class="n">mean_group_sar</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_group_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_pivot</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                 <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">ax_organ</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax_group</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">ax_organ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_organ</span><span class="p">,</span> <span class="n">organ_pivot</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> (mW/kg) per Tissue&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)</span>

        <span class="n">group_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eyes_group&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_group&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;brain_group&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
        <span class="n">tissue_to_group</span> <span class="o">=</span> <span class="p">{</span><span class="n">tissue</span><span class="p">:</span> <span class="n">group</span> <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">tissues</span> <span class="ow">in</span> <span class="n">tissue_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">tissues</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_organ</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">tissue_to_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_colors</span><span class="p">:</span>
                <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

        <span class="n">ax_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_group</span><span class="p">,</span> <span class="n">group_pivot</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Organ Group Summary (</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_group</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
        <span class="n">ax_group</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_group</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_group&quot;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;heatmap_</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s1">_summary.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.analysis.plotter.Plotter.plot_peak_sar_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_peak_sar_line</span><span class="p">(</span><span class="n">summary_stats</span><span class="p">)</span></code>

<a href="#src.analysis.plotter.Plotter.plot_peak_sar_line" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plots the peak SAR across frequencies for far-field.</p>


            <details class="quote">
              <summary>Source code in <code>src\analysis\plotter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_peak_sar_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_stats</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots the peak SAR across frequencies for far-field.&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;peak_sar&#39;</span> <span class="ow">in</span> <span class="n">summary_stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">summary_stats</span><span class="p">[</span><span class="s1">&#39;peak_sar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Peak SAR (10g) Across All Tissues&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Peak SAR (mW/kg)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">summary_stats</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;No Peak SAR data found&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Peak SAR (10g) Across All Tissues&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s1">&#39;line_peak_sar_summary.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.analysis.plotter.Plotter.plot_far_field_distribution_boxplot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_far_field_distribution_boxplot</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;SAR_whole_body&#39;</span><span class="p">)</span></code>

<a href="#src.analysis.plotter.Plotter.plot_far_field_distribution_boxplot" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Generates a boxplot for the distribution of a given metric in far-field results.</p>


            <details class="quote">
              <summary>Source code in <code>src\analysis\plotter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_far_field_distribution_boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;SAR_whole_body&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a boxplot for the distribution of a given metric in far-field results.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: No data for metric &#39;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&#39; to generate boxplot.&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
        <span class="k">return</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">results_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Distribution of Normalized </span><span class="si">{</span><span class="n">METRIC_LABELS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized SAR (mW/kg)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;boxplot_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">_distribution.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.analysis.plotter.Plotter.plot_sar_heatmap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_sar_heatmap</span><span class="p">(</span><span class="n">organ_df</span><span class="p">,</span> <span class="n">group_df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">)</span></code>

<a href="#src.analysis.plotter.Plotter.plot_sar_heatmap" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Generates the combined heatmap for Min, Avg, and Max SAR.</p>


            <details class="quote">
              <summary>Source code in <code>src\analysis\plotter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_sar_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organ_df</span><span class="p">,</span> <span class="n">group_df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates the combined heatmap for Min, Avg, and Max SAR.&quot;&quot;&quot;</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sar&#39;</span><span class="p">])</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">organ_pivot</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">mean_organ_sar</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_organ_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">metric_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sar&#39;</span><span class="p">]</span>
    <span class="n">sorted_columns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">organ_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">metric_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="p">[</span><span class="n">sorted_columns</span><span class="p">]</span>

    <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;avg_sar&#39;</span><span class="p">)</span>
    <span class="n">mean_group_sar</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_group_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span> <span class="k">return</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_pivot</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax_organ</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_group</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">ax_organ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_organ</span><span class="p">,</span> <span class="n">organ_pivot</span><span class="p">,</span> <span class="s1">&#39;Min, Avg, and Max SAR (mW/kg) per Tissue&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_sar&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_labels</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)</span>

    <span class="n">group_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eyes_group&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_group&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;brain_group&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
    <span class="n">tissue_to_group</span> <span class="o">=</span> <span class="p">{</span><span class="n">tissue</span><span class="p">:</span> <span class="n">group</span> <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">tissues</span> <span class="ow">in</span> <span class="n">tissue_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">tissues</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_organ</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">tissue_to_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_colors</span><span class="p">:</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

    <span class="n">ax_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_group</span><span class="p">,</span> <span class="n">group_pivot</span><span class="p">,</span> <span class="s1">&#39;Organ Group Summary (Avg SAR)&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_group</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
    <span class="n">ax_group</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_group</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_group&quot;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s1">&#39;heatmap_sar_summary.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.analysis.plotter.Plotter.plot_peak_sar_heatmap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_peak_sar_heatmap</span><span class="p">(</span><span class="n">organ_df</span><span class="p">,</span> <span class="n">group_df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Peak SAR&#39;</span><span class="p">)</span></code>

<a href="#src.analysis.plotter.Plotter.plot_peak_sar_heatmap" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Generates a combined heatmap for a given peak SAR metric.</p>


            <details class="quote">
              <summary>Source code in <code>src\analysis\plotter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_peak_sar_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organ_df</span><span class="p">,</span> <span class="n">group_df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Peak SAR&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a combined heatmap for a given peak SAR metric.&quot;&quot;&quot;</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">value_col</span><span class="p">)</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">organ_pivot</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">mean_organ_sar</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">organ_pivot</span> <span class="o">=</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_organ_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">value_col</span><span class="p">)</span>
    <span class="n">mean_group_sar</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">group_pivot</span> <span class="o">=</span> <span class="n">group_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">mean_group_sar</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">organ_pivot</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span> <span class="k">return</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">organ_pivot</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_pivot</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax_organ</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_group</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">ax_organ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_organ</span><span class="p">,</span> <span class="n">organ_pivot</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> (mW/kg) per Tissue&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax_organ</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)</span>

    <span class="n">group_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eyes_group&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_group&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;brain_group&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
    <span class="n">tissue_to_group</span> <span class="o">=</span> <span class="p">{</span><span class="n">tissue</span><span class="p">:</span> <span class="n">group</span> <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">tissues</span> <span class="ow">in</span> <span class="n">tissue_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">tissues</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_organ</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">tissue_to_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_colors</span><span class="p">:</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

    <span class="n">ax_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_heatmap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_group</span><span class="p">,</span> <span class="n">group_pivot</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Organ Group Summary (</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_group</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
    <span class="n">ax_group</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tick_label</span> <span class="ow">in</span> <span class="n">ax_group</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">group_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_group&quot;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;heatmap_</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s1">_summary.png&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.analysis.strategies" class="doc doc-heading">
            <code>strategies</code>


<a href="#src.analysis.strategies" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.analysis.strategies.BaseAnalysisStrategy" class="doc doc-heading">
            <code>BaseAnalysisStrategy</code>


<a href="#src.analysis.strategies.BaseAnalysisStrategy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for analysis strategies.</p>








              <details class="quote">
                <summary>Source code in <code>src\analysis\strategies.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseAnalysisStrategy</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for analysis strategies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">base_dir</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_results_base_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_plots_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">load_and_process_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_normalization_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">simulated_power_w</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_data</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">detailed_name</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">sim_power</span><span class="p">,</span> <span class="n">norm_factor</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">apply_bug_fixes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">result_entry</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">calculate_summary_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="src.analysis.strategies.NearFieldAnalysisStrategy" class="doc doc-heading">
            <code>NearFieldAnalysisStrategy</code>


<a href="#src.analysis.strategies.NearFieldAnalysisStrategy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseAnalysisStrategy (src.analysis.strategies.BaseAnalysisStrategy)" href="#src.analysis.strategies.BaseAnalysisStrategy">BaseAnalysisStrategy</a></code></p>


        <p>Analysis strategy for near-field simulations.</p>








              <details class="quote">
                <summary>Source code in <code>src\analysis\strategies.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NearFieldAnalysisStrategy</span><span class="p">(</span><span class="n">BaseAnalysisStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analysis strategy for near-field simulations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">get_results_base_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;near_field&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_plots_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="s1">&#39;near_field&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_and_process_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">):</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_antenna_config</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">placement_scenarios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;placement_scenarios&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="p">:</span>
            <span class="n">frequency_mhz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">scenario_def</span> <span class="ow">in</span> <span class="n">placement_scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">positions</span> <span class="o">=</span> <span class="n">scenario_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;positions&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">orientations</span> <span class="o">=</span> <span class="n">scenario_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;orientations&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">for</span> <span class="n">pos_name</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">orient_name</span> <span class="ow">in</span> <span class="n">orientations</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">analyzer</span><span class="o">.</span><span class="n">_process_single_result</span><span class="p">(</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">pos_name</span><span class="p">,</span> <span class="n">orient_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_normalization_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">simulated_power_w</span><span class="p">):</span>
        <span class="n">antenna_configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_antenna_config</span><span class="p">()</span>
        <span class="n">freq_config</span> <span class="o">=</span> <span class="n">antenna_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">frequency_mhz</span><span class="p">),</span> <span class="p">{})</span>
        <span class="n">target_power_mw</span> <span class="o">=</span> <span class="n">freq_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_power_mW&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_power_mw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">simulated_power_w</span><span class="p">)</span> <span class="ow">and</span> <span class="n">simulated_power_w</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">target_power_w</span> <span class="o">=</span> <span class="n">target_power_mw</span> <span class="o">/</span> <span class="mf">1000.0</span>
            <span class="k">return</span> <span class="n">target_power_w</span> <span class="o">/</span> <span class="n">simulated_power_w</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_data</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">sim_power</span><span class="p">,</span> <span class="n">norm_factor</span><span class="p">):</span>
        <span class="n">summary_results</span> <span class="o">=</span> <span class="n">pickle_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary_results&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">grouped_stats</span> <span class="o">=</span> <span class="n">pickle_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grouped_sar_stats&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">detailed_df</span> <span class="o">=</span> <span class="n">pickle_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;detailed_sar_stats&#39;</span><span class="p">)</span>
        <span class="n">result_entry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">:</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="n">placement_name</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">:</span> <span class="n">scenario_name</span><span class="p">,</span>
            <span class="s1">&#39;input_power_w&#39;</span><span class="p">:</span> <span class="n">sim_power</span><span class="p">,</span>
            <span class="s1">&#39;SAR_head&#39;</span><span class="p">:</span> <span class="n">summary_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;head_SAR&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm_factor</span><span class="p">,</span>
            <span class="s1">&#39;SAR_trunk&#39;</span><span class="p">:</span> <span class="n">summary_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trunk_SAR&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm_factor</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">grouped_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;psSAR10g_</span><span class="si">{</span><span class="n">group_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_group&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">result_entry</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;peak_sar&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm_factor</span>

        <span class="n">organ_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">detailed_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">peak_sar_col</span> <span class="o">=</span> <span class="s1">&#39;Peak Spatial-Average SAR[IEEE/IEC62704-1] (10g)&#39;</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">detailed_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">organ_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">:</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="n">placement_name</span><span class="p">,</span> <span class="s1">&#39;tissue&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;mass_avg_sar_mw_kg&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Mass-Averaged SAR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">norm_factor</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">peak_sar_col</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm_factor</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="s1">&#39;min_local_sar_mw_kg&#39;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Min. local SAR&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm_factor</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="s1">&#39;max_local_sar_mw_kg&#39;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Max. local SAR&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm_factor</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="k">return</span> <span class="n">result_entry</span><span class="p">,</span> <span class="n">organ_entries</span>

    <span class="k">def</span> <span class="nf">apply_bug_fixes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_entry</span><span class="p">):</span>
        <span class="n">placement</span> <span class="o">=</span> <span class="n">result_entry</span><span class="p">[</span><span class="s1">&#39;placement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">placement</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;front_of_eyes&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">placement</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">result_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SAR_head&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">result_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SAR_trunk&#39;</span><span class="p">)):</span>
                <span class="n">result_entry</span><span class="p">[</span><span class="s1">&#39;SAR_head&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_entry</span><span class="p">[</span><span class="s1">&#39;SAR_trunk&#39;</span><span class="p">]</span>
                <span class="n">result_entry</span><span class="p">[</span><span class="s1">&#39;SAR_trunk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
        <span class="k">return</span> <span class="n">result_entry</span>

    <span class="k">def</span> <span class="nf">calculate_summary_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">):</span>
        <span class="n">placement_scenarios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;placement_scenarios&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">placements_per_scenario</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Calculating Total Possible Placements per Scenario ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">definition</span> <span class="ow">in</span> <span class="n">placement_scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;positions&quot;</span><span class="p">,</span> <span class="p">{}))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;orientations&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">placements_per_scenario</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- Scenario &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> placements&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;info&#39;</span><span class="p">})</span>
        <span class="n">summary_stats</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">completion_counts</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">summary_stats</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_stats</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">idx</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">completion_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">placements_per_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">summary_stats</span>

    <span class="k">def</span> <span class="nf">generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">):</span>
        <span class="n">scenarios_with_results</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;scenario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">summary_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_summary_stats</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">scenario_name</span> <span class="ow">in</span> <span class="n">scenarios_with_results</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Generating plots for scenario: </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
            <span class="n">scenario_results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;scenario&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">scenario_name</span><span class="p">]</span>
            <span class="n">scenario_summary_stats</span> <span class="o">=</span> <span class="n">summary_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scenario_name</span><span class="p">]</span>
            <span class="n">avg_results</span> <span class="o">=</span> <span class="n">scenario_summary_stats</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">])</span>
            <span class="n">progress_info</span> <span class="o">=</span> <span class="n">scenario_summary_stats</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">]</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">plot_average_sar_bar</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">,</span> <span class="n">avg_results</span><span class="p">,</span> <span class="n">progress_info</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">plot_pssar_line</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">,</span> <span class="n">avg_results</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">plot_sar_distribution_boxplots</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">,</span> <span class="n">scenario_results_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="src.analysis.strategies.FarFieldAnalysisStrategy" class="doc doc-heading">
            <code>FarFieldAnalysisStrategy</code>


<a href="#src.analysis.strategies.FarFieldAnalysisStrategy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseAnalysisStrategy (src.analysis.strategies.BaseAnalysisStrategy)" href="#src.analysis.strategies.BaseAnalysisStrategy">BaseAnalysisStrategy</a></code></p>


        <p>Analysis strategy for far-field simulations.</p>








              <details class="quote">
                <summary>Source code in <code>src\analysis\strategies.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FarFieldAnalysisStrategy</span><span class="p">(</span><span class="n">BaseAnalysisStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analysis strategy for far-field simulations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">get_results_base_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;far_field&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_plots_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="s1">&#39;far_field&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_and_process_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">):</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;frequencies_mhz&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">far_field_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;far_field_setup/environmental&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">incident_directions</span> <span class="o">=</span> <span class="n">far_field_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incident_directions&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">polarizations</span> <span class="o">=</span> <span class="n">far_field_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;polarizations&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">direction_name</span> <span class="ow">in</span> <span class="n">incident_directions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">polarization_name</span> <span class="ow">in</span> <span class="n">polarizations</span><span class="p">:</span>
                    <span class="n">placement_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;environmental_</span><span class="si">{</span><span class="n">direction_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polarization_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">analyzer</span><span class="o">.</span><span class="n">_process_single_result</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="s2">&quot;environmental&quot;</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_normalization_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">simulated_power_w</span><span class="p">):</span>
        <span class="c1"># For far-field, we normalize to a power density of 1 W/m^2</span>
        <span class="c1"># This should be handled in the simulation results, so factor is 1.0 here.</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_data</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">sim_power</span><span class="p">,</span> <span class="n">norm_factor</span><span class="p">):</span>
        <span class="n">summary_results</span> <span class="o">=</span> <span class="n">pickle_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary_results&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">detailed_df</span> <span class="o">=</span> <span class="n">pickle_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;detailed_sar_stats&#39;</span><span class="p">)</span>

        <span class="n">result_entry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">:</span> <span class="n">frequency_mhz</span><span class="p">,</span>
            <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="n">placement_name</span><span class="p">,</span>
            <span class="s1">&#39;scenario&#39;</span><span class="p">:</span> <span class="n">scenario_name</span><span class="p">,</span>
            <span class="s1">&#39;input_power_w&#39;</span><span class="p">:</span> <span class="n">sim_power</span><span class="p">,</span>
            <span class="s1">&#39;SAR_whole_body&#39;</span><span class="p">:</span> <span class="n">summary_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;whole_body_sar&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
            <span class="s1">&#39;peak_sar&#39;</span><span class="p">:</span> <span class="n">summary_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;peak_sar_10g_W_kg&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">organ_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">detailed_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">peak_sar_col</span> <span class="o">=</span> <span class="s1">&#39;Peak Spatial-Average SAR[IEEE/IEC62704-1] (10g)&#39;</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">detailed_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">organ_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">:</span> <span class="n">frequency_mhz</span><span class="p">,</span>
                    <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="n">placement_name</span><span class="p">,</span>
                    <span class="s1">&#39;tissue&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;mass_avg_sar_mw_kg&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Mass-Averaged SAR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1"># Already normalized in extractor</span>
                    <span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">peak_sar_col</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1"># Already normalized</span>
                <span class="p">})</span>
        <span class="k">return</span> <span class="n">result_entry</span><span class="p">,</span> <span class="n">organ_entries</span>

    <span class="k">def</span> <span class="nf">apply_bug_fixes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">result_entry</span>

    <span class="k">def</span> <span class="nf">calculate_summary_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">all_organ_results_df</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Generating plots for far-field analysis ---&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;header&#39;</span><span class="p">})</span>
        <span class="n">summary_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_summary_stats</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">plot_whole_body_sar_bar</span><span class="p">(</span><span class="n">summary_stats</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">plot_peak_sar_line</span><span class="p">(</span><span class="n">summary_stats</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">plot_far_field_distribution_boxplot</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;SAR_whole_body&#39;</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">plot_far_field_distribution_boxplot</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;peak_sar&#39;</span><span class="p">)</span>

        <span class="c1"># Prepare data for heatmaps</span>
        <span class="n">organ_sar_df</span> <span class="o">=</span> <span class="n">all_organ_results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">avg_sar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mass_avg_sar_mw_kg&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">organ_pssar_df</span> <span class="o">=</span> <span class="n">all_organ_results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">])[</span><span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">group_summary_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># tissue_groups defined in analyzer</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">tissues</span> <span class="ow">in</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">tissue_group_definitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tissues</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c1"># Create a case-insensitive regex pattern to match any of the tissue keywords</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tissues</span><span class="p">)</span>
            <span class="n">group_df</span> <span class="o">=</span> <span class="n">all_organ_results_df</span><span class="p">[</span><span class="n">all_organ_results_df</span><span class="p">[</span><span class="s1">&#39;tissue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">group_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">group_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;frequency_mhz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                    <span class="n">avg_sar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mass_avg_sar_mw_kg&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">peak_sar_10g_mw_kg</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">summary</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_group&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="n">group_summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

        <span class="n">group_summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">group_summary_data</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">group_summary_data</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">group_summary_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">group_sar_summary</span> <span class="o">=</span> <span class="n">group_summary_df</span><span class="p">[[</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_sar&#39;</span><span class="p">]]</span>
            <span class="n">group_pssar_summary</span> <span class="o">=</span> <span class="n">group_summary_df</span><span class="p">[[</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">]]</span>

            <span class="n">plotter</span><span class="o">.</span><span class="n">plot_peak_sar_heatmap</span><span class="p">(</span><span class="n">organ_sar_df</span><span class="p">,</span> <span class="n">group_sar_summary</span><span class="p">,</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">tissue_group_definitions</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="s1">&#39;avg_sar&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average SAR&#39;</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">plot_peak_sar_heatmap</span><span class="p">(</span><span class="n">organ_pssar_df</span><span class="p">,</span> <span class="n">group_pssar_summary</span><span class="p">,</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">tissue_group_definitions</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="s1">&#39;peak_sar_10g_mw_kg&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Peak SAR 10g&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  - WARNING: No data found for tissue groups, skipping heatmaps.&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.antenna" class="doc doc-heading">
            <code>antenna</code>


<a href="#src.antenna" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.antenna.Antenna" class="doc doc-heading">
            <code>Antenna</code>


<a href="#src.antenna.Antenna" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Helper class for antenna properties.</p>








              <details class="quote">
                <summary>Source code in <code>src\antenna.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Antenna</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper class for antenna properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antenna_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_antenna_config</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_config_for_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the specific antenna configuration for the given frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freq_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">freq_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Antenna configuration not defined for frequency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2"> MHz&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_config</span><span class="p">[</span><span class="n">freq_str</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_model_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the antenna model type (e.g., &#39;PIFA&#39;, &#39;IFA&#39;) for the current frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config_for_frequency</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_type&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_source_entity_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the source entity name for the current frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config_for_frequency</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_centered_antenna_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centered_antennas_dir</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the full path to the centered .sab file for the current frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">antenna_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz_centered.sab&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">centered_antennas_dir</span><span class="p">,</span> <span class="n">antenna_filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.antenna.Antenna.get_config_for_frequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config_for_frequency</span><span class="p">()</span></code>

<a href="#src.antenna.Antenna.get_config_for_frequency" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the specific antenna configuration for the given frequency.</p>


            <details class="quote">
              <summary>Source code in <code>src\antenna.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_config_for_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the specific antenna configuration for the given frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">freq_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freq_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_config</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Antenna configuration not defined for frequency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2"> MHz&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_config</span><span class="p">[</span><span class="n">freq_str</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.antenna.Antenna.get_model_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_model_type</span><span class="p">()</span></code>

<a href="#src.antenna.Antenna.get_model_type" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the antenna model type (e.g., 'PIFA', 'IFA') for the current frequency.</p>


            <details class="quote">
              <summary>Source code in <code>src\antenna.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_model_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the antenna model type (e.g., &#39;PIFA&#39;, &#39;IFA&#39;) for the current frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config_for_frequency</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_type&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.antenna.Antenna.get_source_entity_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_source_entity_name</span><span class="p">()</span></code>

<a href="#src.antenna.Antenna.get_source_entity_name" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the source entity name for the current frequency.</p>


            <details class="quote">
              <summary>Source code in <code>src\antenna.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_source_entity_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the source entity name for the current frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config_for_frequency</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_name&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.antenna.Antenna.get_centered_antenna_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_centered_antenna_path</span><span class="p">(</span><span class="n">centered_antennas_dir</span><span class="p">)</span></code>

<a href="#src.antenna.Antenna.get_centered_antenna_path" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the full path to the centered .sab file for the current frequency.</p>


            <details class="quote">
              <summary>Source code in <code>src\antenna.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_centered_antenna_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centered_antennas_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the full path to the centered .sab file for the current frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">antenna_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz_centered.sab&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">centered_antennas_dir</span><span class="p">,</span> <span class="n">antenna_filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.colors" class="doc doc-heading">
            <code>colors</code>


<a href="#src.colors" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="src.colors.get_color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_color</span><span class="p">(</span><span class="n">log_type</span><span class="p">)</span></code>

<a href="#src.colors.get_color" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the color for a given log type.
Defaults to white if the type is not found.</p>


            <details class="quote">
              <summary>Source code in <code>src\colors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="n">log_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the color for a given log type.</span>
<span class="sd">    Defaults to white if the type is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">COLOR_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">log_type</span><span class="p">,</span> <span class="n">Fore</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.config" class="doc doc-heading">
            <code>config</code>


<a href="#src.config" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.config.Config" class="doc doc-heading">
            <code>Config</code>


<a href="#src.config.Config" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>Handles loading and validation of configuration files with inheritance.</p>








              <details class="quote">
                <summary>Source code in <code>src\config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles loading and validation of configuration files with inheritance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">config_filename</span><span class="o">=</span><span class="s2">&quot;near_field_config.json&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">base_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_config_path</span><span class="p">(</span><span class="n">config_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;material_name_mapping.json&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;configs&#39;</span><span class="p">,</span> <span class="s1">&#39;profiling_config.json&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config_with_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material_mapping_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiling_config_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_config_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">,</span> <span class="n">base_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolves the absolute path to the configuration file.</span>
<span class="sd">        - If a full path is given, it&#39;s used directly.</span>
<span class="sd">        - If a filename without &#39;.json&#39; is given, it&#39;s assumed to be in &#39;configs/&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If a full path is given, use it as is.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">config_filename</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">)</span>

        <span class="c1"># If just a name is given, assume it&#39;s in the &#39;configs&#39; directory.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
            <span class="n">config_filename</span> <span class="o">+=</span> <span class="s1">&#39;.json&#39;</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;configs&#39;</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a setting from the configuration using a path-like string.</span>
<span class="sd">        Example path: &quot;simulation_parameters.number_of_point_sensors&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">current_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">current_config</span><span class="p">:</span>
                <span class="n">current_config</span> <span class="o">=</span> <span class="n">current_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">current_config</span>

    <span class="k">def</span> <span class="nf">_load_config_with_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a JSON configuration file and handles &#39;extends&#39; for inheritance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;extends&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="c1"># Pass the directory of the current file as the base for resolution</span>
            <span class="n">base_config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_config_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;extends&quot;</span><span class="p">],</span> <span class="n">base_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="n">base_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config_with_inheritance</span><span class="p">(</span><span class="n">base_config_path</span><span class="p">)</span>

            <span class="c1"># Merge the current configuration into the base, with the current overriding the base.</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">deep_merge</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">base_config</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">config</span>

    <span class="k">def</span> <span class="nf">_load_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a JSON file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration file not found at: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_simulation_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the simulation parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="nf">get_antenna_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the antenna configuration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;antenna_config&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="nf">get_gridding_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the gridding parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gridding_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="nf">get_phantom_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the configuration for a specific phantom.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phantom_definitions&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_phantom_placements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the placement configuration for a specific phantom.&quot;&quot;&quot;</span>
        <span class="n">phantom_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_phantom_config</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">phantom_config</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">phantom_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;placements&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_material_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the material name mapping for a specific phantom.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">phantom_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span><span class="p">[</span><span class="n">phantom_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback to the old format or a default</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span>

    <span class="k">def</span> <span class="nf">get_solver_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the solver settings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;solver_settings&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="nf">get_antenna_component_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_model_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the component names for a specific antenna model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;antenna_config&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;components&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">antenna_model_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_manual_isolve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the manual_isolve flag.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual_isolve&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_freespace_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the freespace antenna bounding box expansion in mm.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;freespace_antenna_bbox_expansion_mm&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_excitation_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the excitation type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;excitation_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Harmonic&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the bandwidth in MHz.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandwidth_mhz&quot;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_placement_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the definition for a specific placement scenario.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;placement_scenarios&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_profiling_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the specific profiling configuration for the given study type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">study_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Profiling configuration not defined for study type: </span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="p">[</span><span class="n">study_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_line_profiling_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the line_profiling settings from the main config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;line_profiling&#39;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="nf">get_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the server name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_osparc_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the osparc credentials from environment variables.&quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_KEY&quot;</span><span class="p">),</span>
            <span class="s2">&quot;api_secret&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_SECRET&quot;</span><span class="p">),</span>
            <span class="s2">&quot;api_server&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_SERVER&quot;</span><span class="p">),</span>
            <span class="s2">&quot;api_version&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;v0&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Check for missing credentials and provide helpful error message</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">credentials</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;api_version&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing oSPARC credentials: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Please create a .env file in the project root with your oSPARC API credentials. &quot;</span>
                <span class="s2">&quot;See README.md for setup instructions.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">credentials</span>

    <span class="k">def</span> <span class="nf">get_only_write_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the &#39;only_write_input_file&#39; flag from execution_control.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.only_write_input_file&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_setting" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_setting</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.config.Config.get_setting" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Retrieves a setting from the configuration using a path-like string.
Example path: "simulation_parameters.number_of_point_sensors"</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves a setting from the configuration using a path-like string.</span>
<span class="sd">    Example path: &quot;simulation_parameters.number_of_point_sensors&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">current_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">current_config</span><span class="p">:</span>
            <span class="n">current_config</span> <span class="o">=</span> <span class="n">current_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">current_config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_simulation_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_simulation_parameters</span><span class="p">()</span></code>

<a href="#src.config.Config.get_simulation_parameters" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the simulation parameters.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_simulation_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the simulation parameters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_antenna_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_antenna_config</span><span class="p">()</span></code>

<a href="#src.config.Config.get_antenna_config" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the antenna configuration.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_antenna_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the antenna configuration.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;antenna_config&quot;</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_gridding_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_gridding_parameters</span><span class="p">()</span></code>

<a href="#src.config.Config.get_gridding_parameters" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the gridding parameters.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_gridding_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the gridding parameters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gridding_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_phantom_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_phantom_config</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span></code>

<a href="#src.config.Config.get_phantom_config" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the configuration for a specific phantom.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_phantom_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the configuration for a specific phantom.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phantom_definitions&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_phantom_placements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_phantom_placements</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span></code>

<a href="#src.config.Config.get_phantom_placements" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the placement configuration for a specific phantom.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_phantom_placements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the placement configuration for a specific phantom.&quot;&quot;&quot;</span>
    <span class="n">phantom_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_phantom_config</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">phantom_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">phantom_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;placements&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_material_mapping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_material_mapping</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span></code>

<a href="#src.config.Config.get_material_mapping" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the material name mapping for a specific phantom.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_material_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the material name mapping for a specific phantom.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">phantom_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span><span class="p">[</span><span class="n">phantom_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fallback to the old format or a default</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_mapping</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_solver_settings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_solver_settings</span><span class="p">()</span></code>

<a href="#src.config.Config.get_solver_settings" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the solver settings.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_solver_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the solver settings.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;solver_settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_antenna_component_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_antenna_component_names</span><span class="p">(</span><span class="n">antenna_model_type</span><span class="p">)</span></code>

<a href="#src.config.Config.get_antenna_component_names" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the component names for a specific antenna model.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_antenna_component_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_model_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the component names for a specific antenna model.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;antenna_config&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;components&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">antenna_model_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_manual_isolve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_manual_isolve</span><span class="p">()</span></code>

<a href="#src.config.Config.get_manual_isolve" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the manual_isolve flag.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_manual_isolve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the manual_isolve flag.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual_isolve&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_freespace_expansion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_freespace_expansion</span><span class="p">()</span></code>

<a href="#src.config.Config.get_freespace_expansion" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the freespace antenna bounding box expansion in mm.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_freespace_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the freespace antenna bounding box expansion in mm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;freespace_antenna_bbox_expansion_mm&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_excitation_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_excitation_type</span><span class="p">()</span></code>

<a href="#src.config.Config.get_excitation_type" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the excitation type.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_excitation_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the excitation type.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;excitation_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Harmonic&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_bandwidth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bandwidth</span><span class="p">()</span></code>

<a href="#src.config.Config.get_bandwidth" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the bandwidth in MHz.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the bandwidth in MHz.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bandwidth_mhz&quot;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_placement_scenario" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_placement_scenario</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">)</span></code>

<a href="#src.config.Config.get_placement_scenario" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the definition for a specific placement scenario.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_placement_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the definition for a specific placement scenario.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;placement_scenarios&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_profiling_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_profiling_config</span><span class="p">(</span><span class="n">study_type</span><span class="p">)</span></code>

<a href="#src.config.Config.get_profiling_config" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the specific profiling configuration for the given study type.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_profiling_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the specific profiling configuration for the given study type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">study_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Profiling configuration not defined for study type: </span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="p">[</span><span class="n">study_type</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_line_profiling_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_line_profiling_config</span><span class="p">()</span></code>

<a href="#src.config.Config.get_line_profiling_config" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the line_profiling settings from the main config.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_line_profiling_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the line_profiling settings from the main config.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;line_profiling&#39;</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_server" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_server</span><span class="p">()</span></code>

<a href="#src.config.Config.get_server" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the server name.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the server name.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_osparc_credentials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_osparc_credentials</span><span class="p">()</span></code>

<a href="#src.config.Config.get_osparc_credentials" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the osparc credentials from environment variables.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_osparc_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the osparc credentials from environment variables.&quot;&quot;&quot;</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_KEY&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_secret&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_SECRET&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_server&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_SERVER&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_version&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OSPARC_API_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;v0&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Check for missing credentials and provide helpful error message</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">credentials</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;api_version&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing oSPARC credentials: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Please create a .env file in the project root with your oSPARC API credentials. &quot;</span>
            <span class="s2">&quot;See README.md for setup instructions.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">credentials</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.config.Config.get_only_write_input_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_only_write_input_file</span><span class="p">()</span></code>

<a href="#src.config.Config.get_only_write_input_file" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Returns the 'only_write_input_file' flag from execution_control.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_only_write_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the &#39;only_write_input_file&#39; flag from execution_control.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.only_write_input_file&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="src.config.deep_merge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deep_merge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span></code>

<a href="#src.config.deep_merge" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Recursively merges two dictionaries, with values from the source overriding
those in the destination.</p>


            <details class="quote">
              <summary>Source code in <code>src\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">deep_merge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively merges two dictionaries, with values from the source overriding</span>
<span class="sd">    those in the destination.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">destination</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># If both are dicts, recurse</span>
            <span class="n">deep_merge</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">destination</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise, source overrides destination</span>
            <span class="n">destination</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.data_extractor" class="doc doc-heading">
            <code>data_extractor</code>


<a href="#src.data_extractor" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="src.data_extractor.get_parameter_from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameter_from_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span></code>

<a href="#src.data_extractor.get_parameter_from_json" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Extracts a parameter from a JSON file using a dot-separated path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the JSON file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>json_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dot-separated path to the desired value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The extracted value, or None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src\data_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_parameter_from_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts a parameter from a JSON file using a dot-separated path.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The path to the JSON file.</span>
<span class="sd">        json_path (str): The dot-separated path to the desired value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The extracted value, or None if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">json_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_extractor.get_parameter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameter</span><span class="p">(</span><span class="n">source_config</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#src.data_extractor.get_parameter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Generic function to retrieve a parameter from a specified source.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the data source.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contextual information like frequency, phantom_name, etc.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The retrieved parameter value, or None if an error occurs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src\data_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="n">source_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic function to retrieve a parameter from a specified source.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_config (Dict[str, Any]): Configuration for the data source.</span>
<span class="sd">        context (Dict[str, Any]): Contextual information like frequency, phantom_name, etc.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The retrieved parameter value, or None if an error occurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_type</span> <span class="o">=</span> <span class="n">source_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source_type</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
        <span class="n">file_path_template</span> <span class="o">=</span> <span class="n">source_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_path_template&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path_template</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Replace placeholders in the file path template with values from the context</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Missing context for placeholder in file_path_template: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">json_path</span> <span class="o">=</span> <span class="n">source_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json_path&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">project_root</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;project_root&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">get_parameter_from_json</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>

    <span class="c1"># Add other source types here in the future (e.g., &#39;simulation&#39;)</span>
    <span class="c1"># elif source_type == &#39;simulation&#39;:</span>
    <span class="c1">#     # ... implementation for extracting from simulation ...</span>
    <span class="c1">#     pass</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Unsupported source type &#39;</span><span class="si">{</span><span class="n">source_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.gui_manager" class="doc doc-heading">
            <code>gui_manager</code>


<a href="#src.gui_manager" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.gui_manager.QueueGUI" class="doc doc-heading">
            <code>QueueGUI</code>


<a href="#src.gui_manager.QueueGUI" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LoggingMixin (src.logging_manager.LoggingMixin)" href="#src.logging_manager.LoggingMixin">LoggingMixin</a></code></p>


        <p>A GUI proxy that sends messages to a multiprocessing.Queue.
This allows a separate process to communicate with the main GUI process.
It mimics the interface of the original GUI signal system.</p>








              <details class="quote">
                <summary>Source code in <code>src\gui_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">QueueGUI</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GUI proxy that sends messages to a multiprocessing.Queue.</span>
<span class="sd">    This allows a separate process to communicate with the main GUI process.</span>
<span class="sd">    It mimics the interface of the original GUI signal system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">,</span> <span class="n">profiler</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span> <span class="o">=</span> <span class="n">stop_event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">profiler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">progress_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">verbose_logger</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Puts a log message on the queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;progress&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="n">log_type</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">update_overall_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Puts an overall progress update on the queue.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;overall_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="n">current_step</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_steps</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">update_stage_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_name</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Puts a stage progress update on the queue.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;stage_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">stage_name</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="n">current_step</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_steps</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Puts a start animation message on the queue with the estimated duration.&quot;&quot;&quot;</span>
        <span class="n">estimate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_subtask_estimate</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;start_animation&#39;</span><span class="p">,</span> <span class="s1">&#39;estimate&#39;</span><span class="p">:</span> <span class="n">estimate</span><span class="p">,</span> <span class="s1">&#39;end_value&#39;</span><span class="p">:</span> <span class="n">end_value</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">end_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Puts an end animation message on the queue.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;end_animation&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">update_profiler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Puts the updated profiler object on the queue.&quot;&quot;&quot;</span>
        <span class="c1"># We now send the entire profiler object to the GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;profiler_update&#39;</span><span class="p">,</span> <span class="s1">&#39;profiler&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">process_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is a no-op in the process-based model, but kept for interface compatibility.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">is_stopped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the stop event has been set by the main process.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.log" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></code>

<a href="#src.gui_manager.QueueGUI.log" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Puts a log message on the queue.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Puts a log message on the queue.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;progress&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="n">log_type</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.update_overall_progress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_overall_progress</span><span class="p">(</span><span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">)</span></code>

<a href="#src.gui_manager.QueueGUI.update_overall_progress" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Puts an overall progress update on the queue.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_overall_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Puts an overall progress update on the queue.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;overall_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="n">current_step</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_steps</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.update_stage_progress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_stage_progress</span><span class="p">(</span><span class="n">stage_name</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">)</span></code>

<a href="#src.gui_manager.QueueGUI.update_stage_progress" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Puts a stage progress update on the queue.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_stage_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_name</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Puts a stage progress update on the queue.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;stage_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">stage_name</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="n">current_step</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_steps</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.start_stage_animation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">)</span></code>

<a href="#src.gui_manager.QueueGUI.start_stage_animation" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Puts a start animation message on the queue with the estimated duration.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Puts a start animation message on the queue with the estimated duration.&quot;&quot;&quot;</span>
    <span class="n">estimate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_subtask_estimate</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;start_animation&#39;</span><span class="p">,</span> <span class="s1">&#39;estimate&#39;</span><span class="p">:</span> <span class="n">estimate</span><span class="p">,</span> <span class="s1">&#39;end_value&#39;</span><span class="p">:</span> <span class="n">end_value</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.end_stage_animation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_stage_animation</span><span class="p">()</span></code>

<a href="#src.gui_manager.QueueGUI.end_stage_animation" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Puts an end animation message on the queue.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">end_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Puts an end animation message on the queue.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;end_animation&#39;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.update_profiler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_profiler</span><span class="p">()</span></code>

<a href="#src.gui_manager.QueueGUI.update_profiler" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Puts the updated profiler object on the queue.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_profiler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Puts the updated profiler object on the queue.&quot;&quot;&quot;</span>
    <span class="c1"># We now send the entire profiler object to the GUI</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;profiler_update&#39;</span><span class="p">,</span> <span class="s1">&#39;profiler&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.process_events" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_events</span><span class="p">()</span></code>

<a href="#src.gui_manager.QueueGUI.process_events" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>This is a no-op in the process-based model, but kept for interface compatibility.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a no-op in the process-based model, but kept for interface compatibility.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.QueueGUI.is_stopped" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_stopped</span><span class="p">()</span></code>

<a href="#src.gui_manager.QueueGUI.is_stopped" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Checks if the stop event has been set by the main process.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_stopped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the stop event has been set by the main process.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.gui_manager.ProgressGUI" class="doc doc-heading">
            <code>ProgressGUI</code>


<a href="#src.gui_manager.ProgressGUI" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="PySide6.QtWidgets.QWidget">QWidget</span></code></p>









              <details class="quote">
                <summary>Source code in <code>src\gui_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProgressGUI</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">window_title</span><span class="o">=</span><span class="s2">&quot;Simulation Progress&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span> <span class="o">=</span> <span class="n">stop_event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_title</span> <span class="o">=</span> <span class="n">window_title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_name_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Setup&quot;</span><span class="p">:</span> <span class="s2">&quot;setup&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Running Simulation&quot;</span><span class="p">:</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Extracting Results&quot;</span><span class="p">:</span> <span class="s2">&quot;extract&quot;</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_animation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_steps_for_stage</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profiler_phase</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">queue_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_queue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># Poll the queue every 100ms</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clock_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_clock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Overall Progress:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stage_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Current Stage:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Elapsed: N/A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Time Remaining: N/A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elapsed_label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_log_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Status Log:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_log_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>

        <span class="c1"># --- Buttons ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_study</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Run in Background&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide_to_tray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="p">)</span>
        <span class="c1"># --- End Buttons ---</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># --- System Tray Icon ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span> <span class="o">=</span> <span class="n">QSystemTrayIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">StandardPixmap</span><span class="o">.</span><span class="n">SP_ComputerIcon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Simulation is running...&quot;</span><span class="p">)</span>

        <span class="n">tray_menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">show_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Show&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">show_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_from_tray</span><span class="p">)</span>
        <span class="n">tray_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">show_action</span><span class="p">)</span>

        <span class="n">exit_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">exit_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="n">tray_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">exit_action</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setContextMenu</span><span class="p">(</span><span class="n">tray_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tray_icon_activated</span><span class="p">)</span>
        <span class="c1"># --- End System Tray Icon ---</span>

    <span class="k">def</span> <span class="nf">process_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes messages from the study process queue.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Empty</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
                <span class="n">msg_type</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_type&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;overall_progress&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;stage_progress&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;start_animation&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;estimate&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;end_value&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;end_animation&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;profiler_update&#39;</span><span class="p">:</span>
                    <span class="c1"># This message now passes the entire profiler object</span>
                    <span class="c1"># to ensure the GUI has the latest estimates.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profiler&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">profiler_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_phase</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;finished&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">study_finished</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;fatal_error&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FATAL ERROR: </span><span class="si">{</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">study_finished</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
                <span class="k">break</span> <span class="c1"># Queue is empty</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing GUI queue: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">tray_icon_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">QSystemTrayIcon</span><span class="o">.</span><span class="n">ActivationReason</span><span class="o">.</span><span class="n">Trigger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_from_tray</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">hide_to_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_from_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop_study</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;--- Sending stop signal to study process ---&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Signal the study process to stop using the event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_overall_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">total_steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">progress_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_step</span> <span class="o">/</span> <span class="n">total_steps</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress_percent</span> <span class="o">*</span> <span class="mi">10</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span><span class="o">.</span><span class="n">setFormat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">progress_percent</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_stage_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_name</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Stage: </span><span class="si">{</span><span class="n">stage_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_steps_for_stage</span> <span class="o">=</span> <span class="n">total_steps</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>

        <span class="n">progress_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_step</span> <span class="o">/</span> <span class="n">total_steps</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_steps</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">final_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">progress_percent</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">final_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">setFormat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">progress_percent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1"># Note: Overall progress is now driven by messages, not calculated here.</span>

    <span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimated_duration</span><span class="p">,</span> <span class="n">end_step</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span> <span class="o">=</span> <span class="n">estimated_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_steps_for_stage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end_step</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_steps_for_stage</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">animation_active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">end_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_active</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_time</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">progress_ratio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">elapsed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">progress_ratio</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">value_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_range</span> <span class="o">*</span> <span class="n">progress_ratio</span><span class="p">)</span>

        <span class="n">current_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span>
        <span class="n">percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_value</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">setFormat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">percent</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="c1"># This is a simplified version. A real implementation might use HTML with colors.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_clock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">elapsed_sec</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elapsed: </span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">elapsed_sec</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate ETA here using the pull model</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;profiler&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
            <span class="n">current_stage_progress_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1000.0</span>
            <span class="n">eta_sec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_time_remaining</span><span class="p">(</span><span class="n">current_stage_progress</span><span class="o">=</span><span class="n">current_stage_progress_ratio</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">eta_sec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eta_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time Remaining: </span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">eta_sec</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eta_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Time Remaining: N/A&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Time Remaining: N/A&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">study_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;--- Study Finished ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overall_progress_bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Finished&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;--- Study Finished with Errors ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="c1"># Terminate the study process if it&#39;s still alive</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Terminating study process...&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># Wait for termination</span>

        <span class="n">shutdown_loggers</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.gui_manager.ProgressGUI.process_queue" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_queue</span><span class="p">()</span></code>

<a href="#src.gui_manager.ProgressGUI.process_queue" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Processes messages from the study process queue.</p>


            <details class="quote">
              <summary>Source code in <code>src\gui_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processes messages from the study process queue.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Empty</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
            <span class="n">msg_type</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_type&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;overall_progress&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;stage_progress&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;start_animation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;estimate&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;end_value&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;end_animation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;profiler_update&#39;</span><span class="p">:</span>
                <span class="c1"># This message now passes the entire profiler object</span>
                <span class="c1"># to ensure the GUI has the latest estimates.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profiler&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">profiler_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_phase</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;finished&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">study_finished</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;fatal_error&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FATAL ERROR: </span><span class="si">{</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">study_finished</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
            <span class="k">break</span> <span class="c1"># Queue is empty</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing GUI queue: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.logging_manager" class="doc doc-heading">
            <code>logging_manager</code>


<a href="#src.logging_manager" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.logging_manager.ColorFormatter" class="doc doc-heading">
            <code>ColorFormatter</code>


<a href="#src.logging_manager.ColorFormatter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Formatter">Formatter</span></code></p>


        <p>A custom formatter that applies colors based on the log_type attribute
of a log record, and resets the style after each message.</p>








              <details class="quote">
                <summary>Source code in <code>src\logging_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ColorFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom formatter that applies colors based on the log_type attribute</span>
<span class="sd">    of a log record, and resets the style after each message.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">log_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;log_type&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">get_color</span><span class="p">(</span><span class="n">log_type</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">message</span><span class="si">}{</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.logging_manager.LoggingMixin" class="doc doc-heading">
            <code>LoggingMixin</code>


<a href="#src.logging_manager.LoggingMixin" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A mixin class to provide a standardized _log method.
It expects the inheriting class to have 'verbose_logger', 'progress_logger',
and an optional 'gui' attribute.</p>








              <details class="quote">
                <summary>Source code in <code>src\logging_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LoggingMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mixin class to provide a standardized _log method.</span>
<span class="sd">    It expects the inheriting class to have &#39;verbose_logger&#39;, &#39;progress_logger&#39;,</span>
<span class="sd">    and an optional &#39;gui&#39; attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs a message to the appropriate logger with a specified type for color-coding.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (str): The message to log.</span>
<span class="sd">            level (str): The logging level (&#39;progress&#39; or &#39;verbose&#39;).</span>
<span class="sd">            log_type (str): The type of log message for color-coding (e.g., &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="n">log_type</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;progress&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">extra</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gui&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">extra</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gui&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="ow">and</span> <span class="n">level</span> <span class="o">!=</span> <span class="s1">&#39;progress&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="src.logging_manager.setup_loggers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_loggers</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.logging_manager.setup_loggers" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Sets up two loggers:
1. 'progress': For high-level progress updates. Logs to console, a .progress.log file, and the main .log file.
2. 'verbose': For detailed, verbose output. Logs to console and the main .log file.</p>


            <details class="quote">
              <summary>Source code in <code>src\logging_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_loggers</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up two loggers:</span>
<span class="sd">    1. &#39;progress&#39;: For high-level progress updates. Logs to console, a .progress.log file, and the main .log file.</span>
<span class="sd">    2. &#39;verbose&#39;: For detailed, verbose output. Logs to console and the main .log file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">init</span><span class="p">(</span><span class="n">autoreset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Initialize colorama</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span>

    <span class="c1"># Create a timestamp for the session. This ensures all log files in a</span>
    <span class="c1"># single run share the same timestamp.</span>
    <span class="n">session_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m_%H-%M-%S&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">process_id</span><span class="p">:</span>
        <span class="n">session_timestamp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">session_timestamp</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">process_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># --- Log Rotation ---</span>
    <span class="n">lock_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;log_rotation.lock&#39;</span><span class="p">)</span>

    <span class="c1"># Acquire lock for log rotation</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="k">break</span>  <span class="c1"># Lock acquired</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># Wait for the lock to be released</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Now managing two types of log files. The total limit is 30 (15 pairs).</span>
        <span class="n">log_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.log&#39;</span><span class="p">)]</span>
        <span class="n">log_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
        <span class="c1"># We check against 10 because each run creates a pair of files.</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_files</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">old_log</span> <span class="o">=</span> <span class="n">log_files</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">base</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">old_log</span><span class="p">)</span>
                <span class="n">progress_log</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s1">&#39;.progress.log&#39;</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">old_log</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">old_log</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">progress_log</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">progress_log</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c1"># File might be locked, skip.</span>
                <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Release lock</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">)</span>

    <span class="c1"># --- Filename Setup ---</span>
    <span class="n">progress_log_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">session_timestamp</span><span class="si">}</span><span class="s1">.progress.log&#39;</span><span class="p">)</span>
    <span class="n">main_log_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">session_timestamp</span><span class="si">}</span><span class="s1">.log&#39;</span><span class="p">)</span>

    <span class="c1"># --- Formatters ---</span>
    <span class="n">file_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">console_formatter</span> <span class="o">=</span> <span class="n">ColorFormatter</span><span class="p">()</span>

    <span class="c1"># --- Main Log File Handler (for both loggers) ---</span>
    <span class="n">main_file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">main_log_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">main_file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">file_formatter</span><span class="p">)</span>

    <span class="c1"># --- Progress Logger ---</span>
    <span class="n">progress_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="c1"># Remove existing handlers to prevent duplicates</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">progress_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">progress_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># File handler for progress file</span>
    <span class="n">progress_file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">progress_log_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">progress_file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">file_formatter</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">progress_file_handler</span><span class="p">)</span>

    <span class="c1"># Add main file handler</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">main_file_handler</span><span class="p">)</span>

    <span class="c1"># Stream handler for progress (console output)</span>
    <span class="n">progress_stream_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">progress_stream_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">console_formatter</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">progress_stream_handler</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># --- Verbose Logger ---</span>
    <span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
    <span class="n">verbose_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="c1"># Remove existing handlers</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">verbose_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">verbose_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># Add main file handler</span>
    <span class="n">verbose_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">main_file_handler</span><span class="p">)</span>

    <span class="c1"># Stream handler for verbose (console output)</span>
    <span class="n">verbose_stream_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">verbose_stream_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">console_formatter</span><span class="p">)</span>
    <span class="n">verbose_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">verbose_stream_handler</span><span class="p">)</span>
    <span class="n">verbose_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">progress_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Progress logging started for file: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">progress_log_filename</span><span class="p">)</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
    <span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Main logging started for file: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">main_log_filename</span><span class="p">)</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">session_timestamp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.logging_manager.shutdown_loggers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shutdown_loggers</span><span class="p">()</span></code>

<a href="#src.logging_manager.shutdown_loggers" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Shuts down all logging handlers to release file locks.</p>


            <details class="quote">
              <summary>Source code in <code>src\logging_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">shutdown_loggers</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shuts down all logging handlers to release file locks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Logging shutdown ---&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.osparc_batch" class="doc doc-heading">
            <code>osparc_batch</code>


<a href="#src.osparc_batch" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="src.osparc_batch.gui" class="doc doc-heading">
            <code>gui</code>


<a href="#src.osparc_batch.gui" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.osparc_batch.gui.BatchGUI" class="doc doc-heading">
            <code>BatchGUI</code>


<a href="#src.osparc_batch.gui.BatchGUI" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="PySide6.QtWidgets.QWidget">QWidget</span></code></p>


        <p>A simple GUI for the oSPARC batch run.</p>








              <details class="quote">
                <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BatchGUI</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple GUI for the oSPARC batch run.&quot;&quot;&quot;</span>
    <span class="n">print_progress_requested</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">stop_run_requested</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">cancel_jobs_requested</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing BatchGUI UI.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the user interface components.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;oSPARC Batch Runner&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Print Progress&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_progress_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Force Stop&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_stop_run</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Stop and Cancel Jobs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_jobs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Move to Tray&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide_to_tray</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span> <span class="o">=</span> <span class="n">QSystemTrayIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">StandardPixmap</span><span class="o">.</span><span class="n">SP_ComputerIcon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;oSPARC batch run is in progress...&quot;</span><span class="p">)</span>

        <span class="n">tray_menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">show_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Show&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">show_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_from_tray</span><span class="p">)</span>
        <span class="n">tray_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">show_action</span><span class="p">)</span>

        <span class="n">exit_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">exit_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="n">tray_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">exit_action</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setContextMenu</span><span class="p">(</span><span class="n">tray_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tray_icon_activated</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">force_stop_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops the main batch process immediately.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Force stop button clicked.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_run_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop_and_cancel_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops the main batch process and cancels all running jobs.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stop and cancel jobs button clicked.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_jobs_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="c1"># The worker will handle the rest, including quitting the app</span>

    <span class="k">def</span> <span class="nf">hide_to_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hide the main window and show the tray icon.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Hiding window to system tray.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_from_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the main window and hide the tray icon.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing window from system tray.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tray_icon_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle tray icon activation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">QSystemTrayIcon</span><span class="o">.</span><span class="n">ActivationReason</span><span class="o">.</span><span class="n">Trigger</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tray icon clicked, showing window.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_from_tray</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the window close event.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Window close event triggered.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_run</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.init_ui" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_ui</span><span class="p">()</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.init_ui" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Initializes the user interface components.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the user interface components.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;oSPARC Batch Runner&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">progress_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Print Progress&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">progress_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_progress_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Force Stop&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_stop_run</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Stop and Cancel Jobs&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_jobs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Move to Tray&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide_to_tray</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress_button</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tray_button</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_layout</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span> <span class="o">=</span> <span class="n">QSystemTrayIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">StandardPixmap</span><span class="o">.</span><span class="n">SP_ComputerIcon</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;oSPARC batch run is in progress...&quot;</span><span class="p">)</span>

    <span class="n">tray_menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">show_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Show&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="n">show_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_from_tray</span><span class="p">)</span>
    <span class="n">tray_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">show_action</span><span class="p">)</span>

    <span class="n">exit_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="n">exit_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
    <span class="n">tray_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">exit_action</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">setContextMenu</span><span class="p">(</span><span class="n">tray_menu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tray_icon_activated</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.force_stop_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">force_stop_run</span><span class="p">()</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.force_stop_run" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Stops the main batch process immediately.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">force_stop_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stops the main batch process immediately.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Force stop button clicked.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_run_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
    <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.stop_and_cancel_jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop_and_cancel_jobs</span><span class="p">()</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.stop_and_cancel_jobs" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Stops the main batch process and cancels all running jobs.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stop_and_cancel_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stops the main batch process and cancels all running jobs.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stop and cancel jobs button clicked.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_and_cancel_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cancel_jobs_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.hide_to_tray" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hide_to_tray</span><span class="p">()</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.hide_to_tray" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Hide the main window and show the tray icon.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hide_to_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hide the main window and show the tray icon.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Hiding window to system tray.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.show_from_tray" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_from_tray</span><span class="p">()</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.show_from_tray" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Show the main window and hide the tray icon.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show_from_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show the main window and hide the tray icon.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing window from system tray.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tray_icon</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.tray_icon_activated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tray_icon_activated</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.tray_icon_activated" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Handle tray icon activation.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tray_icon_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle tray icon activation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">QSystemTrayIcon</span><span class="o">.</span><span class="n">ActivationReason</span><span class="o">.</span><span class="n">Trigger</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tray icon clicked, showing window.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_from_tray</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.gui.BatchGUI.closeEvent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></code>

<a href="#src.osparc_batch.gui.BatchGUI.closeEvent" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Handle the window close event.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\gui.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle the window close event.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Window close event triggered.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">force_stop_run</span><span class="p">()</span>
    <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.osparc_batch.runner" class="doc doc-heading">
            <code>runner</code>


<a href="#src.osparc_batch.runner" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.setup_console_logging" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_console_logging</span><span class="p">()</span></code>

<a href="#src.osparc_batch.runner.setup_console_logging" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Sets up a basic console logger with color.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_console_logging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up a basic console logger with color.&quot;&quot;&quot;</span>
    <span class="n">colorama</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">autoreset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;osparc_batch&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.setup_job_logging" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_job_logging</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.setup_job_logging" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Set up a unique log file for each job in a specific subdirectory.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_job_logging</span><span class="p">(</span><span class="n">base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up a unique log file for each job in a specific subdirectory.&quot;&quot;&quot;</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;logs&quot;</span> <span class="o">/</span> <span class="s2">&quot;osparc_submission_logs&quot;</span>
    <span class="n">log_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">log_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;job_</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">.log&quot;</span>

    <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">job_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">job_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">job_logger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
        <span class="n">job_logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">job_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">job_logger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.find_input_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_input_files</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.find_input_files" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Finds solver input files (.h5), identifies the latest group based on creation time and configuration,
and cleans up older, unselected files.</p>
<p>Supports both far-field and near-field study types:
- Far-field: Uses frequencies_mhz and finds files per phantom/frequency
- Near-field: Uses antenna_config keys and finds files per phantom/frequency/placement</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_input_files</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds solver input files (.h5), identifies the latest group based on creation time and configuration,</span>
<span class="sd">    and cleans up older, unselected files.</span>

<span class="sd">    Supports both far-field and near-field study types:</span>
<span class="sd">    - Far-field: Uses frequencies_mhz and finds files per phantom/frequency</span>
<span class="sd">    - Near-field: Uses antenna_config keys and finds files per phantom/frequency/placement</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="si">}</span><span class="s2">--- Searching for input files based on configuration ---&quot;</span><span class="p">)</span>
    <span class="n">results_base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;results&quot;</span>
    <span class="n">study_type</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_type&#39;</span><span class="p">)</span>
    <span class="n">phantoms</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;phantoms&#39;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="c1"># Get frequencies based on study type</span>
    <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;frequencies_mhz&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">frequencies</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Far-field config must specify &#39;frequencies_mhz&#39;.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span><span class="p">:</span>
        <span class="c1"># Near-field uses antenna_config keys as frequencies</span>
        <span class="n">antenna_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;antenna_config&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Near-field config must specify &#39;antenna_config&#39;.&quot;</span><span class="p">)</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">freq_str</span><span class="p">)</span> <span class="k">for</span> <span class="n">freq_str</span> <span class="ow">in</span> <span class="n">antenna_config</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown study_type: </span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">study_type</span><span class="p">,</span> <span class="n">phantoms</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Config must specify &#39;study_type&#39; and &#39;phantoms&#39;.&quot;</span><span class="p">)</span>

    <span class="n">all_input_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">phantom</span> <span class="ow">in</span> <span class="n">phantoms</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
                <span class="n">all_input_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_find_far_field_input_files</span><span class="p">(</span>
                    <span class="n">config</span><span class="p">,</span> <span class="n">results_base_dir</span><span class="p">,</span> <span class="n">phantom</span><span class="p">,</span> <span class="n">freq</span>
                <span class="p">))</span>
            <span class="k">elif</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span><span class="p">:</span>
                <span class="n">all_input_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_find_near_field_input_files</span><span class="p">(</span>
                    <span class="n">config</span><span class="p">,</span> <span class="n">results_base_dir</span><span class="p">,</span> <span class="n">phantom</span><span class="p">,</span> <span class="n">freq</span>
                <span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_input_files</span><span class="p">:</span>
        <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="si">}</span><span class="s2">ERROR: Could not find any input files to process.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span><span class="si">}</span><span class="s2">--- Found a total of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_input_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> input files to process. ---&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_input_files</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.get_osparc_client_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_osparc_client_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.get_osparc_client_config" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Initializes and returns the oSPARC client configuration.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_osparc_client_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes and returns the oSPARC client configuration.&quot;&quot;&quot;</span>
    <span class="n">creds</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_osparc_credentials</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">creds</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">,</span> <span class="s1">&#39;api_secret&#39;</span><span class="p">,</span> <span class="s1">&#39;api_server&#39;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing oSPARC credentials in configuration.&quot;</span><span class="p">)</span>

    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;tmp_download&quot;</span>
    <span class="n">temp_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">client_config</span> <span class="o">=</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">Configuration</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;api_server&#39;</span><span class="p">],</span>
        <span class="n">username</span><span class="o">=</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">],</span>
        <span class="n">password</span><span class="o">=</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;api_secret&#39;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">client_config</span><span class="o">.</span><span class="n">temp_folder_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client_config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.submit_job" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit_job</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="n">client_cfg</span><span class="p">,</span> <span class="n">solver_key</span><span class="p">,</span> <span class="n">solver_version</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.submit_job" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Submits a single job to oSPARC and returns the job and solver objects.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">submit_job</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">client_cfg</span><span class="p">,</span> <span class="n">solver_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">solver_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submits a single job to oSPARC and returns the job and solver objects.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="n">client_cfg</span><span class="p">)</span> <span class="k">as</span> <span class="n">api_client</span><span class="p">:</span>
        <span class="n">files_api</span> <span class="o">=</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">FilesApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
        <span class="n">solvers_api</span> <span class="o">=</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">SolversApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

        <span class="n">input_file_osparc</span> <span class="o">=</span> <span class="n">files_api</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">))</span>
        <span class="n">solver</span> <span class="o">=</span> <span class="n">solvers_api</span><span class="o">.</span><span class="n">get_solver_release</span><span class="p">(</span><span class="n">solver_key</span><span class="p">,</span> <span class="n">solver_version</span><span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">solvers_api</span><span class="o">.</span><span class="n">create_job</span><span class="p">(</span>
            <span class="n">solver</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">solver</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="n">job_inputs</span><span class="o">=</span><span class="n">osparc_module</span><span class="o">.</span><span class="n">JobInputs</span><span class="p">({</span><span class="s2">&quot;input_1&quot;</span><span class="p">:</span> <span class="n">input_file_osparc</span><span class="p">})</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;oSPARC API did not return a job ID after creation.&quot;</span><span class="p">)</span>

        <span class="n">solvers_api</span><span class="o">.</span><span class="n">start_job</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span><span class="p">,</span> <span class="n">solver</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.download_and_process_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_and_process_results</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">client_cfg</span><span class="p">,</span> <span class="n">input_file_path</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">,</span> <span class="n">status_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.download_and_process_results" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Downloads and processes the results for a single job.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_and_process_results</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">client_cfg</span><span class="p">,</span> <span class="n">input_file_path</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">,</span> <span class="n">status_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads and processes the results for a single job.&quot;&quot;&quot;</span>
    <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="n">client_cfg</span><span class="p">)</span> <span class="k">as</span> <span class="n">api_client</span><span class="p">:</span>
            <span class="n">files_api</span> <span class="o">=</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">FilesApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
            <span class="n">solvers_api</span> <span class="o">=</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">SolversApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

            <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Downloading results for job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status_callback</span><span class="p">:</span>
                <span class="n">status_callback</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;DOWNLOADING&quot;</span><span class="p">)</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">solvers_api</span><span class="o">.</span><span class="n">get_job_outputs</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">input_file_path</span><span class="o">.</span><span class="n">parent</span>

            <span class="k">for</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">result_file</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2"> for job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

                <span class="n">download_path</span> <span class="o">=</span> <span class="n">files_api</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">file_id</span><span class="o">=</span><span class="n">result_file</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">result_file</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.zip&#39;</span><span class="p">):</span>
                    <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting </span><span class="si">{</span><span class="n">result_file</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

                        <span class="c1"># --- Enhanced Log File Handling ---</span>
                        <span class="n">uuid</span> <span class="o">=</span> <span class="n">input_file_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">extracted_files</span> <span class="o">=</span> <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>

                        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">extracted_files</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.log&#39;</span><span class="p">):</span>
                                <span class="n">extracted_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">filename</span>
                                <span class="k">if</span> <span class="s2">&quot;input.log&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                                    <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;iSolve-output-</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">.log&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">_AxLog.log&quot;</span>

                                <span class="n">final_log_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">new_name</span>
                                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">extracted_path</span><span class="p">,</span> <span class="n">final_log_path</span><span class="p">)</span>
                                <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Renamed and moved log file to </span><span class="si">{</span><span class="n">final_log_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;output.h5&quot;</span> <span class="ow">in</span> <span class="n">result_file</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">input_file_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;_Output&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.h5&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">result_file</span><span class="o">.</span><span class="n">filename</span>

                    <span class="n">final_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">output_filename</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="n">final_path</span><span class="p">)</span>
                    <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">final_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">status_callback</span><span class="p">:</span>
                    <span class="n">status_callback</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;COMPLETED&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not retrieve results for job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status_callback</span><span class="p">:</span>
            <span class="n">status_callback</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.get_progress_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_progress_report</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">job_statuses</span><span class="p">,</span> <span class="n">file_to_job_id</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.get_progress_report" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generates a status summary and a colored file tree string.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_progress_report</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">job_statuses</span><span class="p">,</span> <span class="n">file_to_job_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a status summary and a colored file tree string.&quot;&quot;&quot;</span>
    <span class="n">report_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">status_counts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">status_tuple</span> <span class="ow">in</span> <span class="n">job_statuses</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">status_str</span> <span class="o">=</span> <span class="n">status_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status_tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">status_tuple</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">status_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">status_counts</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">status_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">BLUE</span><span class="si">}</span><span class="s2">--- Progress Summary ---</span><span class="se">\n</span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report_lines</span><span class="p">)</span>

    <span class="c1"># --- Optimized Path Handling ---</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">first_path_parts</span> <span class="o">=</span> <span class="n">input_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parts</span>
        <span class="n">results_index</span> <span class="o">=</span> <span class="n">first_path_parts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="o">*</span><span class="n">first_path_parts</span><span class="p">[:</span><span class="n">results_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="c1"># Fallback for safety, though not expected with the current structure</span>
        <span class="n">common_path_str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">])</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">common_path_str</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">relative_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">relative_path</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">current_level</span> <span class="o">=</span> <span class="n">tree</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">current_level</span> <span class="o">=</span> <span class="n">current_level</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="p">{})</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">current_level</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_to_job_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="si">}</span><span class="s2">Could not process path </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build_tree_recursive</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">sort_key</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">sort_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="n">is_last</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">connector</span> <span class="o">=</span> <span class="s2">&quot;└── &quot;</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="s2">&quot;├── &quot;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">connector</span><span class="si">}{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">WHITE</span><span class="si">}{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">new_prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="s2">&quot;│   &quot;</span><span class="p">)</span>
                <span class="n">build_tree_recursive</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">new_prefix</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="n">status_tuple</span> <span class="o">=</span> <span class="n">job_statuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
                <span class="n">status_str</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">status_tuple</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status_tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">status_tuple</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="n">timer_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">s)&quot;</span>

                <span class="n">status</span> <span class="o">=</span> <span class="n">status_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">STATUS_COLORS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>
                <span class="n">colored_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">item</span><span class="si">}</span><span class="s2"> (oSPARC Job: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, Status: </span><span class="si">{</span><span class="n">status_str</span><span class="si">}{</span><span class="n">timer_str</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">connector</span><span class="si">}{</span><span class="n">colored_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">BLUE</span><span class="si">}</span><span class="s2">--- File Status Tree ---</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">build_tree_recursive</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">BLUE</span><span class="si">}</span><span class="s2">------------------------</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report_lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.main_process_logic" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main_process_logic</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.main_process_logic" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>The main logic of the batch run, now running in a QThread.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main_process_logic</span><span class="p">(</span><span class="n">worker</span><span class="p">:</span> <span class="s1">&#39;Worker&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The main logic of the batch run, now running in a QThread.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">osparc</span> <span class="k">as</span> <span class="nn">osparc_module</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;../..&#39;</span><span class="p">))</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">client_cfg</span> <span class="o">=</span> <span class="n">get_osparc_client_config</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">)</span>

        <span class="n">solver_key</span> <span class="o">=</span> <span class="s2">&quot;simcore/services/comp/isolve-gpu&quot;</span>
        <span class="n">solver_version</span> <span class="o">=</span> <span class="s2">&quot;2.2.212&quot;</span>

        <span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="si">}</span><span class="s2">--- Submitting Jobs to oSPARC in Parallel ---&quot;</span><span class="p">)</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">running_jobs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">input_files</span><span class="p">),</span> <span class="mi">61</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">future_to_file</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_submit_job_in_process</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">worker</span><span class="o">.</span><span class="n">client_cfg</span><span class="p">,</span> <span class="n">solver_key</span><span class="p">,</span> <span class="n">solver_version</span><span class="p">):</span> <span class="n">fp</span>
                <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">worker</span><span class="o">.</span><span class="n">input_files</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_file</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">future_to_file</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">job</span><span class="p">,</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">result</span>
                        <span class="n">worker</span><span class="o">.</span><span class="n">running_jobs</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">)</span>
                        <span class="n">setup_job_logging</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> submitted for input file </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> at path </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ERROR: Submitting job for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">worker</span><span class="o">.</span><span class="n">running_jobs</span><span class="p">:</span>
            <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: No jobs were successfully submitted. Exiting.&quot;</span><span class="p">)</span>
            <span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="si">}</span><span class="s2">--- Polling for Job Completion and Downloading Results ---&quot;</span><span class="p">)</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">job_statuses</span> <span class="o">=</span> <span class="p">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">worker</span><span class="o">.</span><span class="n">running_jobs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">file_to_job_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">fp</span><span class="p">:</span> <span class="n">j</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">fp</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">worker</span><span class="o">.</span><span class="n">running_jobs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">downloaded_jobs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">worker</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CRITICAL ERROR in main process: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.clear_log_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_log_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.clear_log_directory" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Deletes all files in the osparc_submission_logs directory.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_log_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deletes all files in the osparc_submission_logs directory.&quot;&quot;&quot;</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;logs&quot;</span> <span class="o">/</span> <span class="s2">&quot;osparc_submission_logs&quot;</span>
    <span class="k">if</span> <span class="n">log_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Clearing log directory: </span><span class="si">{</span><span class="n">log_dir</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">log_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting file </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting directory </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.clear_temp_download_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_temp_download_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.clear_temp_download_directory" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Deletes the temporary download directory.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_temp_download_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deletes the temporary download directory.&quot;&quot;&quot;</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;tmp_download&quot;</span>
    <span class="k">if</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Clearing temporary download directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting directory </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.osparc_batch.runner.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

<a href="#src.osparc_batch.runner.main" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Main entry point: sets up and starts the GUI and the main logic process.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point: sets up and starts the GUI and the main logic process.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">from</span> <span class="nn">PySide6.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span>
    <span class="kn">from</span> <span class="nn">src.config</span> <span class="kn">import</span> <span class="n">Config</span>

    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;../..&#39;</span><span class="p">))</span>
    <span class="n">clear_log_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
    <span class="n">input_files</span> <span class="o">=</span> <span class="n">find_input_files</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">or</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span>
        <span class="n">config_path</span><span class="o">=</span><span class="n">config_path</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">main_logger</span><span class="p">,</span>
        <span class="n">get_osparc_client_config_func</span><span class="o">=</span><span class="n">get_osparc_client_config</span><span class="p">,</span>
        <span class="n">download_and_process_results_func</span><span class="o">=</span><span class="n">download_and_process_results</span><span class="p">,</span>
        <span class="n">get_progress_report_func</span><span class="o">=</span><span class="n">get_progress_report</span><span class="p">,</span>
        <span class="n">main_process_logic_func</span><span class="o">=</span><span class="n">main_process_logic</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">input_files</span> <span class="o">=</span> <span class="n">input_files</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

    <span class="n">gui</span> <span class="o">=</span> <span class="n">BatchGUI</span><span class="p">()</span>

    <span class="c1"># Connect signals and slots</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>

    <span class="n">worker</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">print_progress_requested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">request_progress_report</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">stop_run_requested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">cancel_jobs_requested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">cancel_jobs</span><span class="p">)</span>

    <span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>

    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">thread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="n">clear_temp_download_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.osparc_batch.worker" class="doc doc-heading">
            <code>worker</code>


<a href="#src.osparc_batch.worker" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.osparc_batch.worker.Worker" class="doc doc-heading">
            <code>Worker</code>


<a href="#src.osparc_batch.worker.Worker" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="PySide6.QtCore.QObject">QObject</span></code></p>


        <p>Worker thread to run the oSPARC batch main logic and manage polling/downloads.</p>








              <details class="quote">
                <summary>Source code in <code>src\osparc_batch\worker.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Worker thread to run the oSPARC batch main logic and manage polling/downloads.&quot;&quot;&quot;</span>

    <span class="n">finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">status_update_requested</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">get_osparc_client_config_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">download_and_process_results_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">get_progress_report_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">main_process_logic_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Inputs / injected dependencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_osparc_client_config</span> <span class="o">=</span> <span class="n">get_osparc_client_config_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_and_process_results</span> <span class="o">=</span> <span class="n">download_and_process_results_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_progress_report</span> <span class="o">=</span> <span class="n">get_progress_report_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_process_logic</span> <span class="o">=</span> <span class="n">main_process_logic_func</span>

        <span class="c1"># Runtime state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_requested</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobs_being_downloaded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_retries</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Correct: Associate retries with the file path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_cfg</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Executors and timers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_jobs_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_update_requested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_job_status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts the long-running task.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_process_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_job_in_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to run a single download in a thread.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">osparc</span> <span class="k">as</span> <span class="nn">osparc_module</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_osparc_client_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_and_process_results</span><span class="p">(</span>
                <span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">client_cfg</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">osparc_module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_update_requested</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during download for job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_update_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs_being_downloaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jobs_being_downloaded</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_jobs_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodically checks the status of running jobs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_requested</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- All Jobs Finished or Stopped ---&quot;</span><span class="p">)</span>
            <span class="n">final_report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_progress_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">final_report</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="kn">import</span> <span class="nn">osparc</span> <span class="k">as</span> <span class="nn">osparc_module</span>
        <span class="k">with</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_cfg</span><span class="p">)</span> <span class="k">as</span> <span class="n">api_client</span><span class="p">:</span>
            <span class="n">solvers_api</span> <span class="o">=</span> <span class="n">osparc_module</span><span class="o">.</span><span class="n">SolversApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
            <span class="c1"># Iterate over a copy of the items, as the dictionary may be modified during the loop</span>
            <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span> <span class="ow">or</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs_being_downloaded</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">solvers_api</span><span class="o">.</span><span class="n">inspect_job</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">new_status_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">progress</span><span class="si">}</span><span class="s2">%)&quot;</span>

                    <span class="n">current_status_str</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>

                    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">current_status_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_status_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_status_str</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                        <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status update: </span><span class="si">{</span><span class="n">new_status_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> finished. Starting download...&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jobs_being_downloaded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;DOWNLOADING&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_download_job_in_thread</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">status</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
                        <span class="n">job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has failed.&quot;</span><span class="p">)</span>

                        <span class="n">retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_retries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">new_retry_count</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">file_retries</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_retry_count</span>
                            <span class="n">job_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrying job for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (attempt </span><span class="si">{</span><span class="n">new_retry_count</span><span class="si">}</span><span class="s2">/3)...&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">status_update_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;RETRYING (</span><span class="si">{</span><span class="n">new_retry_count</span><span class="si">}</span><span class="s2">/3)&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_resubmit_job</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has failed after </span><span class="si">{</span><span class="n">retries</span><span class="si">}</span><span class="s2"> retries. Giving up.&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error inspecting job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resubmit_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resubmits a failed job.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">osparc</span> <span class="k">as</span> <span class="nn">osparc_module</span>
        <span class="kn">from</span> <span class="nn">src.osparc_batch.runner</span> <span class="kn">import</span> <span class="n">_submit_job_in_process</span><span class="p">,</span> <span class="n">setup_job_logging</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span>
            <span class="n">solver_key</span> <span class="o">=</span> <span class="s2">&quot;simcore/services/comp/isolve-gpu&quot;</span>
            <span class="n">solver_version</span> <span class="o">=</span> <span class="s2">&quot;2.2.212&quot;</span>

            <span class="c1"># --- State Cleanup for the Old Job ---</span>
            <span class="n">old_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old_job_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_job_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">old_job_id</span><span class="p">)</span>

            <span class="c1"># --- Submit New Job ---</span>
            <span class="n">job</span><span class="p">,</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">_submit_job_in_process</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_cfg</span><span class="p">,</span> <span class="n">solver_key</span><span class="p">,</span> <span class="n">solver_version</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job</span><span class="p">:</span>
                <span class="n">setup_job_logging</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;job_</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">job_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resubmitted as new job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> for input file </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

                <span class="c1"># --- State Update for the New Job ---</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">solver</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                <span class="c1"># The retry count is already updated in _check_jobs_status using self.file_retries</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to resubmit job for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. The job will be marked as FAILED.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">old_job_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_job_id</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">old_job_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">downloaded_jobs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">old_job_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical error during job resubmission for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thread-safe method to update job status.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">request_progress_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles the request for a progress report.&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Progress report requested by user at </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No input files found yet. The process may still be initializing.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_progress_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Requests the worker to stop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Stop requested by user ---&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_requested</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="c1"># The cancel_futures parameter is available in Python 3.9+</span>
        <span class="c1"># For older versions, this will gracefully shut down.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">cancel_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancels all running jobs and then stops the worker.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Cancellation of all jobs requested by user ---&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_requested</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="c1"># Run the cancel_all_jobs.py script</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">script_path</span> <span class="o">=</span> <span class="s2">&quot;scripts/cancel_all_jobs.py&quot;</span>
            <span class="n">config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span>
            <span class="n">max_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cancellation script for </span><span class="si">{</span><span class="n">max_jobs</span><span class="si">}</span><span class="s2"> jobs...&quot;</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                    <span class="n">script_path</span><span class="p">,</span>
                    <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
                    <span class="n">config_path</span><span class="p">,</span>
                    <span class="s2">&quot;--max-jobs&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">max_jobs</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Job cancellation script finished ---&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The script &#39;</span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">&#39; was not found.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running cancellation script: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during job cancellation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.worker.Worker.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#src.osparc_batch.worker.Worker.run" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Starts the long-running task.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\worker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts the long-running task.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main_process_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.worker.Worker.request_progress_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">request_progress_report</span><span class="p">()</span></code>

<a href="#src.osparc_batch.worker.Worker.request_progress_report" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Handles the request for a progress report.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\worker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Slot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">request_progress_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles the request for a progress report.&quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Progress report requested by user at </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_files</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No input files found yet. The process may still be initializing.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_progress_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_statuses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_to_job_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.worker.Worker.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">()</span></code>

<a href="#src.osparc_batch.worker.Worker.stop" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Requests the worker to stop.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\worker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Slot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Requests the worker to stop.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Stop requested by user ---&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_requested</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="c1"># The cancel_futures parameter is available in Python 3.9+</span>
    <span class="c1"># For older versions, this will gracefully shut down.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.osparc_batch.worker.Worker.cancel_jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cancel_jobs</span><span class="p">()</span></code>

<a href="#src.osparc_batch.worker.Worker.cancel_jobs" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Cancels all running jobs and then stops the worker.</p>


            <details class="quote">
              <summary>Source code in <code>src\osparc_batch\worker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Slot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cancel_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cancels all running jobs and then stops the worker.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Cancellation of all jobs requested by user ---&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_requested</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="c1"># Run the cancel_all_jobs.py script</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">script_path</span> <span class="o">=</span> <span class="s2">&quot;scripts/cancel_all_jobs.py&quot;</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span>
        <span class="n">max_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_jobs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cancellation script for </span><span class="si">{</span><span class="n">max_jobs</span><span class="si">}</span><span class="s2"> jobs...&quot;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                <span class="n">script_path</span><span class="p">,</span>
                <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
                <span class="n">config_path</span><span class="p">,</span>
                <span class="s2">&quot;--max-jobs&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">max_jobs</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Job cancellation script finished ---&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The script &#39;</span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">&#39; was not found.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running cancellation script: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during job cancellation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.profiler" class="doc doc-heading">
            <code>profiler</code>


<a href="#src.profiler" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.profiler.Profiler" class="doc doc-heading">
            <code>Profiler</code>


<a href="#src.profiler.Profiler" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A profiler to track execution time, estimate remaining time, and manage study phases.</p>








              <details class="quote">
                <summary>Source code in <code>src\profiler.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Profiler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A profiler to track execution time, estimate remaining time, and manage study phases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">execution_control</span><span class="p">,</span> <span class="n">profiling_config</span><span class="p">,</span> <span class="n">study_type</span><span class="p">,</span> <span class="n">config_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span> <span class="o">=</span> <span class="n">execution_control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span> <span class="o">=</span> <span class="n">profiling_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">=</span> <span class="n">study_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_phase_weights</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtask_times</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtask_stack</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_simulations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_simulations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_projects</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_project</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_phases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_phase_total_duration</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_calculate_phase_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the relative weight of each enabled study phase.&quot;&quot;&quot;</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total_weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;setup&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;extract&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;do_</span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">weights</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
                <span class="n">total_weight</span> <span class="o">+=</span> <span class="n">weight</span>

        <span class="k">if</span> <span class="n">total_weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
                <span class="n">weights</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_weight</span>
        <span class="k">return</span> <span class="n">weights</span>

    <span class="k">def</span> <span class="nf">set_total_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_simulations</span> <span class="o">=</span> <span class="n">total</span>

    <span class="k">def</span> <span class="nf">set_project_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_projects</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_projects</span> <span class="o">=</span> <span class="n">total_projects</span>

    <span class="k">def</span> <span class="nf">set_current_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_project</span> <span class="o">=</span> <span class="n">project_index</span>

    <span class="k">def</span> <span class="nf">start_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_name</span><span class="p">,</span> <span class="n">total_stages</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="n">phase_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_stages_in_phase</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_stages_in_phase</span> <span class="o">=</span> <span class="n">total_stages</span>

    <span class="k">def</span> <span class="nf">end_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_start_time</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elapsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">complete_run_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_phase_total_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtask_times</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;run_simulation_total&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">get_weighted_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_name</span><span class="p">,</span> <span class="n">phase_progress_ratio</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the overall progress based on the current phase&#39;s weight and progress.&quot;&quot;&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Add the weight of all completed phases</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">phase_name</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">phase_progress_ratio</span>
                <span class="k">break</span>
            <span class="n">progress</span> <span class="o">+=</span> <span class="n">w</span>
        <span class="k">return</span> <span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">get_subtask_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the estimated time for a specific subtask from the profiling config.</span>
<span class="sd">        Returns a default value if not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c1"># Default to 1 second</span>

    <span class="k">def</span> <span class="nf">get_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_stage_progress</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates the total time remaining for the study by considering completed phases,</span>
<span class="sd">        the progress of the current phase, and the estimated time for future phases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Find the index of the current phase in the execution order</span>
        <span class="n">ordered_phases</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;setup&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;extract&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;do_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_phase_index</span> <span class="o">=</span> <span class="n">ordered_phases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span> <span class="c1"># Current phase not in the expected list</span>

        <span class="c1"># 1. Time remaining in the current phase</span>
        <span class="n">current_phase_total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">time_in_current_phase</span> <span class="o">=</span> <span class="n">current_phase_total_time</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">current_stage_progress</span><span class="p">)</span>

        <span class="c1"># 2. Time for all future phases</span>
        <span class="n">time_for_future_phases</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current_phase_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordered_phases</span><span class="p">)):</span>
            <span class="n">future_phase</span> <span class="o">=</span> <span class="n">ordered_phases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">time_for_future_phases</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">future_phase</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

        <span class="c1"># 3. Total ETA</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">time_in_current_phase</span> <span class="o">+</span> <span class="n">time_for_future_phases</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_and_save_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the profiling config with the latest averages and saves it to file.</span>
<span class="sd">        This should be called after a subtask or stage has finished.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">full_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
            <span class="n">full_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_config</span><span class="p">:</span>
            <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Update phase averages from the current profiling session</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;avg_&#39;</span><span class="p">):</span>
                <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Update subtask averages from the current profiling session</span>
        <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">times</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtask_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">times</span><span class="p">:</span>
                <span class="c1"># Here, we can decide on the averaging strategy.</span>
                <span class="c1"># For now, let&#39;s use a simple moving average for responsiveness.</span>
                <span class="c1"># A more robust approach could be a weighted average.</span>
                <span class="c1"># For simplicity, we&#39;ll just average all recorded times for now.</span>
                <span class="n">avg_task_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
                <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_task_time</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">full_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures the final estimates are saved. This can be called at the end of the study.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_and_save_estimates</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.profiler.Profiler.get_weighted_progress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_weighted_progress</span><span class="p">(</span><span class="n">phase_name</span><span class="p">,</span> <span class="n">phase_progress_ratio</span><span class="p">)</span></code>

<a href="#src.profiler.Profiler.get_weighted_progress" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Calculates the overall progress based on the current phase's weight and progress.</p>


            <details class="quote">
              <summary>Source code in <code>src\profiler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_weighted_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_name</span><span class="p">,</span> <span class="n">phase_progress_ratio</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the overall progress based on the current phase&#39;s weight and progress.&quot;&quot;&quot;</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Add the weight of all completed phases</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">phase_name</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">phase_progress_ratio</span>
            <span class="k">break</span>
        <span class="n">progress</span> <span class="o">+=</span> <span class="n">w</span>
    <span class="k">return</span> <span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.profiler.Profiler.get_subtask_estimate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subtask_estimate</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span></code>

<a href="#src.profiler.Profiler.get_subtask_estimate" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Gets the estimated time for a specific subtask from the profiling config.
Returns a default value if not found.</p>


            <details class="quote">
              <summary>Source code in <code>src\profiler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_subtask_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the estimated time for a specific subtask from the profiling config.</span>
<span class="sd">    Returns a default value if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c1"># Default to 1 second</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.profiler.Profiler.get_time_remaining" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_time_remaining</span><span class="p">(</span><span class="n">current_stage_progress</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#src.profiler.Profiler.get_time_remaining" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Estimates the total time remaining for the study by considering completed phases,
the progress of the current phase, and the estimated time for future phases.</p>


            <details class="quote">
              <summary>Source code in <code>src\profiler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_stage_progress</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates the total time remaining for the study by considering completed phases,</span>
<span class="sd">    the progress of the current phase, and the estimated time for future phases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Find the index of the current phase in the execution order</span>
    <span class="n">ordered_phases</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;setup&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;extract&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;do_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">current_phase_index</span> <span class="o">=</span> <span class="n">ordered_phases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="c1"># Current phase not in the expected list</span>

    <span class="c1"># 1. Time remaining in the current phase</span>
    <span class="n">current_phase_total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_phase</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">time_in_current_phase</span> <span class="o">=</span> <span class="n">current_phase_total_time</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">current_stage_progress</span><span class="p">)</span>

    <span class="c1"># 2. Time for all future phases</span>
    <span class="n">time_for_future_phases</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current_phase_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordered_phases</span><span class="p">)):</span>
        <span class="n">future_phase</span> <span class="o">=</span> <span class="n">ordered_phases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">time_for_future_phases</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">future_phase</span><span class="si">}</span><span class="s1">_time&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

    <span class="c1"># 3. Total ETA</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">time_in_current_phase</span> <span class="o">+</span> <span class="n">time_for_future_phases</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.profiler.Profiler.update_and_save_estimates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_and_save_estimates</span><span class="p">()</span></code>

<a href="#src.profiler.Profiler.update_and_save_estimates" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Updates the profiling config with the latest averages and saves it to file.
This should be called after a subtask or stage has finished.</p>


            <details class="quote">
              <summary>Source code in <code>src\profiler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_and_save_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the profiling config with the latest averages and saves it to file.</span>
<span class="sd">    This should be called after a subtask or stage has finished.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">full_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
        <span class="n">full_config</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_config</span><span class="p">:</span>
        <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Update phase averages from the current profiling session</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;avg_&#39;</span><span class="p">):</span>
            <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Update subtask averages from the current profiling session</span>
    <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">times</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtask_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">times</span><span class="p">:</span>
            <span class="c1"># Here, we can decide on the averaging strategy.</span>
            <span class="c1"># For now, let&#39;s use a simple moving average for responsiveness.</span>
            <span class="c1"># A more robust approach could be a weighted average.</span>
            <span class="c1"># For simplicity, we&#39;ll just average all recorded times for now.</span>
            <span class="n">avg_task_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
            <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_task_time</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">full_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.profiler.Profiler.save_estimates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_estimates</span><span class="p">()</span></code>

<a href="#src.profiler.Profiler.save_estimates" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Ensures the final estimates are saved. This can be called at the end of the study.</p>


            <details class="quote">
              <summary>Source code in <code>src\profiler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures the final estimates are saved. This can be called at the end of the study.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_and_save_estimates</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.project_manager" class="doc doc-heading">
            <code>project_manager</code>


<a href="#src.project_manager" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.project_manager.ProjectCorruptionError" class="doc doc-heading">
            <code>ProjectCorruptionError</code>


<a href="#src.project_manager.ProjectCorruptionError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Custom exception for corrupted project files.</p>








              <details class="quote">
                <summary>Source code in <code>src\project_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProjectCorruptionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom exception for corrupted project files.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.project_manager.ProjectManager" class="doc doc-heading">
            <code>ProjectManager</code>


<a href="#src.project_manager.ProjectManager" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LoggingMixin (src.logging_manager.LoggingMixin)" href="#src.logging_manager.LoggingMixin">LoggingMixin</a></code></p>


        <p>Handles the lifecycle of the .smash project file.</p>








              <details class="quote">
                <summary>Source code in <code>src\project_manager.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProjectManager</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the lifecycle of the .smash project file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">verbose_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">progress_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">gui</span>
        <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;do_setup&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;do_run&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;do_extract&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">_is_valid_smash_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the project file is valid and not locked.</span>
<span class="sd">        It first tries to rename the file to itself to check for a lock,</span>
<span class="sd">        then uses h5py to check for basic HDF5 format corruption.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Lock files can exist, preventing a check. If a lock file for the project exists,</span>
        <span class="c1"># we can reasonably assume the file is locked and avoid the check.</span>
        <span class="n">lock_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span><span class="si">}</span><span class="s2">.s4l_lock&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Lock file detected: </span><span class="si">{</span><span class="n">lock_file_path</span><span class="si">}</span><span class="s2">. Assuming project is in use.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 1. Check for file lock by trying to rename. This is a common Windows trick.</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - File lock detected on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - The file is likely being used by another process. Skipping.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 2. Check for HDF5 format corruption.</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - HDF5 format error in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">create_or_open_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates or opens a project based on the &#39;do_setup&#39; execution control flag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">study_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">study_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;study_type&#39; not found in the configuration file.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For near-field studies, phantom_name, frequency_mhz, and placement_name are required.&quot;</span><span class="p">)</span>

            <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;near_field&#39;</span><span class="p">,</span> <span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">)</span>
            <span class="n">project_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;near_field_</span><span class="si">{</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">.smash&quot;</span>

        <span class="k">elif</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
            <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;far_field&#39;</span><span class="p">,</span> <span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">)</span>
            <span class="n">project_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;far_field_</span><span class="si">{</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz.smash&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown study_type &#39;</span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&#39; in config.&quot;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Ensure path uses forward slashes for Sim4Life compatibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">project_filename</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project path set to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">do_setup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;do_setup&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_setup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Execution control: &#39;do_setup&#39; is true. Creating a new project.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new</span><span class="p">()</span>
            <span class="c1"># NOTE: Do not save immediately. The project is unstable until content is added.</span>
            <span class="c1"># The calling study is responsible for the first save.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Execution control: &#39;do_setup&#39; is false. Attempting to open existing project.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
                <span class="c1"># If the primary path doesn&#39;t exist, check for the old &quot;thelonius&quot; naming convention.</span>
                <span class="n">old_project_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;thelonious&quot;</span><span class="p">,</span> <span class="s2">&quot;thelonius&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">old_project_path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project not found at primary path, but found with old &#39;thelonius&#39; naming: </span><span class="si">{</span><span class="n">old_project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">old_project_path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ERROR: &#39;do_setup&#39; is false, but project file not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2"> or with old naming. Cannot proceed.&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ProjectCorruptionError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
                <span class="k">raise</span>  <span class="c1"># Re-raise the exception to halt the study</span>

    <span class="k">def</span> <span class="nf">create_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new empty project in memory, deleting any existing file.</span>
<span class="sd">        The project is not saved to disk until save() is explicitly called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Close any currently open document to release file locks before deleting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Closing existing document before creating a new one to release file lock.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting existing project file at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>

            <span class="c1"># Also delete associated cache files</span>
            <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
            <span class="n">project_filename_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
                <span class="c1"># Cache files start with the project name (or a dot) and are not the project itself.</span>
                <span class="c1"># e.g. &lt;project&gt;.smash.s4l_cache or .&lt;project&gt;.smash.s4l_lock</span>
                <span class="n">is_cache_file</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">project_filename_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">or</span> \
                                <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">project_filename_base</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">project_filename_base</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">is_cache_file</span><span class="p">:</span>
                    <span class="n">item_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">item_path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting cache file: </span><span class="si">{</span><span class="n">item_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting cache file </span><span class="si">{</span><span class="n">item_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Creating a new empty project in memory.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>

        <span class="c1"># In S4L v9.0, the modeling environment must be initialized by creating a</span>
        <span class="c1"># geometric entity after creating a new document. The project should not</span>
        <span class="c1"># be saved until it is populated by the setup script.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Initializing model by creating and deleting a dummy block...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="n">dummy_block</span> <span class="o">=</span> <span class="n">s4l_model</span><span class="o">.</span><span class="n">CreateSolidBlock</span><span class="p">(</span><span class="n">s4l_model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">s4l_model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">dummy_block</span><span class="o">.</span><span class="n">Delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Model initialized, ready for population.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens an existing project after validating it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validating project file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_smash_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Project file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2"> is corrupted or locked.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ProjectCorruptionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File is not a valid or accessible HDF5 file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opening project with Sim4Life: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># The open_project utility calls s4l_v1.document.Open()</span>
            <span class="n">open_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Catching a broad exception because the underlying Sim4Life error is not specific</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Sim4Life failed to open project file, it is likely corrupted: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
            <span class="c1"># Close the document if it was partially opened, to release locks</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">ProjectCorruptionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sim4Life could not open corrupted file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the project to its file path using SaveAs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project path is not set. Cannot save.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving project to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Project saved.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the Sim4Life document.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Closing project document...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Placeholder for any additional cleanup tasks.</span>
<span class="sd">        Currently just closes the project.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reload_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves, closes, and re-opens the project to ensure results are loaded.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Saving and reloading project to load results...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Project reloaded.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.create_or_open_project" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_or_open_project</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.project_manager.ProjectManager.create_or_open_project" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Creates or opens a project based on the 'do_setup' execution control flag.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_or_open_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates or opens a project based on the &#39;do_setup&#39; execution control flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">study_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_type&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">study_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;study_type&#39; not found in the configuration file.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For near-field studies, phantom_name, frequency_mhz, and placement_name are required.&quot;</span><span class="p">)</span>

        <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;near_field&#39;</span><span class="p">,</span> <span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">)</span>
        <span class="n">project_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;near_field_</span><span class="si">{</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">.smash&quot;</span>

    <span class="k">elif</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
        <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;far_field&#39;</span><span class="p">,</span> <span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">)</span>
        <span class="n">project_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;far_field_</span><span class="si">{</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz.smash&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown study_type &#39;</span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&#39; in config.&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Ensure path uses forward slashes for Sim4Life compatibility</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">project_filename</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project path set to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="n">do_setup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_control</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;do_setup&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">do_setup</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Execution control: &#39;do_setup&#39; is true. Creating a new project.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_new</span><span class="p">()</span>
        <span class="c1"># NOTE: Do not save immediately. The project is unstable until content is added.</span>
        <span class="c1"># The calling study is responsible for the first save.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Execution control: &#39;do_setup&#39; is false. Attempting to open existing project.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
            <span class="c1"># If the primary path doesn&#39;t exist, check for the old &quot;thelonius&quot; naming convention.</span>
            <span class="n">old_project_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;thelonious&quot;</span><span class="p">,</span> <span class="s2">&quot;thelonius&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">old_project_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project not found at primary path, but found with old &#39;thelonius&#39; naming: </span><span class="si">{</span><span class="n">old_project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">old_project_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ERROR: &#39;do_setup&#39; is false, but project file not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2"> or with old naming. Cannot proceed.&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ProjectCorruptionError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
            <span class="k">raise</span>  <span class="c1"># Re-raise the exception to halt the study</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.create_new" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_new</span><span class="p">()</span></code>

<a href="#src.project_manager.ProjectManager.create_new" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Creates a new empty project in memory, deleting any existing file.
The project is not saved to disk until save() is explicitly called.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new empty project in memory, deleting any existing file.</span>
<span class="sd">    The project is not saved to disk until save() is explicitly called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Close any currently open document to release file locks before deleting</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Closing existing document before creating a new one to release file lock.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting existing project file at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>

        <span class="c1"># Also delete associated cache files</span>
        <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="n">project_filename_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">project_dir</span><span class="p">):</span>
            <span class="c1"># Cache files start with the project name (or a dot) and are not the project itself.</span>
            <span class="c1"># e.g. &lt;project&gt;.smash.s4l_cache or .&lt;project&gt;.smash.s4l_lock</span>
            <span class="n">is_cache_file</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">project_filename_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">or</span> \
                            <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">project_filename_base</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">project_filename_base</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_cache_file</span><span class="p">:</span>
                <span class="n">item_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">item_path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting cache file: </span><span class="si">{</span><span class="n">item_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting cache file </span><span class="si">{</span><span class="n">item_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Creating a new empty project in memory.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>

    <span class="c1"># In S4L v9.0, the modeling environment must be initialized by creating a</span>
    <span class="c1"># geometric entity after creating a new document. The project should not</span>
    <span class="c1"># be saved until it is populated by the setup script.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Initializing model by creating and deleting a dummy block...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
    <span class="n">dummy_block</span> <span class="o">=</span> <span class="n">s4l_model</span><span class="o">.</span><span class="n">CreateSolidBlock</span><span class="p">(</span><span class="n">s4l_model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">s4l_model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">dummy_block</span><span class="o">.</span><span class="n">Delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Model initialized, ready for population.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.open" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">open</span><span class="p">()</span></code>

<a href="#src.project_manager.ProjectManager.open" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Opens an existing project after validating it.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens an existing project after validating it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validating project file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_smash_file</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Project file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2"> is corrupted or locked.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ProjectCorruptionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File is not a valid or accessible HDF5 file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opening project with Sim4Life: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># The open_project utility calls s4l_v1.document.Open()</span>
        <span class="n">open_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Catching a broad exception because the underlying Sim4Life error is not specific</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Sim4Life failed to open project file, it is likely corrupted: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
        <span class="c1"># Close the document if it was partially opened, to release locks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">ProjectCorruptionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sim4Life could not open corrupted file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">()</span></code>

<a href="#src.project_manager.ProjectManager.save" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Saves the project to its file path using SaveAs.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the project to its file path using SaveAs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project path is not set. Cannot save.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving project to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Project saved.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#src.project_manager.ProjectManager.close" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Closes the Sim4Life document.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Closes the Sim4Life document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Closing project document...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.cleanup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cleanup</span><span class="p">()</span></code>

<a href="#src.project_manager.ProjectManager.cleanup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Placeholder for any additional cleanup tasks.
Currently just closes the project.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Placeholder for any additional cleanup tasks.</span>
<span class="sd">    Currently just closes the project.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.project_manager.ProjectManager.reload_project" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reload_project</span><span class="p">()</span></code>

<a href="#src.project_manager.ProjectManager.reload_project" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Saves, closes, and re-opens the project to ensure results are loaded.</p>


            <details class="quote">
              <summary>Source code in <code>src\project_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reload_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves, closes, and re-opens the project to ensure results are loaded.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Saving and reloading project to load results...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Project reloaded.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.results_extractor" class="doc doc-heading">
            <code>results_extractor</code>


<a href="#src.results_extractor" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.results_extractor.ResultsExtractor" class="doc doc-heading">
            <code>ResultsExtractor</code>


<a href="#src.results_extractor.ResultsExtractor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LoggingMixin (src.logging_manager.LoggingMixin)" href="#src.logging_manager.LoggingMixin">LoggingMixin</a></code></p>


        <p>Handles all post-processing and data extraction tasks.</p>








              <details class="quote">
                <summary>Source code in <code>src\results_extractor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ResultsExtractor</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles all post-processing and data extraction tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">study_type</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">free_space</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">study</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">=</span> <span class="n">study_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">verbose_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">progress_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="o">=</span> <span class="n">free_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">gui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study</span> <span class="o">=</span> <span class="n">study</span>

        <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
        <span class="kn">import</span> <span class="nn">s4l_v1.analysis</span>
        <span class="kn">import</span> <span class="nn">s4l_v1.units</span> <span class="k">as</span> <span class="nn">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>


    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts and saves the simulation results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Extracting results...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - ERROR: Simulation object not found. Skipping result extraction.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">results_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">simulation_extractor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Results</span><span class="p">()</span>

        <span class="c1"># Extract Input Power</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Power&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_input_power</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>

        <span class="c1"># Extract SAR Statistics</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting SAR&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_sar_statistics</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_power_balance</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Skipping SAR statistics for free-space simulation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="c1"># Extract Point Sensor Data if any</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.number_of_point_sensors&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Point Sensors&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_point_sensor_data</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>

        <span class="c1"># Save reports and final results</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="ow">and</span> <span class="s1">&#39;_temp_sar_df&#39;</span> <span class="ow">in</span> <span class="n">results_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_reports</span><span class="p">(</span>
                <span class="n">results_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_temp_sar_df&#39;</span><span class="p">),</span>
                <span class="n">results_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_temp_tissue_groups&#39;</span><span class="p">),</span>
                <span class="n">results_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_temp_group_sar_stats&#39;</span><span class="p">),</span>
                <span class="n">results_data</span>
            <span class="p">)</span>

        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">results_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s1">&#39;sar_results.json&#39;</span><span class="p">)</span>

        <span class="c1"># Clean up any remaining temporary keys before final json dump</span>
        <span class="n">final_results_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_temp&#39;</span><span class="p">)}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">final_results_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - SAR results saved to: </span><span class="si">{</span><span class="n">results_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_input_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the input power from the simulation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Extracting input power...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;extract_input_power&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># For far-field, we use a theoretical model</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Far-field study: using theoretical model for input power.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

                    <span class="c1"># Find the simulation bounding box entity</span>
                    <span class="kn">import</span> <span class="nn">s4l_v1.model</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s2">&quot;far_field_simulation_bbox&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">bbox_entity</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find &#39;far_field_simulation_bbox&#39; entity in the project.&quot;</span><span class="p">)</span>
                        <span class="n">sim_bbox</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">bbox_entity</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: Could not calculate theoretical input power. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="n">sim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sim_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">sim_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sim_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Bounding Box Min: </span><span class="si">{</span><span class="n">sim_min</span><span class="si">}</span><span class="s2">, Max: </span><span class="si">{</span><span class="n">sim_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

                    <span class="c1"># Add padding from config</span>
                    <span class="n">padding_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;gridding_parameters.padding.manual_bottom_padding_mm&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">padding_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;gridding_parameters.padding.manual_top_padding_mm&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>

                    <span class="n">total_min</span> <span class="o">=</span> <span class="n">sim_min</span> <span class="o">-</span> <span class="n">padding_bottom</span>
                    <span class="n">total_max</span> <span class="o">=</span> <span class="n">sim_max</span> <span class="o">+</span> <span class="n">padding_top</span>

                    <span class="c1"># E-field is 1 V/m</span>
                    <span class="n">e_field_v_m</span> <span class="o">=</span> <span class="mf">1.0</span>

                    <span class="c1"># Impedance of free space</span>
                    <span class="n">z0</span> <span class="o">=</span> <span class="mf">377.0</span>

                    <span class="c1"># Power density (W/m^2)</span>
                    <span class="n">power_density_w_m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">e_field_v_m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">z0</span><span class="p">)</span>

                    <span class="c1"># The incident direction determines the area</span>
                    <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># e.g., from &quot;environmental_x_pos_theta&quot;</span>

                    <span class="n">dims</span> <span class="o">=</span> <span class="n">total_max</span> <span class="o">-</span> <span class="n">total_min</span>
                    <span class="c1"># area is in mm^2, convert to m^2</span>
                    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
                        <span class="n">area_m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e6</span>
                    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="n">area_m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e6</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># z</span>
                        <span class="n">area_m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e6</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Calculated Area: </span><span class="si">{</span><span class="n">area_m2</span><span class="si">}</span><span class="s2"> m^2&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

                    <span class="n">total_input_power</span> <span class="o">=</span> <span class="n">power_density_w_m2</span> <span class="o">*</span> <span class="n">area_m2</span>

                    <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_input_power</span>
                    <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_frequency_MHz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Calculated theoretical input power: </span><span class="si">{</span><span class="n">total_input_power</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> W&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># For near-field, extract from the simulation</span>
                <span class="n">input_power_extractor</span> <span class="o">=</span> <span class="n">simulation_extractor</span><span class="p">[</span><span class="s2">&quot;Input Power&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">input_power_extractor</span><span class="p">)</span>
                <span class="n">input_power_extractor</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">input_power_extractor</span><span class="p">,</span> <span class="s1">&#39;GetPower&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using GetPower() to extract input power.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                    <span class="n">power_w</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">input_power_extractor</span><span class="o">.</span><span class="n">GetPower</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">power_w</span><span class="p">)</span>
                    <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_frequency_MHz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - GetPower() not available, falling back to manual extraction.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="n">input_power_output</span> <span class="o">=</span> <span class="n">input_power_extractor</span><span class="o">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s2">&quot;EM Input Power(f)&quot;</span><span class="p">]</span>
                    <span class="n">input_power_output</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">input_power_output</span><span class="p">,</span> <span class="s1">&#39;GetHarmonicData&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Harmonic data detected. Extracting single power value.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                        <span class="n">power_complex</span> <span class="o">=</span> <span class="n">input_power_output</span><span class="o">.</span><span class="n">GetHarmonicData</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">input_power_w</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">power_complex</span><span class="p">)</span>
                        <span class="n">frequency_at_value_mhz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span>
                        <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_power_w</span><span class="p">)</span>
                        <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_frequency_MHz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency_at_value_mhz</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">power_data</span> <span class="o">=</span> <span class="n">input_power_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">GetComponent</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">power_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">power_data</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">power_data</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">power_data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">input_power_w</span> <span class="o">=</span> <span class="n">power_data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                                <span class="n">frequency_at_value_mhz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">center_frequency_hz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">*</span> <span class="mf">1e6</span>
                                <span class="n">axis</span> <span class="o">=</span> <span class="n">input_power_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">Axis</span>
                                <span class="n">min_diff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
                                <span class="n">target_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq_hz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
                                    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">freq_hz</span> <span class="o">-</span> <span class="n">center_frequency_hz</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">min_diff</span><span class="p">:</span>
                                        <span class="n">min_diff</span> <span class="o">=</span> <span class="n">diff</span>
                                        <span class="n">target_index</span> <span class="o">=</span> <span class="n">i</span>
                                <span class="k">if</span> <span class="n">target_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="n">input_power_w</span> <span class="o">=</span> <span class="n">power_data</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>
                                    <span class="n">frequency_at_value_mhz</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e6</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">input_power_w</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                                    <span class="n">frequency_at_value_mhz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_power_w</span><span class="p">)</span>
                            <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_frequency_MHz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency_at_value_mhz</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - WARNING: Could not extract input power values.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ERROR: An exception occurred during input power extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_sar_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts SAR statistics for all tissues.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Extracting SAR statistics for all tissues...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;extract_sar_statistics&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">em_sensor_extractor</span> <span class="o">=</span> <span class="n">simulation_extractor</span><span class="p">[</span><span class="s2">&quot;Overall Field&quot;</span><span class="p">]</span>
                <span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">FrequencySettings</span><span class="o">.</span><span class="n">ExtractedFrequency</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;All&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">em_sensor_extractor</span><span class="p">)</span>
                <span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

                <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s2">&quot;EM E(x,y,z,f0)&quot;</span><span class="p">]]</span>
                <span class="n">sar_stats_evaluator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">em_evaluators</span><span class="o">.</span><span class="n">SarStatisticsEvaluator</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>
                <span class="n">sar_stats_evaluator</span><span class="o">.</span><span class="n">PeakSpatialAverageSAR</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">sar_stats_evaluator</span><span class="o">.</span><span class="n">PeakSAR</span><span class="o">.</span><span class="n">TargetMass</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
                <span class="n">sar_stats_evaluator</span><span class="o">.</span><span class="n">UpdateAttributes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sar_stats_evaluator</span><span class="p">)</span>
                <span class="n">sar_stats_evaluator</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

                <span class="n">stats_output</span> <span class="o">=</span> <span class="n">sar_stats_evaluator</span><span class="o">.</span><span class="n">Outputs</span>

                <span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># The results are in the first output port of the evaluator</span>
                    <span class="n">results_wrapper</span> <span class="o">=</span> <span class="n">stats_output</span><span class="o">.</span><span class="n">item_at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">results_wrapper</span><span class="p">,</span> <span class="s1">&#39;Data&#39;</span><span class="p">):</span>
                        <span class="n">results</span> <span class="o">=</span> <span class="n">results_wrapper</span><span class="o">.</span><span class="n">Data</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - ERROR: AlgorithmOutput object does not have a .Data attribute.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - ERROR: No output ports found in the SAR Statistics Evaluator.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>

                <span class="c1"># IMPORTANT: Clean up the algorithm to avoid issues when processing multiple simulations in the same project</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">sar_stats_evaluator</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">results</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="s1">&#39;NumberOfRows&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">results</span><span class="o">.</span><span class="n">NumberOfRows</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">results</span><span class="o">.</span><span class="n">NumberOfColumns</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - WARNING: No SAR statistics data found.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Tissue&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">cap</span> <span class="k">for</span> <span class="n">cap</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">ColumnMainCaptions</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">NumberOfRows</span><span class="p">()):</span>
                    <span class="n">row_caption</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">RowCaptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">clean_caption</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*\(.*\)\s*$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row_caption</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">row_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_caption</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">NumberOfColumns</span><span class="p">())]</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
                <span class="n">numeric_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;Tissue&#39;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">tissue_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_tissue_groups</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">group_sar_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_group_sar</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">group_sar_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_weighted_avg_sar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;weighted_avg_sar&#39;</span><span class="p">]</span>
                    <span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_peak_sar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;peak_sar&#39;</span><span class="p">]</span>

                <span class="n">all_regions_row</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;All Regions&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">all_regions_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">mass_averaged_sar</span> <span class="o">=</span> <span class="n">all_regions_row</span><span class="p">[</span><span class="s1">&#39;Mass-Averaged SAR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span><span class="p">:</span>
                        <span class="n">sar_key</span> <span class="o">=</span> <span class="s1">&#39;head_SAR&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;front_of_eyes&#39;</span><span class="p">,</span> <span class="s1">&#39;by_cheek&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;trunk_SAR&#39;</span>
                        <span class="n">results_data</span><span class="p">[</span><span class="n">sar_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mass_averaged_sar</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;whole_body_sar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mass_averaged_sar</span><span class="p">)</span>

                    <span class="n">peak_sar_col_name</span> <span class="o">=</span> <span class="s1">&#39;Peak Spatial-Average SAR[IEEE/IEC62704-1] (10g)&#39;</span>
                    <span class="k">if</span> <span class="n">peak_sar_col_name</span> <span class="ow">in</span> <span class="n">all_regions_row</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;peak_sar_10g_W_kg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">all_regions_row</span><span class="p">[</span><span class="n">peak_sar_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_extract_peak_sar_details</span><span class="p">(</span><span class="n">em_sensor_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>
                <span class="c1"># Save the dataframes for later reporting</span>
                <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;_temp_sar_df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
                <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;_temp_tissue_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tissue_groups</span>
                <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;_temp_group_sar_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_sar_stats</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ERROR: An unexpected error during all-tissue SAR statistics extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_define_tissue_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">available_tissues</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines tissue groups from the material mapping file or falls back to keywords.&quot;&quot;&quot;</span>

        <span class="n">material_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_material_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;_tissue_groups&quot;</span> <span class="ow">in</span> <span class="n">material_mapping</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Loading tissue groups for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39; from material_name_mapping.json&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

            <span class="n">phantom_groups</span> <span class="o">=</span> <span class="n">material_mapping</span><span class="p">[</span><span class="s2">&quot;_tissue_groups&quot;</span><span class="p">]</span>
            <span class="n">tissue_groups</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">tissue_list</span> <span class="ow">in</span> <span class="n">phantom_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># The tissues in the JSON are the S4L names, but &#39;available_tissues&#39; are the mapped names.</span>
                <span class="c1"># We need to get the S4L names for the available tissues to find the intersection.</span>

                <span class="c1"># Create a reverse mapping from mapped name to S4L name for the current phantom</span>
                <span class="n">reverse_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">material_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)}</span>

                <span class="c1"># Find which of the available tissues (mapped names) correspond to the S4L names in our group list</span>
                <span class="n">s4l_names_in_group</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tissue_list</span><span class="p">)</span>

                <span class="n">final_tissue_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">available_tissues</span><span class="p">:</span>
                    <span class="n">s4l_name</span> <span class="o">=</span> <span class="n">reverse_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tissue</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s4l_name</span> <span class="ow">in</span> <span class="n">s4l_names_in_group</span><span class="p">:</span>
                        <span class="n">final_tissue_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tissue</span><span class="p">)</span>

                <span class="n">tissue_groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_tissue_list</span>
            <span class="k">return</span> <span class="n">tissue_groups</span>

        <span class="c1"># Fallback to old method for backward compatibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - WARNING: &#39;_tissue_groups&#39; not found in material mapping. Falling back to keyword-based tissue grouping.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;eyes_group&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;eye&quot;</span><span class="p">,</span> <span class="s2">&quot;cornea&quot;</span><span class="p">,</span> <span class="s2">&quot;sclera&quot;</span><span class="p">,</span> <span class="s2">&quot;lens&quot;</span><span class="p">,</span> <span class="s2">&quot;vitreous&quot;</span><span class="p">],</span>
            <span class="s2">&quot;skin_group&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;skin&quot;</span><span class="p">],</span>
            <span class="s2">&quot;brain_group&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">,</span> <span class="s2">&quot;commissura&quot;</span><span class="p">,</span> <span class="s2">&quot;midbrain&quot;</span><span class="p">,</span> <span class="s2">&quot;pineal&quot;</span><span class="p">,</span> <span class="s2">&quot;hypophysis&quot;</span><span class="p">,</span> <span class="s2">&quot;medulla_oblongata&quot;</span><span class="p">,</span> <span class="s2">&quot;pons&quot;</span><span class="p">,</span> <span class="s2">&quot;thalamus&quot;</span><span class="p">,</span> <span class="s2">&quot;hippocampus&quot;</span><span class="p">,</span> <span class="s2">&quot;cerebellum&quot;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="n">tissue_groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">group</span><span class="p">:</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">available_tissues</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">)]</span> <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">tissue_groups</span>

    <span class="k">def</span> <span class="nf">_calculate_group_sar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates weighted average and peak SAR for tissue groups.&quot;&quot;&quot;</span>
        <span class="n">group_sar_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">peak_sar_col</span> <span class="o">=</span> <span class="s1">&#39;Peak Spatial-Average SAR[IEEE/IEC62704-1] (10g)&#39;</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">tissues</span> <span class="ow">in</span> <span class="n">tissue_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">group_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tissues</span><span class="p">)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">group_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">total_mass</span> <span class="o">=</span> <span class="n">group_df</span><span class="p">[</span><span class="s1">&#39;Total Mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">weighted_avg_sar</span> <span class="o">=</span> <span class="p">(</span><span class="n">group_df</span><span class="p">[</span><span class="s1">&#39;Total Mass&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">group_df</span><span class="p">[</span><span class="s1">&#39;Mass-Averaged SAR&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">total_mass</span> <span class="k">if</span> <span class="n">total_mass</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">peak_sar</span> <span class="o">=</span> <span class="n">group_df</span><span class="p">[</span><span class="n">peak_sar_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="n">peak_sar_col</span> <span class="ow">in</span> <span class="n">group_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="n">group_sar_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;weighted_avg_sar&#39;</span><span class="p">:</span> <span class="n">weighted_avg_sar</span><span class="p">,</span> <span class="s1">&#39;peak_sar&#39;</span><span class="p">:</span> <span class="n">peak_sar</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">group_sar_data</span>

    <span class="k">def</span> <span class="nf">_save_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tissue_groups</span><span class="p">,</span> <span class="n">group_sar_stats</span><span class="p">,</span> <span class="n">results_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves detailed reports in Pickle and HTML format.&quot;&quot;&quot;</span>
        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Make sure point sensor data is included in the pickle</span>
        <span class="n">pickle_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;detailed_sar_stats&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span>
            <span class="s1">&#39;tissue_group_composition&#39;</span><span class="p">:</span> <span class="n">tissue_groups</span><span class="p">,</span>
            <span class="s1">&#39;grouped_sar_stats&#39;</span><span class="p">:</span> <span class="n">group_sar_stats</span><span class="p">,</span>
            <span class="s1">&#39;summary_results&#39;</span><span class="p">:</span> <span class="n">results_data</span><span class="p">,</span>
            <span class="s1">&#39;peak_sar_details&#39;</span><span class="p">:</span> <span class="n">results_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;peak_sar_details&#39;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s1">&#39;point_sensor_data&#39;</span><span class="p">:</span> <span class="n">results_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;point_sensor_data&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">}</span>
        <span class="n">pickle_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s1">&#39;sar_stats_all_tissues.pkl&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_filepath</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pickle_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Pickle report saved to: </span><span class="si">{</span><span class="n">pickle_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">html_content</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Tissue Group Composition&lt;/h2&gt;&quot;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">tissue_groups</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Grouped SAR Statistics&lt;/h2&gt;&quot;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">group_sar_stats</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>

        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Peak SAR Details&lt;/h2&gt;&quot;</span>
        <span class="n">peak_sar_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">results_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;peak_sar_details&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span>
        <span class="n">peak_sar_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Parameter&#39;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">peak_sar_df</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>

        <span class="n">html_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s1">&#39;sar_stats_all_tissues.html&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - HTML report saved to: </span><span class="si">{</span><span class="n">html_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_peak_sar_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">em_sensor_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts peak SAR details like location and cell.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Extracting peak SAR details...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s2">&quot;SAR(x,y,z,f0)&quot;</span><span class="p">]]</span>
            <span class="n">average_sar_field_evaluator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">em_evaluators</span><span class="o">.</span><span class="n">AverageSarFieldEvaluator</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">average_sar_field_evaluator</span><span class="o">.</span><span class="n">TargetMass</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
            <span class="n">average_sar_field_evaluator</span><span class="o">.</span><span class="n">UpdateAttributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">average_sar_field_evaluator</span><span class="p">)</span>
            <span class="n">average_sar_field_evaluator</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

            <span class="n">peak_sar_output</span> <span class="o">=</span> <span class="n">average_sar_field_evaluator</span><span class="o">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s2">&quot;Peak Spatial SAR (psSAR) Results&quot;</span><span class="p">]</span>
            <span class="n">peak_sar_output</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

            <span class="n">data_collection</span> <span class="o">=</span> <span class="n">peak_sar_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">DataSimpleDataCollection</span>

            <span class="n">peak_sar_details</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">data_collection</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">data_collection</span><span class="o">.</span><span class="n">Keys</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">data_collection</span><span class="o">.</span><span class="n">FieldValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">peak_sar_details</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
                <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;peak_sar_details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak_sar_details</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - WARNING: Could not extract peak SAR details.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">average_sar_field_evaluator</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ERROR: An exception occurred during peak SAR detail extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_power_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the power balance from the simulation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Extracting power balance...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">em_sensor_extractor</span> <span class="o">=</span> <span class="n">simulation_extractor</span><span class="p">[</span><span class="s2">&quot;Overall Field&quot;</span><span class="p">]</span>
            <span class="n">power_balance_extractor</span> <span class="o">=</span> <span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s2">&quot;Power Balance&quot;</span><span class="p">]</span>
            <span class="n">power_balance_extractor</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

            <span class="n">power_balance_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">power_balance_extractor</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">DataSimpleDataCollection</span><span class="o">.</span><span class="n">Keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="c1"># Skip logging the initial &#39;Balance&#39; since we will recalculate it.</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Balance&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">power_balance_extractor</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">DataSimpleDataCollection</span><span class="o">.</span><span class="n">FieldValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">power_balance_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

            <span class="c1"># For far-field, the input power is theoretical, so we overwrite the &#39;Pin&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span> <span class="ow">and</span> <span class="s1">&#39;input_power_W&#39;</span> <span class="ow">in</span> <span class="n">results_data</span><span class="p">:</span>
                <span class="n">power_balance_data</span><span class="p">[</span><span class="s1">&#39;Pin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;input_power_W&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Overwriting Pin with theoretical value: </span><span class="si">{</span><span class="n">power_balance_data</span><span class="p">[</span><span class="s1">&#39;Pin&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> W&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

            <span class="n">pin</span> <span class="o">=</span> <span class="n">power_balance_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pin&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">diel_loss</span> <span class="o">=</span> <span class="n">power_balance_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DielLoss&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">rad_power</span> <span class="o">=</span> <span class="n">power_balance_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RadPower&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pin</span> <span class="o">&gt;</span> <span class="mf">1e-9</span><span class="p">:</span>
                <span class="n">p_out</span> <span class="o">=</span> <span class="n">diel_loss</span> <span class="o">+</span> <span class="n">rad_power</span>
                <span class="n">balance</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_out</span> <span class="o">/</span> <span class="n">pin</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">balance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

            <span class="n">power_balance_data</span><span class="p">[</span><span class="s1">&#39;Balance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">balance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Final Balance: </span><span class="si">{</span><span class="n">balance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>

            <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;power_balance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power_balance_data</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: Could not extract power balance: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_point_sensor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts point sensor data, plots it, and saves the raw data.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Extracting point sensor data...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;extract_point_sensor_data&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">num_sensors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.number_of_point_sensors&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_sensors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;science&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

                <span class="n">point_source_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.point_source_order&quot;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="n">point_sensor_results</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sensors</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_source_order</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - WARNING: Not enough entries in &#39;point_source_order&#39; config for sensor </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. Skipping.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="n">corner_name</span> <span class="o">=</span> <span class="n">point_source_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">sensor_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Point Sensor Entity </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">full_sensor_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sensor_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">corner_name</span><span class="si">}</span><span class="s2">)&quot;</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># In recent S4L versions, point sensors are directly under the main extractor</span>
                        <span class="n">em_sensor_extractor</span> <span class="o">=</span> <span class="n">simulation_extractor</span><span class="p">[</span><span class="n">full_sensor_name</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">em_sensor_extractor</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - WARNING: Could not find sensor extractor for &#39;</span><span class="si">{</span><span class="n">full_sensor_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                            <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - WARNING: Could not retrieve sensor &#39;</span><span class="si">{</span><span class="n">full_sensor_name</span><span class="si">}</span><span class="s2">&#39;. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">em_sensor_extractor</span><span class="p">)</span>

                    <span class="k">if</span> <span class="s2">&quot;EM E(t)&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">Outputs</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - WARNING: &#39;EM E(t)&#39; output not found for sensor &#39;</span><span class="si">{</span><span class="n">full_sensor_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">em_sensor_extractor</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="n">em_output</span> <span class="o">=</span> <span class="n">em_sensor_extractor</span><span class="o">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s2">&quot;EM E(t)&quot;</span><span class="p">]</span>
                    <span class="n">em_output</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

                    <span class="n">time_axis</span> <span class="o">=</span> <span class="n">em_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">Axis</span>
                    <span class="n">ex_data</span> <span class="o">=</span> <span class="n">em_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">GetComponent</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">ey_data</span> <span class="o">=</span> <span class="n">em_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">GetComponent</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">ez_data</span> <span class="o">=</span> <span class="n">em_output</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">GetComponent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                    <span class="n">label</span> <span class="o">=</span> <span class="n">corner_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">time_axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time_axis</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># For plotting, let&#39;s plot the magnitude</span>
                        <span class="n">e_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ex_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ey_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ez_data</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="n">e_mag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Plotted data for sensor: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

                        <span class="n">point_sensor_results</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;time_s&#39;</span><span class="p">:</span> <span class="n">time_axis</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="s1">&#39;Ex_V_m&#39;</span><span class="p">:</span> <span class="n">ex_data</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="s1">&#39;Ey_V_m&#39;</span><span class="p">:</span> <span class="n">ey_data</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="s1">&#39;Ez_V_m&#39;</span><span class="p">:</span> <span class="n">ez_data</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="s1">&#39;E_mag_V_m&#39;</span><span class="p">:</span> <span class="n">e_mag</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="p">}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Saved raw data for sensor: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - WARNING: No data found for sensor &#39;</span><span class="si">{</span><span class="n">full_sensor_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllAlgorithms</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">em_sensor_extractor</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">point_sensor_results</span><span class="p">:</span>
                    <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;point_sensor_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_sensor_results</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;|E-Field| (V/m)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Point Sensor E-Field Magnitude vs. Time (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2"> MHz)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

                <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">)</span>
                <span class="n">plot_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s1">&#39;point_sensor_data.png&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_filepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Point sensor plot saved to: </span><span class="si">{</span><span class="n">plot_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ERROR: An exception occurred during point sensor data extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.results_extractor.ResultsExtractor.extract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract</span><span class="p">()</span></code>

<a href="#src.results_extractor.ResultsExtractor.extract" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Extracts and saves the simulation results.</p>


            <details class="quote">
              <summary>Source code in <code>src\results_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts and saves the simulation results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Extracting results...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - ERROR: Simulation object not found. Skipping result extraction.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">results_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">simulation_extractor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Results</span><span class="p">()</span>

    <span class="c1"># Extract Input Power</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Power&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_input_power</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>

    <span class="c1"># Extract SAR Statistics</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting SAR&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_sar_statistics</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_power_balance</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Skipping SAR statistics for free-space simulation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="c1"># Extract Point Sensor Data if any</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.number_of_point_sensors&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Point Sensors&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_point_sensor_data</span><span class="p">(</span><span class="n">simulation_extractor</span><span class="p">,</span> <span class="n">results_data</span><span class="p">)</span>

    <span class="c1"># Save reports and final results</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="ow">and</span> <span class="s1">&#39;_temp_sar_df&#39;</span> <span class="ow">in</span> <span class="n">results_data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_reports</span><span class="p">(</span>
            <span class="n">results_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_temp_sar_df&#39;</span><span class="p">),</span>
            <span class="n">results_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_temp_tissue_groups&#39;</span><span class="p">),</span>
            <span class="n">results_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_temp_group_sar_stats&#39;</span><span class="p">),</span>
            <span class="n">results_data</span>
        <span class="p">)</span>

    <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">results_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s1">&#39;sar_results.json&#39;</span><span class="p">)</span>

    <span class="c1"># Clean up any remaining temporary keys before final json dump</span>
    <span class="n">final_results_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_temp&#39;</span><span class="p">)}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">final_results_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - SAR results saved to: </span><span class="si">{</span><span class="n">results_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.setups" class="doc doc-heading">
            <code>setups</code>


<a href="#src.setups" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="src.setups.base_setup" class="doc doc-heading">
            <code>base_setup</code>


<a href="#src.setups.base_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.base_setup.BaseSetup" class="doc doc-heading">
            <code>BaseSetup</code>


<a href="#src.setups.base_setup.BaseSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LoggingMixin (src.logging_manager.LoggingMixin)" href="#src.logging_manager.LoggingMixin">LoggingMixin</a></code></p>


        <p>Abstract base class for all simulation setups (Near-Field, Far-Field).</p>








              <details class="quote">
                <summary>Source code in <code>src\setups\base_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseSetup</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for all simulation setups (Near-Field, Far-Field).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the base setup.</span>

<span class="sd">        Args:</span>
<span class="sd">            config (Config): The configuration object for the study.</span>
<span class="sd">            verbose_logger (logging.Logger): Logger for verbose output.</span>
<span class="sd">            progress_logger (logging.Logger): Logger for progress updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">verbose_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">progress_logger</span>
        <span class="kn">import</span> <span class="nn">s4l_v1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span> <span class="o">=</span> <span class="n">s4l_v1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">emfdtd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">model</span>

    <span class="k">def</span> <span class="nf">_apply_simulation_time_and_termination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">sim_bbox_entity</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates and applies simulation time and termination settings.</span>
<span class="sd">        This is a shared method for both Near-Field and Far-Field setups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sim_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_simulation_parameters</span><span class="p">()</span>

        <span class="c1"># Time Calculation</span>
        <span class="n">time_multiplier</span> <span class="o">=</span> <span class="n">sim_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_time_multiplier&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Using simulation time multiplier: </span><span class="si">{</span><span class="n">time_multiplier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">sim_bbox_entity</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bbox</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ERROR: Could not get a valid bounding box for entity &#39;</span><span class="si">{</span><span class="n">sim_bbox_entity</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;. Skipping time calculation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span> <span class="o">=</span> <span class="n">bbox</span>

        <span class="n">diagonal_length_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbox_max</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbox_min</span><span class="p">))</span> <span class="o">/</span> <span class="mf">1000.0</span>

        <span class="n">time_to_travel_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_multiplier</span> <span class="o">*</span> <span class="n">diagonal_length_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">299792458</span>
        <span class="n">sim_time_periods</span> <span class="o">=</span> <span class="n">time_to_travel_s</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">frequency_mhz</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">))</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">SetupSettings</span><span class="o">.</span><span class="n">SimulationTime</span> <span class="o">=</span> <span class="n">sim_time_periods</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Simulation time set to </span><span class="si">{</span><span class="n">sim_time_periods</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> periods.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="c1"># Termination Criteria</span>
        <span class="n">term_level</span> <span class="o">=</span> <span class="n">sim_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;global_auto_termination&quot;</span><span class="p">,</span> <span class="s2">&quot;GlobalAutoTerminationWeak&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Setting termination criteria to: </span><span class="si">{</span><span class="n">term_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">term_options</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">SetupSettings</span><span class="o">.</span><span class="n">GlobalAutoTermination</span><span class="o">.</span><span class="n">enum</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">term_options</span><span class="p">,</span> <span class="n">term_level</span><span class="p">):</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">SetupSettings</span><span class="o">.</span><span class="n">GlobalAutoTermination</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">term_options</span><span class="p">,</span> <span class="n">term_level</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">term_level</span> <span class="o">==</span> <span class="s2">&quot;GlobalAutoTerminationUserDefined&quot;</span><span class="p">:</span>
            <span class="n">convergence_db</span> <span class="o">=</span> <span class="n">sim_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;convergence_level_dB&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">SetupSettings</span><span class="o">.</span><span class="n">ConvergenceLevel</span> <span class="o">=</span> <span class="n">convergence_db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Convergence level set to: </span><span class="si">{</span><span class="n">convergence_db</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_solver_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Configures solver settings, including kernel. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Configuring solver settings...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="n">solver_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_solver_settings</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">solver_settings</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">solver</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">SolverSettings</span>

        <span class="c1"># Setup Kernel</span>
        <span class="n">kernel_type</span> <span class="o">=</span> <span class="n">solver_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kernel&quot;</span><span class="p">,</span> <span class="s2">&quot;Software&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kernel_type</span> <span class="o">==</span> <span class="s2">&quot;acceleware&quot;</span><span class="p">:</span>
            <span class="n">solver</span><span class="o">.</span><span class="n">Kernel</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">Kernel</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">AXware</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Solver kernel set to: Acceleware (AXware)&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kernel_type</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span><span class="p">:</span>
            <span class="n">solver</span><span class="o">.</span><span class="n">Kernel</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">Kernel</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">Cuda</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Solver kernel set to: Cuda&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solver</span><span class="o">.</span><span class="n">Kernel</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">Kernel</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">Software</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Solver kernel set to: Software&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run_full_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method must be implemented by subclasses to prepare the simulation scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_manager (ProjectManager): The project manager to handle file operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The main simulation object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;run_full_setup&#39; method must be implemented by a subclass.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_point_sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">sim_bbox_entity_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds point sensors at the corners of the simulation bounding box.&quot;&quot;&quot;</span>
        <span class="n">num_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.number_of_point_sensors&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_points</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Skipping point sensor creation (0 points requested).&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">sim_bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="n">sim_bbox_entity_name</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sim_bbox_entity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: Could not find simulation bounding box &#39;</span><span class="si">{</span><span class="n">sim_bbox_entity_name</span><span class="si">}</span><span class="s2">&#39; to add point sensors.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">sim_bbox_entity</span><span class="p">])</span>

        <span class="n">corner_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;lower_left_bottom&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">),</span>
            <span class="s2">&quot;lower_right_bottom&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">),</span>
            <span class="s2">&quot;lower_left_up&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">),</span>
            <span class="s2">&quot;lower_right_up&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">),</span>
            <span class="s2">&quot;top_left_bottom&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">),</span>
            <span class="s2">&quot;top_right_bottom&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">),</span>
            <span class="s2">&quot;top_left_up&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">),</span>
            <span class="s2">&quot;top_right_up&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">point_source_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.point_source_order&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">corner_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
            <span class="n">corner_name</span> <span class="o">=</span> <span class="n">point_source_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">corner_coords</span> <span class="o">=</span> <span class="n">corner_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">corner_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">corner_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: Invalid corner name &#39;</span><span class="si">{</span><span class="n">corner_name</span><span class="si">}</span><span class="s2">&#39; in point_source_order. Skipping.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">point_entity_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Point Sensor Entity </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">corner_name</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="n">existing_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">point_entity_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">existing_entity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Point sensor &#39;</span><span class="si">{</span><span class="n">point_entity_name</span><span class="si">}</span><span class="s2">&#39; already exists. Skipping creation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">point_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">CreatePoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">corner_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">corner_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">corner_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">point_entity</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">point_entity_name</span>
            <span class="n">point_sensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">PointSensorSettings</span><span class="p">()</span>
            <span class="n">point_sensor</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Point Sensor </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">point_sensor</span><span class="p">,</span> <span class="p">[</span><span class="n">point_entity</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Added point sensor at </span><span class="si">{</span><span class="n">corner_coords</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">corner_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="nd">@profile</span>
    <span class="k">def</span> <span class="nf">_finalize_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">all_simulation_parts</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the final voxelization and grid update for a simulation.</span>
<span class="sd">        This is a shared method for both Near-Field and Far-Field setups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;    - Finalizing setup...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="n">voxeler_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">AutomaticVoxelerSettings</span><span class="p">()</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">voxeler_settings</span><span class="p">,</span> <span class="n">all_simulation_parts</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">XCore</span>
        <span class="n">old_log_level</span> <span class="o">=</span> <span class="n">XCore</span><span class="o">.</span><span class="n">SetLogLevel</span><span class="p">(</span><span class="n">XCore</span><span class="o">.</span><span class="n">eLogCategory</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">UpdateAllMaterials</span><span class="p">()</span>
        <span class="n">XCore</span><span class="o">.</span><span class="n">SetLogLevel</span><span class="p">(</span><span class="n">old_log_level</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;export_material_properties&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Extracting Material Properties ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
            <span class="n">material_properties</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">simulation</span><span class="o">.</span><span class="n">AllSettings</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">MaterialSettings</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Material: &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Relative Permittivity: </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">ElectricProps</span><span class="o">.</span><span class="n">RelativePermittivity</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Electric Conductivity (S/m): </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">ElectricProps</span><span class="o">.</span><span class="n">Conductivity</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Mass Density (kg/m^3): </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">MassDensity</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
                        <span class="n">material_properties</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span>
                            <span class="s1">&#39;RelativePermittivity&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">ElectricProps</span><span class="o">.</span><span class="n">RelativePermittivity</span><span class="p">,</span>
                            <span class="s1">&#39;Conductivity&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">ElectricProps</span><span class="o">.</span><span class="n">Conductivity</span><span class="p">,</span>
                            <span class="s1">&#39;MassDensity&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">MassDensity</span>
                        <span class="p">})</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Could not extract properties for &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Finished Extracting Material Properties ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

            <span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;analysis/cpw/data&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;material_properties_</span><span class="si">{</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">material_properties</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Exported Material Properties to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

        <span class="n">simulation</span><span class="o">.</span><span class="n">UpdateGrid</span><span class="p">()</span>
        <span class="n">project_manager</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">CreateVoxels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;    - Finalizing setup complete.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.base_setup.BaseSetup.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span></code>

<a href="#src.setups.base_setup.BaseSetup.__init__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Initializes the base setup.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="Config">Config</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration object for the study.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose_logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for verbose output.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progress_logger</code>
            </td>
            <td>
                  <code><span title="logging.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for progress updates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src\setups\base_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the base setup.</span>

<span class="sd">    Args:</span>
<span class="sd">        config (Config): The configuration object for the study.</span>
<span class="sd">        verbose_logger (logging.Logger): Logger for verbose output.</span>
<span class="sd">        progress_logger (logging.Logger): Logger for progress updates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">verbose_logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">progress_logger</span>
    <span class="kn">import</span> <span class="nn">s4l_v1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span> <span class="o">=</span> <span class="n">s4l_v1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">emfdtd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.setups.base_setup.BaseSetup.run_full_setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_full_setup</span><span class="p">(</span><span class="n">project_manager</span><span class="p">)</span></code>

<a href="#src.setups.base_setup.BaseSetup.run_full_setup" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>This method must be implemented by subclasses to prepare the simulation scene.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project_manager</code>
            </td>
            <td>
                  <code><span title="ProjectManager">ProjectManager</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The project manager to handle file operations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main simulation object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src\setups\base_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_full_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method must be implemented by subclasses to prepare the simulation scene.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_manager (ProjectManager): The project manager to handle file operations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The main simulation object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;run_full_setup&#39; method must be implemented by a subclass.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.boundary_setup" class="doc doc-heading">
            <code>boundary_setup</code>


<a href="#src.setups.boundary_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.boundary_setup.BoundarySetup" class="doc doc-heading">
            <code>BoundarySetup</code>


<a href="#src.setups.boundary_setup.BoundarySetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>


        <p>Configures the boundary conditions for the simulation.</p>








              <details class="quote">
                <summary>Source code in <code>src\setups\boundary_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BoundarySetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configures the boundary conditions for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>

    <span class="k">def</span> <span class="nf">setup_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the boundary conditions based on the configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up boundary conditions...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="n">solver_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_solver_settings</span><span class="p">()</span>
        <span class="n">boundary_config</span> <span class="o">=</span> <span class="n">solver_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;boundary_conditions&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Set Boundary Type (e.g., UpmlCpml)</span>
        <span class="n">bc_type</span> <span class="o">=</span> <span class="n">boundary_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;UpmlCpml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Setting global boundary conditions to: </span><span class="si">{</span><span class="n">bc_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">global_boundaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalBoundarySettings</span>
        <span class="k">if</span> <span class="n">global_boundaries</span><span class="p">:</span>
            <span class="n">bc_enum</span> <span class="o">=</span> <span class="n">global_boundaries</span><span class="o">.</span><span class="n">GlobalBoundaryType</span><span class="o">.</span><span class="n">enum</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bc_enum</span><span class="p">,</span> <span class="n">bc_type</span><span class="p">):</span>
                <span class="n">global_boundaries</span><span class="o">.</span><span class="n">GlobalBoundaryType</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bc_enum</span><span class="p">,</span> <span class="n">bc_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Successfully set GlobalBoundaryType to </span><span class="si">{</span><span class="n">bc_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Invalid boundary condition type &#39;</span><span class="si">{</span><span class="n">bc_type</span><span class="si">}</span><span class="s2">&#39;. Using default.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;    - Warning: &#39;GlobalBoundarySettings&#39; not found on simulation object.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

        <span class="c1"># Set PML Strength</span>
        <span class="n">strength</span> <span class="o">=</span> <span class="n">boundary_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;strength&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Setting PML strength to: </span><span class="si">{</span><span class="n">strength</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">boundary_settings_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AllSettings</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">BoundarySettings</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">boundary_settings_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - No BoundarySettings found in simulation. Cannot set PML strength.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">boundary_settings</span> <span class="o">=</span> <span class="n">boundary_settings_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">strength_enum</span> <span class="o">=</span> <span class="n">boundary_settings</span><span class="o">.</span><span class="n">PmlStrength</span><span class="o">.</span><span class="n">enum</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">strength_enum</span><span class="p">,</span> <span class="n">strength</span><span class="p">):</span>
            <span class="n">boundary_settings</span><span class="o">.</span><span class="n">PmlStrength</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">strength_enum</span><span class="p">,</span> <span class="n">strength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Successfully set PmlStrength to </span><span class="si">{</span><span class="n">strength</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Invalid PML strength &#39;</span><span class="si">{</span><span class="n">strength</span><span class="si">}</span><span class="s2">&#39;. Using default (Medium).&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="n">boundary_settings</span><span class="o">.</span><span class="n">PmlStrength</span> <span class="o">=</span> <span class="n">strength_enum</span><span class="o">.</span><span class="n">Medium</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.boundary_setup.BoundarySetup.setup_boundary_conditions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_boundary_conditions</span><span class="p">()</span></code>

<a href="#src.setups.boundary_setup.BoundarySetup.setup_boundary_conditions" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Sets up the boundary conditions based on the configuration.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\boundary_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up the boundary conditions based on the configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up boundary conditions...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
    <span class="n">solver_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_solver_settings</span><span class="p">()</span>
    <span class="n">boundary_config</span> <span class="o">=</span> <span class="n">solver_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;boundary_conditions&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Set Boundary Type (e.g., UpmlCpml)</span>
    <span class="n">bc_type</span> <span class="o">=</span> <span class="n">boundary_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;UpmlCpml&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Setting global boundary conditions to: </span><span class="si">{</span><span class="n">bc_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="n">global_boundaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalBoundarySettings</span>
    <span class="k">if</span> <span class="n">global_boundaries</span><span class="p">:</span>
        <span class="n">bc_enum</span> <span class="o">=</span> <span class="n">global_boundaries</span><span class="o">.</span><span class="n">GlobalBoundaryType</span><span class="o">.</span><span class="n">enum</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bc_enum</span><span class="p">,</span> <span class="n">bc_type</span><span class="p">):</span>
            <span class="n">global_boundaries</span><span class="o">.</span><span class="n">GlobalBoundaryType</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bc_enum</span><span class="p">,</span> <span class="n">bc_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Successfully set GlobalBoundaryType to </span><span class="si">{</span><span class="n">bc_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Invalid boundary condition type &#39;</span><span class="si">{</span><span class="n">bc_type</span><span class="si">}</span><span class="s2">&#39;. Using default.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;    - Warning: &#39;GlobalBoundarySettings&#39; not found on simulation object.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

    <span class="c1"># Set PML Strength</span>
    <span class="n">strength</span> <span class="o">=</span> <span class="n">boundary_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;strength&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Setting PML strength to: </span><span class="si">{</span><span class="n">strength</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="n">boundary_settings_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AllSettings</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">BoundarySettings</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">boundary_settings_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - No BoundarySettings found in simulation. Cannot set PML strength.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">boundary_settings</span> <span class="o">=</span> <span class="n">boundary_settings_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">strength_enum</span> <span class="o">=</span> <span class="n">boundary_settings</span><span class="o">.</span><span class="n">PmlStrength</span><span class="o">.</span><span class="n">enum</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">strength_enum</span><span class="p">,</span> <span class="n">strength</span><span class="p">):</span>
        <span class="n">boundary_settings</span><span class="o">.</span><span class="n">PmlStrength</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">strength_enum</span><span class="p">,</span> <span class="n">strength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Successfully set PmlStrength to </span><span class="si">{</span><span class="n">strength</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Invalid PML strength &#39;</span><span class="si">{</span><span class="n">strength</span><span class="si">}</span><span class="s2">&#39;. Using default (Medium).&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="n">boundary_settings</span><span class="o">.</span><span class="n">PmlStrength</span> <span class="o">=</span> <span class="n">strength_enum</span><span class="o">.</span><span class="n">Medium</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.far_field_setup" class="doc doc-heading">
            <code>far_field_setup</code>


<a href="#src.setups.far_field_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.far_field_setup.FarFieldSetup" class="doc doc-heading">
            <code>FarFieldSetup</code>


<a href="#src.setups.far_field_setup.FarFieldSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>


        <p>Configures a single far-field simulation for a specific direction and polarization.</p>








              <details class="quote">
                <summary>Source code in <code>src\setups\far_field_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FarFieldSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configures a single far-field simulation for a specific direction and polarization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">direction_name</span><span class="p">,</span> <span class="n">polarization_name</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction_name</span> <span class="o">=</span> <span class="n">direction_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polarization_name</span> <span class="o">=</span> <span class="n">polarization_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span> <span class="o">=</span> <span class="n">project_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;far_field_setup/type&#39;</span><span class="p">,</span> <span class="s1">&#39;environmental&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span>

    <span class="k">def</span> <span class="nf">run_full_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_setup</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the full sequence of setup steps for a single far-field simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Setting up single Far-Field sim ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="c1"># The phantom is now loaded once per project in the study.</span>
        <span class="c1"># This setup will just add a simulation to the currently open project.</span>
        <span class="n">bbox_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_or_get_simulation_bbox</span><span class="p">()</span>

        <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_simulation_entity</span><span class="p">(</span><span class="n">bbox_entity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_common_settings</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simulation</span>

    <span class="k">def</span> <span class="nf">_create_simulation_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox_entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the EM FDTD simulation entity and its plane wave source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sim_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EM_FDTD_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Creating simulation: </span><span class="si">{</span><span class="n">sim_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">Simulation</span><span class="p">()</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">sim_name</span>

        <span class="c1"># Set frequency for the entire simulation FIRST. This influences material properties.</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">Frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>

        <span class="n">plane_wave_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">PlaneWaveSourceSettings</span><span class="p">()</span>
        <span class="n">plane_wave_source</span><span class="o">.</span><span class="n">CenterFrequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>

        <span class="c1"># Calculate direction vector (k) and angles</span>
        <span class="n">direction_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;x_pos&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="s2">&quot;x_neg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
            <span class="s2">&quot;y_pos&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="s2">&quot;y_neg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
            <span class="s2">&quot;z_pos&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="s2">&quot;z_neg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">phi_deg</span><span class="p">,</span> <span class="n">theta_deg</span> <span class="o">=</span> <span class="n">direction_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_name</span><span class="p">]</span>

        <span class="n">plane_wave_source</span><span class="o">.</span><span class="n">Theta</span> <span class="o">=</span> <span class="n">theta_deg</span>
        <span class="n">plane_wave_source</span><span class="o">.</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">phi_deg</span>

        <span class="c1"># Set polarization (psi angle)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_name</span> <span class="o">==</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span>
            <span class="n">plane_wave_source</span><span class="o">.</span><span class="n">Psi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_name</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            <span class="n">plane_wave_source</span><span class="o">.</span><span class="n">Psi</span> <span class="o">=</span> <span class="mi">90</span>

        <span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">plane_wave_source</span><span class="p">,</span> <span class="p">[</span><span class="n">bbox_entity</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_simulation_time_and_termination</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">bbox_entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simulation</span>

    <span class="k">def</span> <span class="nf">_create_or_get_simulation_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the simulation bounding box if it doesn&#39;t exist, otherwise returns the existing one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bbox_name</span> <span class="o">=</span> <span class="s2">&quot;far_field_simulation_bbox&quot;</span>
        <span class="n">existing_bbox</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">bbox_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_bbox</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Found existing simulation bounding box.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">existing_bbox</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Creating simulation bounding box for far-field...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">XCoreModeling</span>
        <span class="n">phantom_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">XCoreModeling</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phantom_entities</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No phantom found to create bounding box.&quot;</span><span class="p">)</span>

        <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">(</span><span class="n">phantom_entities</span><span class="p">)</span>

        <span class="n">padding_mm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;simulation_parameters.bbox_padding_mm&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">sim_bbox_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbox_min</span><span class="p">)</span> <span class="o">-</span> <span class="n">padding_mm</span>
        <span class="n">sim_bbox_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbox_max</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding_mm</span>

        <span class="n">sim_bbox</span> <span class="o">=</span> <span class="n">XCoreModeling</span><span class="o">.</span><span class="n">CreateWireBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">sim_bbox_min</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">sim_bbox_max</span><span class="p">))</span>
        <span class="n">sim_bbox</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">bbox_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Created far-field simulation BBox with </span><span class="si">{</span><span class="n">padding_mm</span><span class="si">}</span><span class="s2">mm padding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sim_bbox</span>

    <span class="k">def</span> <span class="nf">_apply_common_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies common material, gridding, and solver settings to the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying common settings to </span><span class="si">{</span><span class="n">simulation</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="n">material_setup</span> <span class="o">=</span> <span class="n">MaterialSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="n">free_space</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">material_setup</span><span class="o">.</span><span class="n">assign_materials</span><span class="p">(</span><span class="n">phantom_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">gridding_setup</span> <span class="o">=</span> <span class="n">GriddingSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
        <span class="n">gridding_setup</span><span class="o">.</span><span class="n">setup_gridding</span><span class="p">()</span>

        <span class="n">boundary_setup</span> <span class="o">=</span> <span class="n">BoundarySetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>
        <span class="n">boundary_setup</span><span class="o">.</span><span class="n">setup_boundary_conditions</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_point_sensors</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s2">&quot;far_field_simulation_bbox&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_solver_settings</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Common settings applied.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalize_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gathers all necessary entities for a far-field simulation and calls the shared</span>
<span class="sd">        finalization method from the base class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s2">&quot;far_field_simulation_bbox&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bbox_entity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find &#39;far_field_simulation_bbox&#39; for voxelization.&quot;</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">XCoreModeling</span>
        <span class="n">phantom_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">XCoreModeling</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">)]</span>
        <span class="n">point_sensor_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;Point Sensor Entity&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">]</span>

        <span class="n">all_simulation_parts</span> <span class="o">=</span> <span class="n">phantom_entities</span> <span class="o">+</span> <span class="p">[</span><span class="n">bbox_entity</span><span class="p">]</span> <span class="o">+</span> <span class="n">point_sensor_entities</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalize_setup</span><span class="p">(</span><span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">all_simulation_parts</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.far_field_setup.FarFieldSetup.run_full_setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_full_setup</span><span class="p">(</span><span class="n">phantom_setup</span><span class="p">)</span></code>

<a href="#src.setups.far_field_setup.FarFieldSetup.run_full_setup" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Executes the full sequence of setup steps for a single far-field simulation.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\far_field_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_full_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_setup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the full sequence of setup steps for a single far-field simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Setting up single Far-Field sim ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

    <span class="c1"># The phantom is now loaded once per project in the study.</span>
    <span class="c1"># This setup will just add a simulation to the currently open project.</span>
    <span class="n">bbox_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_or_get_simulation_bbox</span><span class="p">()</span>

    <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_simulation_entity</span><span class="p">(</span><span class="n">bbox_entity</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_apply_common_settings</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simulation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.gridding_setup" class="doc doc-heading">
            <code>gridding_setup</code>


<a href="#src.setups.gridding_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.gridding_setup.GriddingSetup" class="doc doc-heading">
            <code>GriddingSetup</code>


<a href="#src.setups.gridding_setup.GriddingSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src\setups\gridding_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GriddingSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span> <span class="o">=</span> <span class="n">antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>

        <span class="kn">import</span> <span class="nn">s4l_v1.units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">units</span>

    <span class="k">def</span> <span class="nf">setup_gridding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the gridding for the simulation. If antenna_components are provided,</span>
<span class="sd">        it will also set up the subgrids for the antenna.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up gridding...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_main_grid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">antenna_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_subgrids</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - No antenna components provided, skipping subgridding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_main_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the main grid based on the overall simulation bounding box,</span>
<span class="sd">        including global gridding mode, padding, and resolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gridding_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_gridding_parameters</span><span class="p">()</span>
        <span class="n">global_gridding_params</span> <span class="o">=</span> <span class="n">gridding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;global_gridding&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">gridding_mode</span> <span class="o">=</span> <span class="n">global_gridding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;automatic&quot;</span><span class="p">)</span>

        <span class="c1"># Determine the name of the simulation bounding box</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_freespace&quot;</span><span class="p">):</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="s2">&quot;freespace_simulation_bbox&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">:</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_simulation_bbox&quot;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Far-field case</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="s2">&quot;far_field_simulation_bbox&quot;</span>

        <span class="c1"># Find the bounding box entity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Looking for global grid bounding box: &#39;</span><span class="si">{</span><span class="n">sim_bbox_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="n">sim_bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_bbox_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sim_bbox_entity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find simulation bounding box: &#39;</span><span class="si">{</span><span class="n">sim_bbox_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Apply global grid settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalGridSettings</span><span class="o">.</span><span class="n">BoundingBox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">sim_bbox_entity</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">gridding_mode</span> <span class="o">==</span> <span class="s2">&quot;automatic&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using automatic gridding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalGridSettings</span><span class="o">.</span><span class="n">DiscretizationMode</span> <span class="o">=</span> <span class="s1">&#39;Automatic&#39;</span>

            <span class="c1"># Add the required grid object for the simulation box</span>
            <span class="n">added_grid_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddAutomaticGridSettings</span><span class="p">([</span><span class="n">sim_bbox_entity</span><span class="p">])</span>

            <span class="c1"># Map user-friendly refinement names to Sim4Life enums</span>
            <span class="n">refinement_mapping</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Very Fine&quot;</span><span class="p">:</span> <span class="s2">&quot;AutoRefinementVeryFine&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Fine&quot;</span><span class="p">:</span> <span class="s2">&quot;AutoRefinementFine&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;AutoRefinementDefault&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Coarse&quot;</span><span class="p">:</span> <span class="s2">&quot;AutoRefinementCoarse&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Very Coarse&quot;</span><span class="p">:</span> <span class="s2">&quot;AutoRefinementVeryCoarse&quot;</span>
            <span class="p">}</span>

            <span class="c1"># Set refinement based on config, with a default value</span>
            <span class="n">user_refinement_level</span> <span class="o">=</span> <span class="n">global_gridding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;refinement&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">)</span>
            <span class="n">s4l_refinement_level</span> <span class="o">=</span> <span class="n">refinement_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_refinement_level</span><span class="p">,</span> <span class="s2">&quot;AutoRefinementDefault&quot;</span><span class="p">)</span>

            <span class="c1"># Apply the same setting to both the global and the added grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalGridSettings</span><span class="o">.</span><span class="n">AutoRefinement</span> <span class="o">=</span> <span class="n">s4l_refinement_level</span>
            <span class="n">added_grid_settings</span><span class="o">.</span><span class="n">AutoRefinement</span> <span class="o">=</span> <span class="n">s4l_refinement_level</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Global and added automatic grid set with refinement level: </span><span class="si">{</span><span class="n">user_refinement_level</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">s4l_refinement_level</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">gridding_mode</span> <span class="o">==</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using manual gridding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalGridSettings</span><span class="o">.</span><span class="n">DiscretizationMode</span> <span class="o">=</span> <span class="s1">&#39;Manual&#39;</span>

            <span class="c1"># Add the required grid object for the simulation box</span>
            <span class="n">added_manual_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddManualGridSettings</span><span class="p">([</span><span class="n">sim_bbox_entity</span><span class="p">])</span>

            <span class="n">global_grid_res_mm</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">log_source</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

            <span class="c1"># Try to get per-frequency gridding first</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">:</span>
                <span class="n">per_freq_gridding</span> <span class="o">=</span> <span class="n">gridding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;global_gridding_per_frequency&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">per_freq_gridding</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">per_freq_gridding</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">freq_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">freq_key</span> <span class="ow">in</span> <span class="n">per_freq_gridding</span><span class="p">:</span>
                        <span class="n">global_grid_res_mm</span> <span class="o">=</span> <span class="n">per_freq_gridding</span><span class="p">[</span><span class="n">freq_key</span><span class="p">]</span>
                        <span class="n">log_source</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;frequency-specific (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz)&quot;</span>

            <span class="c1"># Fallback to global gridding if per-frequency is not found</span>
            <span class="k">if</span> <span class="n">global_grid_res_mm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">global_grid_res_mm</span> <span class="o">=</span> <span class="n">global_gridding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual_fallback_max_step_mm&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
                <span class="n">log_source</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>

            <span class="n">max_step_setting</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">global_grid_res_mm</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MilliMeters</span><span class="p">)</span>

            <span class="c1"># Apply the same setting to both the global and the added grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalGridSettings</span><span class="o">.</span><span class="n">MaxStep</span> <span class="o">=</span> <span class="n">max_step_setting</span>
            <span class="n">added_manual_grid</span><span class="o">.</span><span class="n">MaxStep</span> <span class="o">=</span> <span class="n">max_step_setting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Global and added manual grid set with </span><span class="si">{</span><span class="n">log_source</span><span class="si">}</span><span class="s2"> resolution: </span><span class="si">{</span><span class="n">global_grid_res_mm</span><span class="si">}</span><span class="s2"> mm.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported gridding_mode: </span><span class="si">{</span><span class="n">gridding_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Setup Padding</span>
        <span class="n">padding_params</span> <span class="o">=</span> <span class="n">gridding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;padding&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">padding_mode</span> <span class="o">=</span> <span class="n">padding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;padding_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;automatic&quot;</span><span class="p">)</span>
        <span class="n">global_grid_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">GlobalGridSettings</span>

        <span class="k">if</span> <span class="n">padding_mode</span> <span class="o">==</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using manual padding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">global_grid_settings</span><span class="o">.</span><span class="n">PaddingMode</span> <span class="o">=</span> <span class="n">global_grid_settings</span><span class="o">.</span><span class="n">PaddingMode</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">Manual</span>

            <span class="n">bottom_padding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">padding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual_bottom_padding_mm&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">top_padding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">padding_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual_top_padding_mm&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>

            <span class="n">global_grid_settings</span><span class="o">.</span><span class="n">BottomPadding</span> <span class="o">=</span> <span class="n">bottom_padding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MilliMeters</span>
            <span class="n">global_grid_settings</span><span class="o">.</span><span class="n">TopPadding</span> <span class="o">=</span> <span class="n">top_padding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MilliMeters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Manual padding set: Bottom=</span><span class="si">{</span><span class="n">bottom_padding</span><span class="si">}</span><span class="s2">mm, Top=</span><span class="si">{</span><span class="n">top_padding</span><span class="si">}</span><span class="s2">mm&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using automatic padding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">global_grid_settings</span><span class="o">.</span><span class="n">PaddingMode</span> <span class="o">=</span> <span class="n">global_grid_settings</span><span class="o">.</span><span class="n">PaddingMode</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">Automatic</span>

    <span class="k">def</span> <span class="nf">_setup_subgrids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">):</span>
        <span class="c1"># Antenna-specific gridding</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - No antenna provided, skipping subgridding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">antenna_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_config_for_frequency</span><span class="p">()</span>
        <span class="n">gridding_config</span> <span class="o">=</span> <span class="n">antenna_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gridding&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gridding_config</span><span class="p">:</span>
            <span class="c1"># Automatic settings</span>
            <span class="n">automatic_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">antenna_components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">gridding_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;automatic&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">antenna_components</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">automatic_components</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddAutomaticGridSettings</span><span class="p">(</span><span class="n">automatic_components</span><span class="p">)</span>

            <span class="c1"># Manual settings</span>
            <span class="n">manual_grid_step</span> <span class="o">=</span> <span class="n">gridding_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual_grid_step&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">gridding_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resolution&quot;</span><span class="p">,</span> <span class="p">{})</span>

            <span class="k">for</span> <span class="n">grid_type</span><span class="p">,</span> <span class="n">comp_names</span> <span class="ow">in</span> <span class="n">gridding_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">components_to_grid</span> <span class="o">=</span> <span class="p">[</span><span class="n">antenna_components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">comp_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">antenna_components</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">components_to_grid</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">grid_type</span> <span class="ow">in</span> <span class="n">manual_grid_step</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="n">manual_grid_step</span><span class="p">[</span><span class="n">grid_type</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">geom_res</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">grid_type</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span> <span class="o">==</span> <span class="s2">&quot;by_cheek&quot;</span><span class="p">:</span>
                        <span class="n">oriented_res</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res</span><span class="p">]</span>
                        <span class="n">oriented_geom_res</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom_res</span><span class="p">,</span> <span class="n">geom_res</span><span class="p">,</span> <span class="n">geom_res</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">oriented_res</span> <span class="o">=</span> <span class="n">res</span>
                        <span class="n">oriented_geom_res</span> <span class="o">=</span> <span class="n">geom_res</span>

                    <span class="n">manual_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddManualGridSettings</span><span class="p">(</span><span class="n">components_to_grid</span><span class="p">)</span>
                    <span class="n">manual_grid</span><span class="o">.</span><span class="n">MaxStep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">oriented_res</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MilliMeters</span>
                    <span class="n">manual_grid</span><span class="o">.</span><span class="n">Resolution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">oriented_geom_res</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MilliMeters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_entity</span> <span class="o">=</span> <span class="n">antenna_components</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_source_entity_name</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddAutomaticGridSettings</span><span class="p">([</span><span class="n">source_entity</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.gridding_setup.GriddingSetup.setup_gridding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_gridding</span><span class="p">(</span><span class="n">antenna_components</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.setups.gridding_setup.GriddingSetup.setup_gridding" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Sets up the gridding for the simulation. If antenna_components are provided,
it will also set up the subgrids for the antenna.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\gridding_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_gridding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up the gridding for the simulation. If antenna_components are provided,</span>
<span class="sd">    it will also set up the subgrids for the antenna.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up gridding...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_main_grid</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">antenna_components</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_subgrids</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - No antenna components provided, skipping subgridding.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.material_setup" class="doc doc-heading">
            <code>material_setup</code>


<a href="#src.setups.material_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.material_setup.MaterialSetup" class="doc doc-heading">
            <code>MaterialSetup</code>


<a href="#src.setups.material_setup.MaterialSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src\setups\material_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MaterialSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">free_space</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span> <span class="o">=</span> <span class="n">antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="o">=</span> <span class="n">free_space</span>

        <span class="kn">import</span> <span class="nn">s4l_v1.materials.database</span>
        <span class="kn">import</span> <span class="nn">XCoreModeling</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span> <span class="o">=</span> <span class="n">XCoreModeling</span>

    <span class="k">def</span> <span class="nf">assign_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phantom_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns materials to the simulation entities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Assigning materials...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="c1"># Background material</span>
        <span class="n">background_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">BackgroundMaterialSettings</span><span class="p">()</span>
        <span class="n">air_material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="s2">&quot;Generic 1.1&quot;</span><span class="p">][</span><span class="s2">&quot;Air&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">AssignMaterial</span><span class="p">(</span><span class="n">background_settings</span><span class="p">,</span> <span class="n">air_material</span><span class="p">)</span>

        <span class="c1"># Phantom materials</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_phantom_materials</span><span class="p">()</span>

        <span class="c1"># Antenna materials</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phantom_only</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_components</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;antenna_components must be provided when not in phantom_only mode.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_antenna_materials</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_phantom_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lock_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;material_db.lock&#39;</span><span class="p">)</span>

        <span class="c1"># Acquire lock</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Use exclusive creation mode to atomically create the file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">):</span>
                    <span class="k">break</span>  <span class="c1"># Lock acquired</span>
            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Wait before retrying</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>
            <span class="n">phantom_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">)]</span>

            <span class="n">name_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_material_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">)</span>

            <span class="n">material_groups</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">phantom_parts</span><span class="p">:</span>
                <span class="n">base_name</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">material_name</span> <span class="o">=</span> <span class="n">name_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_name</span><span class="p">,</span> <span class="n">base_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
                <span class="n">material_groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">material_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">material_name</span><span class="p">,</span> <span class="n">entities</span> <span class="ow">in</span> <span class="n">material_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="s2">&quot;IT&#39;IS 4.2&quot;</span><span class="p">][</span><span class="n">material_name</span><span class="p">]</span>
                    <span class="n">material_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">MaterialSettings</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">LinkMaterialWithDatabase</span><span class="p">(</span><span class="n">material_settings</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">material_settings</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Could not find material &#39;</span><span class="si">{</span><span class="n">material_name</span><span class="si">}</span><span class="s2">&#39; in IT&#39;IS 4.2 database.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Release lock</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_antenna_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">):</span>
        <span class="n">antenna_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_config_for_frequency</span><span class="p">()</span>
        <span class="n">material_mappings</span> <span class="o">=</span> <span class="n">antenna_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;materials&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">comp_name</span><span class="p">,</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">material_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">comp_name</span> <span class="ow">in</span> <span class="n">antenna_components</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="n">antenna_components</span><span class="p">[</span><span class="n">comp_name</span><span class="p">]</span>
                <span class="n">material_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">MaterialSettings</span><span class="p">()</span>

                <span class="n">excitation_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_excitation_type</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;Copper&quot;</span> <span class="ow">in</span> <span class="n">mat_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="ow">and</span> <span class="n">excitation_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                    <span class="n">material_settings</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">&quot;PEC&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">material_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">entity</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  WARNING: Forcing material for &#39;</span><span class="si">{</span><span class="n">comp_name</span><span class="si">}</span><span class="s2">&#39; to PEC.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;           This is a required workaround because Sim4Life does not yet support&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;           Gaussian excitation with dispersive materials like Copper.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mat_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pec&#39;</span><span class="p">:</span>
                    <span class="n">material_settings</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">&quot;PEC&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">material_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">entity</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Assigned &#39;PEC&#39; to &#39;</span><span class="si">{</span><span class="n">comp_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;IT&#39;IS 4.2&quot;</span> <span class="k">if</span> <span class="s2">&quot;Rogers&quot;</span> <span class="ow">in</span> <span class="n">mat_name</span> <span class="k">else</span> <span class="s2">&quot;Generic 1.1&quot;</span>
                        <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="n">db_name</span><span class="p">][</span><span class="n">mat_name</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">LinkMaterialWithDatabase</span><span class="p">(</span><span class="n">material_settings</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">material_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">entity</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Assigned &#39;</span><span class="si">{</span><span class="n">mat_name</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">comp_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Could not find material &#39;</span><span class="si">{</span><span class="n">mat_name</span><span class="si">}</span><span class="s2">&#39; in database.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Warning: Could not find component &#39;</span><span class="si">{</span><span class="n">comp_name</span><span class="si">}</span><span class="s2">&#39; to assign material.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.material_setup.MaterialSetup.assign_materials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_materials</span><span class="p">(</span><span class="n">antenna_components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phantom_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#src.setups.material_setup.MaterialSetup.assign_materials" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Assigns materials to the simulation entities.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\material_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phantom_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns materials to the simulation entities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Assigning materials...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

    <span class="c1"># Background material</span>
    <span class="n">background_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">BackgroundMaterialSettings</span><span class="p">()</span>
    <span class="n">air_material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="s2">&quot;Generic 1.1&quot;</span><span class="p">][</span><span class="s2">&quot;Air&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">AssignMaterial</span><span class="p">(</span><span class="n">background_settings</span><span class="p">,</span> <span class="n">air_material</span><span class="p">)</span>

    <span class="c1"># Phantom materials</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_phantom_materials</span><span class="p">()</span>

    <span class="c1"># Antenna materials</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">phantom_only</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_components</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;antenna_components must be provided when not in phantom_only mode.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_antenna_materials</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.near_field_setup" class="doc doc-heading">
            <code>near_field_setup</code>


<a href="#src.setups.near_field_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.near_field_setup.NearFieldSetup" class="doc doc-heading">
            <code>NearFieldSetup</code>


<a href="#src.setups.near_field_setup.NearFieldSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>


        <p>Configures the entire simulation environment within Sim4Life by coordinating
specialized setup modules.</p>








              <details class="quote">
                <summary>Source code in <code>src\setups\near_field_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NearFieldSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configures the entire simulation environment within Sim4Life by coordinating</span>
<span class="sd">    specialized setup modules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">free_space</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span> <span class="o">=</span> <span class="n">antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="o">=</span> <span class="n">free_space</span>

        <span class="k">if</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;front_of_eyes&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="s1">&#39;front_of_eyes&#39;</span>
        <span class="k">elif</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="s1">&#39;by_cheek&#39;</span>
        <span class="k">elif</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_belly&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="s1">&#39;by_belly&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>

        <span class="c1"># S4L modules</span>
        <span class="kn">import</span> <span class="nn">XCoreModeling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span> <span class="o">=</span> <span class="n">XCoreModeling</span>

    <span class="k">def</span> <span class="nf">run_full_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the full sequence of setup steps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Running full simulation setup...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="c1"># Create or open the project file. This is the first step.</span>
        <span class="n">project_manager</span><span class="o">.</span><span class="n">create_or_open_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="n">phantom_setup</span> <span class="o">=</span> <span class="n">PhantomSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>
            <span class="n">phantom_setup</span><span class="o">.</span><span class="n">ensure_phantom_is_loaded</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_bounding_boxes</span><span class="p">()</span>

        <span class="n">placement_setup</span> <span class="o">=</span> <span class="n">PlacementSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">)</span>
        <span class="n">placement_setup</span><span class="o">.</span><span class="n">place_antenna</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_simulation_bbox</span><span class="p">()</span>

        <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_simulation_entity</span><span class="p">()</span>

        <span class="n">antenna_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_antenna_components</span><span class="p">()</span>

        <span class="n">material_setup</span> <span class="o">=</span> <span class="n">MaterialSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">)</span>
        <span class="n">material_setup</span><span class="o">.</span><span class="n">assign_materials</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

        <span class="n">gridding_setup</span> <span class="o">=</span> <span class="n">GriddingSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
        <span class="n">gridding_setup</span><span class="o">.</span><span class="n">setup_gridding</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

        <span class="n">boundary_setup</span> <span class="o">=</span> <span class="n">BoundarySetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>
        <span class="n">boundary_setup</span><span class="o">.</span><span class="n">setup_boundary_conditions</span><span class="p">()</span>

        <span class="n">source_setup</span> <span class="o">=</span> <span class="n">SourceSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">)</span>
        <span class="n">source_setup</span><span class="o">.</span><span class="n">setup_source_and_sensors</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

        <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_simulation_bbox&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_point_sensors</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">sim_bbox_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_setup</span><span class="p">(</span><span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Full simulation setup complete.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">simulation</span>

    <span class="k">def</span> <span class="nf">_get_antenna_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The antenna group name changes during placement. We need to find it regardless of its state.</span>
        <span class="c1"># Initial name: &quot;Antenna {freq} MHz&quot;</span>
        <span class="c1"># Placed name:  &quot;Antenna {freq} MHz (Placement)&quot;</span>

        <span class="n">placed_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Antenna </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2"> MHz (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">initial_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Antenna </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2"> MHz&quot;</span>

        <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>

        <span class="n">antenna_group</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">placed_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_group</span><span class="p">:</span>
            <span class="n">antenna_group</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">initial_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_group</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find antenna group. Looked for &#39;</span><span class="si">{</span><span class="n">placed_name</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">initial_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

        <span class="n">flat_component_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">antenna_group</span><span class="o">.</span><span class="n">Entities</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s1">&#39;History&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;Union&quot;</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">History</span><span class="p">:</span>
                <span class="n">flat_component_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">GetChildren</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flat_component_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">:</span> <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">flat_component_list</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_setup_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the head and trunk bounding boxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up bounding boxes...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>

        <span class="n">phantom_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_phantom_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phantom_config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>

        <span class="n">head_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_Head_BBox&quot;</span>
        <span class="n">trunk_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_Trunk_BBox&quot;</span>

        <span class="n">entities_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">head_bbox_name</span><span class="p">,</span> <span class="n">trunk_bbox_name</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities_to_delete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Deleting existing entity: </span><span class="si">{</span><span class="n">entity</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">Delete</span><span class="p">()</span>

        <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>
        <span class="n">tissue_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">)]</span>
        <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">(</span><span class="n">tissue_entities</span><span class="p">)</span>

        <span class="c1"># Head BBox</span>
        <span class="n">ear_skin_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s2">&quot;Ear_skin&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ear_skin_entity</span><span class="p">:</span>
            <span class="n">head_x_min</span><span class="p">,</span> <span class="n">head_x_max</span> <span class="o">=</span> <span class="n">bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ear_bbox_min</span><span class="p">,</span> <span class="n">ear_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">ear_skin_entity</span><span class="p">])</span>
            <span class="n">head_x_min</span><span class="p">,</span> <span class="n">head_x_max</span> <span class="o">=</span> <span class="n">ear_bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ear_bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">head_y_sep</span> <span class="o">=</span> <span class="n">phantom_config</span><span class="p">[</span><span class="s1">&#39;head_y_separation&#39;</span><span class="p">]</span>
        <span class="n">back_of_head_y</span> <span class="o">=</span> <span class="n">phantom_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;back_of_head&#39;</span><span class="p">,</span> <span class="n">bbox_min</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">head_bbox_min_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">head_x_min</span><span class="p">,</span> <span class="n">back_of_head_y</span><span class="p">,</span> <span class="n">head_y_sep</span><span class="p">)</span>
        <span class="n">head_bbox_max_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">head_x_max</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">head_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">CreateWireBlock</span><span class="p">(</span><span class="n">head_bbox_min_vec</span><span class="p">,</span> <span class="n">head_bbox_max_vec</span><span class="p">)</span>
        <span class="n">head_bbox</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">head_bbox_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Head BBox created.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="c1"># Trunk BBox</span>
        <span class="n">trunk_z_sep</span> <span class="o">=</span> <span class="n">phantom_config</span><span class="p">[</span><span class="s1">&#39;trunk_z_separation&#39;</span><span class="p">]</span>
        <span class="n">chest_y_ext</span> <span class="o">=</span> <span class="n">phantom_config</span><span class="p">[</span><span class="s1">&#39;chest_extension&#39;</span><span class="p">]</span>
        <span class="n">trunk_bbox_min_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trunk_z_sep</span><span class="p">)</span>
        <span class="n">trunk_bbox_max_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chest_y_ext</span><span class="p">,</span> <span class="n">head_y_sep</span><span class="p">)</span>
        <span class="n">trunk_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">CreateWireBlock</span><span class="p">(</span><span class="n">trunk_bbox_min_vec</span><span class="p">,</span> <span class="n">trunk_bbox_max_vec</span><span class="p">)</span>
        <span class="n">trunk_bbox</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">trunk_bbox_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Trunk BBox created.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_simulation_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="n">antenna_bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;Antenna bounding box&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">antenna_bbox_min</span><span class="p">,</span> <span class="n">antenna_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">antenna_bbox_entity</span><span class="p">])</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_freespace_expansion</span><span class="p">()</span>
            <span class="n">sim_bbox_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">antenna_bbox_min</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
            <span class="n">sim_bbox_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">antenna_bbox_max</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
            <span class="n">sim_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">CreateWireBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">sim_bbox_min</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">sim_bbox_max</span><span class="p">))</span>
            <span class="n">sim_bbox</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;freespace_simulation_bbox&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Created free-space simulation BBox.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">antenna_bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;Antenna bounding box&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;front_of_eyes&#39;</span><span class="p">,</span> <span class="s1">&#39;by_cheek&#39;</span><span class="p">]:</span>
                <span class="n">bbox_to_combine_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_Head_BBox&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bbox_to_combine_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_Trunk_BBox&quot;</span>

            <span class="n">bbox_to_combine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()[</span><span class="n">bbox_to_combine_name</span><span class="p">]</span>

            <span class="n">combined_bbox_min</span><span class="p">,</span> <span class="n">combined_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">bbox_to_combine</span><span class="p">,</span> <span class="n">antenna_bbox_entity</span><span class="p">])</span>
            <span class="n">sim_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">CreateWireBlock</span><span class="p">(</span><span class="n">combined_bbox_min</span><span class="p">,</span> <span class="n">combined_bbox_max</span><span class="p">)</span>
            <span class="n">sim_bbox</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_simulation_bbox&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Combined BBox created for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_simulation_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and configures the base EM-FDTD simulation entity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up simulation entity...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

        <span class="n">sim_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EM_FDTD_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="n">sim_name</span> <span class="o">+=</span> <span class="s2">&quot;_freespace&quot;</span>
        <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">Simulation</span><span class="p">()</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">sim_name</span>

        <span class="kn">import</span> <span class="nn">s4l_v1.units</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">Frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_solver_settings</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="s2">&quot;freespace_simulation_bbox&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_simulation_bbox&quot;</span>

        <span class="n">sim_bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_bbox_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sim_bbox_entity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find simulation bounding box: &#39;</span><span class="si">{</span><span class="n">sim_bbox_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_simulation_time_and_termination</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">sim_bbox_entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simulation</span>

    <span class="k">def</span> <span class="nf">_finalize_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">):</span>
        <span class="n">all_antenna_parts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">antenna_components</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">point_sensor_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;Point Sensor Entity&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="s2">&quot;freespace_simulation_bbox&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_simulation_bbox&quot;</span>

        <span class="n">sim_bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_bbox_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sim_bbox_entity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find simulation bounding box: &#39;</span><span class="si">{</span><span class="n">sim_bbox_name</span><span class="si">}</span><span class="s2">&#39; for voxelization.&quot;</span><span class="p">)</span>

        <span class="n">phantom_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">)]</span>
        <span class="n">all_simulation_parts</span> <span class="o">=</span> <span class="n">phantom_entities</span> <span class="o">+</span> <span class="n">all_antenna_parts</span> <span class="o">+</span> <span class="n">point_sensor_entities</span> <span class="o">+</span> <span class="p">[</span><span class="n">sim_bbox_entity</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalize_setup</span><span class="p">(</span><span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">all_simulation_parts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.near_field_setup.NearFieldSetup.run_full_setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_full_setup</span><span class="p">(</span><span class="n">project_manager</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.setups.near_field_setup.NearFieldSetup.run_full_setup" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Executes the full sequence of setup steps.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\near_field_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_full_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_manager</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the full sequence of setup steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Running full simulation setup...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

    <span class="c1"># Create or open the project file. This is the first step.</span>
    <span class="n">project_manager</span><span class="o">.</span><span class="n">create_or_open_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
        <span class="n">phantom_setup</span> <span class="o">=</span> <span class="n">PhantomSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>
        <span class="n">phantom_setup</span><span class="o">.</span><span class="n">ensure_phantom_is_loaded</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_bounding_boxes</span><span class="p">()</span>

    <span class="n">placement_setup</span> <span class="o">=</span> <span class="n">PlacementSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">)</span>
    <span class="n">placement_setup</span><span class="o">.</span><span class="n">place_antenna</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_create_simulation_bbox</span><span class="p">()</span>

    <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_simulation_entity</span><span class="p">()</span>

    <span class="n">antenna_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_antenna_components</span><span class="p">()</span>

    <span class="n">material_setup</span> <span class="o">=</span> <span class="n">MaterialSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">)</span>
    <span class="n">material_setup</span><span class="o">.</span><span class="n">assign_materials</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

    <span class="n">gridding_setup</span> <span class="o">=</span> <span class="n">GriddingSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">)</span>
    <span class="n">gridding_setup</span><span class="o">.</span><span class="n">setup_gridding</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

    <span class="n">boundary_setup</span> <span class="o">=</span> <span class="n">BoundarySetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>
    <span class="n">boundary_setup</span><span class="o">.</span><span class="n">setup_boundary_conditions</span><span class="p">()</span>

    <span class="n">source_setup</span> <span class="o">=</span> <span class="n">SourceSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">)</span>
    <span class="n">source_setup</span><span class="o">.</span><span class="n">setup_source_and_sensors</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span>

    <span class="n">sim_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_simulation_bbox&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_point_sensors</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">sim_bbox_name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_setup</span><span class="p">(</span><span class="n">project_manager</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Full simulation setup complete.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">simulation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.phantom_setup" class="doc doc-heading">
            <code>phantom_setup</code>


<a href="#src.setups.phantom_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.phantom_setup.PhantomSetup" class="doc doc-heading">
            <code>PhantomSetup</code>


<a href="#src.setups.phantom_setup.PhantomSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src\setups\phantom_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PhantomSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>

        <span class="kn">import</span> <span class="nn">s4l_v1.model</span>
        <span class="kn">import</span> <span class="nn">s4l_v1.data</span>
        <span class="kn">import</span> <span class="nn">XCoreModeling</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span> <span class="o">=</span> <span class="n">XCoreModeling</span>

    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="n">log_type</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">ensure_phantom_is_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures the phantom model is loaded into the current document.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Running Phantom Check ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
        <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_entities</span><span class="p">)</span><span class="si">}</span><span class="s2"> total entities in the project.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">is_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_entities</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">):</span>
                <span class="n">entity_name_lower</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">phantom_name_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">phantom_name_lower</span> <span class="ow">in</span> <span class="n">entity_name_lower</span><span class="p">:</span>
                    <span class="n">is_loaded</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Entity </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: (No &#39;Name&#39; attribute)&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Phantom Check Result: Phantom model is already present. ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Phantom Check Result: Phantom not found in project. ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

        <span class="n">study_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span> <span class="ow">or</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
            <span class="n">sab_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;phantoms&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">.sab&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sab_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phantom not found in document. Importing from &#39;</span><span class="si">{</span><span class="n">sab_path</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">Import</span><span class="p">(</span><span class="n">sab_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Phantom imported successfully.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Local .sab file not found. Attempting to download &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">available_downloads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">GetAvailableDownloads</span><span class="p">()</span>
            <span class="n">phantom_to_download</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">available_downloads</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">phantom_to_download</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phantom &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39; not found for download or in local files.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found &#39;</span><span class="si">{</span><span class="n">phantom_to_download</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;. Downloading...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">download_email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;download_email&#39;</span><span class="p">,</span> <span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DownloadModel</span><span class="p">(</span><span class="n">phantom_to_download</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">download_email</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;phantoms&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Phantom downloaded successfully. Please re-run the script to import the new .sab file.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown study type: </span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.phantom_setup.PhantomSetup.ensure_phantom_is_loaded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_phantom_is_loaded</span><span class="p">()</span></code>

<a href="#src.setups.phantom_setup.PhantomSetup.ensure_phantom_is_loaded" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Ensures the phantom model is loaded into the current document.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\phantom_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_phantom_is_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures the phantom model is loaded into the current document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Running Phantom Check ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
    <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_entities</span><span class="p">)</span><span class="si">}</span><span class="s2"> total entities in the project.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

    <span class="n">is_loaded</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_entities</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">):</span>
            <span class="n">entity_name_lower</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">phantom_name_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">phantom_name_lower</span> <span class="ow">in</span> <span class="n">entity_name_lower</span><span class="p">:</span>
                <span class="n">is_loaded</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Entity </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: (No &#39;Name&#39; attribute)&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Phantom Check Result: Phantom model is already present. ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Phantom Check Result: Phantom not found in project. ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

    <span class="n">study_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_type&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span> <span class="ow">or</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;far_field&#39;</span><span class="p">:</span>
        <span class="n">sab_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;phantoms&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">.sab&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sab_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phantom not found in document. Importing from &#39;</span><span class="si">{</span><span class="n">sab_path</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XCoreModeling</span><span class="o">.</span><span class="n">Import</span><span class="p">(</span><span class="n">sab_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Phantom imported successfully.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Local .sab file not found. Attempting to download &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">available_downloads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">GetAvailableDownloads</span><span class="p">()</span>
        <span class="n">phantom_to_download</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">available_downloads</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">phantom_to_download</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phantom &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39; not found for download or in local files.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found &#39;</span><span class="si">{</span><span class="n">phantom_to_download</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;. Downloading...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">download_email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;download_email&#39;</span><span class="p">,</span> <span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DownloadModel</span><span class="p">(</span><span class="n">phantom_to_download</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">download_email</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;phantoms&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Phantom downloaded successfully. Please re-run the script to import the new .sab file.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown study type: </span><span class="si">{</span><span class="n">study_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.placement_setup" class="doc doc-heading">
            <code>placement_setup</code>


<a href="#src.setups.placement_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.placement_setup.PlacementSetup" class="doc doc-heading">
            <code>PlacementSetup</code>


<a href="#src.setups.placement_setup.PlacementSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src\setups\placement_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PlacementSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">free_space</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span> <span class="o">=</span> <span class="n">phantom_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span> <span class="o">=</span> <span class="n">antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="o">=</span> <span class="n">free_space</span>

        <span class="c1"># Parse the detailed placement name, e.g., &quot;front_of_eyes_center_vertical&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;front_of_eyes&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="s1">&#39;front_of_eyes&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="s1">&#39;by_cheek&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_belly&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="s1">&#39;by_belly&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Fallback for old single placement names or unknown format</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_name</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># Fallback for old single placement names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">=</span> <span class="n">placement_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_name</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

        <span class="kn">import</span> <span class="nn">XCoreMath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span> <span class="o">=</span> <span class="n">XCoreMath</span>

    <span class="k">def</span> <span class="nf">place_antenna</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Places and orients the antenna by composing a single transformation matrix</span>
<span class="sd">        and applying it once.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Placement: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">position_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="n">placements_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_phantom_placements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;do_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placement &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2">&#39; is disabled in the configuration.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">base_target_point</span><span class="p">,</span> <span class="n">orientation_rotations</span><span class="p">,</span> <span class="n">position_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_placement_details</span><span class="p">()</span>

        <span class="c1"># Import antenna model</span>
        <span class="n">antenna_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_centered_antenna_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;antennas&#39;</span><span class="p">,</span> <span class="s1">&#39;centered&#39;</span><span class="p">))</span>
        <span class="n">imported_entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Import</span><span class="p">(</span><span class="n">antenna_path</span><span class="p">))</span>

        <span class="n">antenna_group</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">imported_entities</span> <span class="k">if</span> <span class="s2">&quot;Antenna&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="ow">and</span> <span class="s2">&quot;bounding box&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">imported_entities</span> <span class="k">if</span> <span class="s2">&quot;bounding box&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_group</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find imported antenna group.&quot;</span><span class="p">)</span>

        <span class="c1"># Rename the entities to include the placement name for uniqueness</span>
        <span class="n">antenna_group</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">antenna_group</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="n">bbox_entity</span><span class="p">:</span>
            <span class="n">bbox_entity</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bbox_entity</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="n">entities_to_transform</span> <span class="o">=</span> <span class="p">[</span><span class="n">antenna_group</span><span class="p">,</span> <span class="n">bbox_entity</span><span class="p">]</span> <span class="k">if</span> <span class="n">bbox_entity</span> <span class="k">else</span> <span class="p">[</span><span class="n">antenna_group</span><span class="p">]</span>

        <span class="c1"># --- Transformation Composition ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Composing final transformation...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="c1"># Start with an identity transform</span>
        <span class="n">final_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Transform</span><span class="p">()</span>

        <span class="c1"># 1. Stand-up Rotation</span>
        <span class="n">rot_stand_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="p">))</span>
        <span class="n">final_transform</span> <span class="o">=</span> <span class="n">rot_stand_up</span> <span class="o">*</span> <span class="n">final_transform</span>

        <span class="c1"># Special rotation for &#39;by_cheek&#39; to align with YZ plane</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Applying &#39;by_cheek&#39; specific Z-rotation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">rot_z_cheek</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">))</span>
            <span class="n">final_transform</span> <span class="o">=</span> <span class="n">rot_z_cheek</span> <span class="o">*</span> <span class="n">final_transform</span>

        <span class="c1"># 2. Orientation Twist</span>
        <span class="k">if</span> <span class="n">orientation_rotations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rot</span> <span class="ow">in</span> <span class="n">orientation_rotations</span><span class="p">:</span>
                <span class="n">axis_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
                <span class="n">rot_twist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span><span class="n">axis_map</span><span class="p">[</span><span class="n">rot</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rot</span><span class="p">[</span><span class="s1">&#39;angle_deg&#39;</span><span class="p">]))</span>
                <span class="n">final_transform</span> <span class="o">=</span> <span class="n">rot_twist</span> <span class="o">*</span> <span class="n">final_transform</span>

        <span class="c1"># 3. Final Translation</span>
        <span class="n">final_target_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_offset</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">translation_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Translation</span><span class="p">(</span><span class="n">final_target_point</span><span class="p">)</span>
        <span class="n">final_transform</span> <span class="o">=</span> <span class="n">translation_transform</span> <span class="o">*</span> <span class="n">final_transform</span>

        <span class="c1"># --- Apply the single, composed transform ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Applying final composed transform.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities_to_transform</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">ApplyTransform</span><span class="p">(</span><span class="n">final_transform</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Transformation Sequence Complete ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_placement_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the base target point, position offset, and orientation rotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_placement_scenario</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scenario</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placement scenario &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2">&#39; not defined.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
            <span class="n">position_offset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">position_offset</span> <span class="o">=</span> <span class="n">scenario</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_name</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">orientation_rotations</span> <span class="o">=</span> <span class="n">scenario</span><span class="p">[</span><span class="s1">&#39;orientations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">all_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">AllEntities</span><span class="p">()</span>
        <span class="n">placements_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_phantom_placements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">base_target_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">==</span> <span class="s1">&#39;front_of_eyes&#39;</span><span class="p">:</span>
            <span class="n">eye_entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="s1">&#39;Eye&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="ow">or</span> <span class="s1">&#39;Cornea&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">eye_entities</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No eye or cornea entities found for &#39;Eyes&#39; placement.&quot;</span><span class="p">)</span>
            <span class="n">eye_bbox_min</span><span class="p">,</span> <span class="n">eye_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">(</span><span class="n">eye_entities</span><span class="p">)</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance_from_eye&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">eye_bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eye_bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eye_bbox_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">eye_bbox_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">eye_bbox_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
            <span class="c1"># Find ear and mouth entities</span>
            <span class="n">ear_skin</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s2">&quot;Ear_skin&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mouth_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s2">&quot;Tongue&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ear_skin</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mouth_entity</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not find &#39;Ear_skin&#39; or &#39;Tongue&#39; entities for &#39;Cheek&#39; placement.&quot;</span><span class="p">)</span>

            <span class="c1"># Get center points</span>
            <span class="n">ear_bbox_min</span><span class="p">,</span> <span class="n">ear_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">ear_skin</span><span class="p">])</span>
            <span class="n">mouth_bbox_min</span><span class="p">,</span> <span class="n">mouth_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">mouth_entity</span><span class="p">])</span>

            <span class="n">ear_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span>
                <span class="p">(</span><span class="n">ear_bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ear_bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="p">(</span><span class="n">ear_bbox_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ear_bbox_max</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="p">(</span><span class="n">ear_bbox_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ear_bbox_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="p">)</span>
            <span class="n">mouth_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span>
                <span class="p">(</span><span class="n">mouth_bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">mouth_bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="p">(</span><span class="n">mouth_bbox_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">mouth_bbox_max</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="p">(</span><span class="n">mouth_bbox_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">mouth_bbox_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="p">)</span>

            <span class="c1"># Calculate angle for base alignment</span>
            <span class="n">direction_vector</span> <span class="o">=</span> <span class="n">mouth_center</span> <span class="o">-</span> <span class="n">ear_center</span>
            <span class="c1"># Angle in YZ plane is rotation around X-axis</span>
            <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">direction_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">direction_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">angle_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>

            <span class="c1"># The phone should be perpendicular to this line, so add 90 degrees</span>
            <span class="n">base_rotation_deg</span> <span class="o">=</span> <span class="n">angle_deg</span> <span class="o">+</span> <span class="mi">90</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculated base rotation for cheek alignment: </span><span class="si">{</span><span class="n">base_rotation_deg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> degrees around X-axis.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

            <span class="c1"># Add this as a new base rotation</span>
            <span class="n">base_rotation</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;angle_deg&quot;</span><span class="p">:</span> <span class="n">base_rotation_deg</span><span class="p">}</span>
            <span class="n">orientation_rotations</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">base_rotation</span><span class="p">)</span>

            <span class="c1"># Set the target point based on the ear</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance_from_cheek&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ear_bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ear_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ear_center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span> <span class="o">==</span> <span class="s1">&#39;by_belly&#39;</span><span class="p">:</span>
            <span class="n">trunk_bbox_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_Trunk_BBox&quot;</span>
            <span class="n">trunk_bbox</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">all_entities</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">trunk_bbox_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">trunk_bbox</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find &#39;</span><span class="si">{</span><span class="n">trunk_bbox_name</span><span class="si">}</span><span class="s2">&#39; entity for &#39;Belly&#39; placement.&quot;</span><span class="p">)</span>

            <span class="n">belly_bbox_min</span><span class="p">,</span> <span class="n">belly_bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">GetBoundingBox</span><span class="p">([</span><span class="n">trunk_bbox</span><span class="p">])</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distance_from_belly&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">belly_bbox_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">belly_bbox_max</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">belly_bbox_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span>
            <span class="n">base_target_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">belly_bbox_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">belly_bbox_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid base placement name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">base_target_point</span><span class="p">,</span> <span class="n">orientation_rotations</span><span class="p">,</span> <span class="n">position_offset</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.placement_setup.PlacementSetup.place_antenna" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">place_antenna</span><span class="p">()</span></code>

<a href="#src.setups.placement_setup.PlacementSetup.place_antenna" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Places and orients the antenna by composing a single transformation matrix
and applying it once.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\placement_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">place_antenna</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Places and orients the antenna by composing a single transformation matrix</span>
<span class="sd">    and applying it once.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Placement: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">position_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

    <span class="n">placements_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_phantom_placements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;do_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placement &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="si">}</span><span class="s2">&#39; is disabled in the configuration.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">base_target_point</span><span class="p">,</span> <span class="n">orientation_rotations</span><span class="p">,</span> <span class="n">position_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_placement_details</span><span class="p">()</span>

    <span class="c1"># Import antenna model</span>
    <span class="n">antenna_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_centered_antenna_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;antennas&#39;</span><span class="p">,</span> <span class="s1">&#39;centered&#39;</span><span class="p">))</span>
    <span class="n">imported_entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Import</span><span class="p">(</span><span class="n">antenna_path</span><span class="p">))</span>

    <span class="n">antenna_group</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">imported_entities</span> <span class="k">if</span> <span class="s2">&quot;Antenna&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span> <span class="ow">and</span> <span class="s2">&quot;bounding box&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bbox_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">imported_entities</span> <span class="k">if</span> <span class="s2">&quot;bounding box&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna_group</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find imported antenna group.&quot;</span><span class="p">)</span>

    <span class="c1"># Rename the entities to include the placement name for uniqueness</span>
    <span class="n">antenna_group</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">antenna_group</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">if</span> <span class="n">bbox_entity</span><span class="p">:</span>
        <span class="n">bbox_entity</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bbox_entity</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="n">entities_to_transform</span> <span class="o">=</span> <span class="p">[</span><span class="n">antenna_group</span><span class="p">,</span> <span class="n">bbox_entity</span><span class="p">]</span> <span class="k">if</span> <span class="n">bbox_entity</span> <span class="k">else</span> <span class="p">[</span><span class="n">antenna_group</span><span class="p">]</span>

    <span class="c1"># --- Transformation Composition ---</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Composing final transformation...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

    <span class="c1"># Start with an identity transform</span>
    <span class="n">final_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Transform</span><span class="p">()</span>

    <span class="c1"># 1. Stand-up Rotation</span>
    <span class="n">rot_stand_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="p">))</span>
    <span class="n">final_transform</span> <span class="o">=</span> <span class="n">rot_stand_up</span> <span class="o">*</span> <span class="n">final_transform</span>

    <span class="c1"># Special rotation for &#39;by_cheek&#39; to align with YZ plane</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_placement_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;by_cheek&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Applying &#39;by_cheek&#39; specific Z-rotation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">rot_z_cheek</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">))</span>
        <span class="n">final_transform</span> <span class="o">=</span> <span class="n">rot_z_cheek</span> <span class="o">*</span> <span class="n">final_transform</span>

    <span class="c1"># 2. Orientation Twist</span>
    <span class="k">if</span> <span class="n">orientation_rotations</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rot</span> <span class="ow">in</span> <span class="n">orientation_rotations</span><span class="p">:</span>
            <span class="n">axis_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
            <span class="n">rot_twist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span><span class="n">axis_map</span><span class="p">[</span><span class="n">rot</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rot</span><span class="p">[</span><span class="s1">&#39;angle_deg&#39;</span><span class="p">]))</span>
            <span class="n">final_transform</span> <span class="o">=</span> <span class="n">rot_twist</span> <span class="o">*</span> <span class="n">final_transform</span>

    <span class="c1"># 3. Final Translation</span>
    <span class="n">final_target_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span>
        <span class="n">base_target_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">base_target_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">base_target_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">position_offset</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">translation_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XCoreMath</span><span class="o">.</span><span class="n">Translation</span><span class="p">(</span><span class="n">final_target_point</span><span class="p">)</span>
    <span class="n">final_transform</span> <span class="o">=</span> <span class="n">translation_transform</span> <span class="o">*</span> <span class="n">final_transform</span>

    <span class="c1"># --- Apply the single, composed transform ---</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Applying final composed transform.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities_to_transform</span><span class="p">:</span>
        <span class="n">entity</span><span class="o">.</span><span class="n">ApplyTransform</span><span class="p">(</span><span class="n">final_transform</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Transformation Sequence Complete ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.setups.source_setup" class="doc doc-heading">
            <code>source_setup</code>


<a href="#src.setups.source_setup" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.setups.source_setup.SourceSetup" class="doc doc-heading">
            <code>SourceSetup</code>


<a href="#src.setups.source_setup.SourceSetup" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSetup (src.setups.base_setup.BaseSetup)" href="#src.setups.base_setup.BaseSetup">BaseSetup</a></code></p>









              <details class="quote">
                <summary>Source code in <code>src\setups\source_setup.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SourceSetup</span><span class="p">(</span><span class="n">BaseSetup</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">frequency_mhz</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">free_space</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">=</span> <span class="n">frequency_mhz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span> <span class="o">=</span> <span class="n">antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span> <span class="o">=</span> <span class="n">free_space</span>

        <span class="kn">import</span> <span class="nn">s4l_v1.units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">units</span>

    <span class="k">def</span> <span class="nf">setup_source_and_sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the excitation source and sensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up source and sensors...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="n">source_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_source_entity_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">source_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">antenna_components</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find source entity &#39;</span><span class="si">{</span><span class="n">source_name</span><span class="si">}</span><span class="s2">&#39; in antenna group.&quot;</span><span class="p">)</span>
        <span class="n">source_entity</span> <span class="o">=</span> <span class="n">antenna_components</span><span class="p">[</span><span class="n">source_name</span><span class="p">]</span>

        <span class="c1"># Source setup</span>
        <span class="n">edge_source_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">EdgeSourceSettings</span><span class="p">()</span>

        <span class="c1"># Get the enum for ExcitationType</span>
        <span class="n">excitation_enum</span> <span class="o">=</span> <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">ExcitationType</span><span class="o">.</span><span class="n">enum</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using Gaussian source for free-space simulation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">excitation_type</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
            <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">ExcitationType</span> <span class="o">=</span> <span class="n">excitation_enum</span><span class="o">.</span><span class="n">Gaussian</span>
            <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">CenterFrequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>
            <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">Bandwidth</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using Harmonic source for phantom simulation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">excitation_type</span> <span class="o">=</span> <span class="s1">&#39;harmonic&#39;</span>
            <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">ExcitationType</span> <span class="o">=</span> <span class="n">excitation_enum</span><span class="o">.</span><span class="n">Harmonic</span>
            <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">Frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>
            <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">CenterFrequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">edge_source_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">source_entity</span><span class="p">])</span>

        <span class="c1"># Sensor setup</span>
        <span class="n">edge_sensor_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">EdgeSensorSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">edge_sensor_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">source_entity</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
            <span class="n">far_field_sensor_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddFarFieldSensorSettings</span><span class="p">()</span>

            <span class="c1"># Configure extracted frequencies for Gaussian source</span>
            <span class="k">if</span> <span class="n">excitation_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                <span class="n">center_freq_hz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">*</span> <span class="mf">1e6</span>
                <span class="n">bandwidth_hz</span> <span class="o">=</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="mf">1e6</span>
                <span class="n">start_freq_hz</span> <span class="o">=</span> <span class="n">center_freq_hz</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth_hz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">end_freq_hz</span> <span class="o">=</span> <span class="n">center_freq_hz</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth_hz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Create a list of 21 frequencies, including the center frequency</span>
                <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">21</span>
                <span class="n">extracted_frequencies_hz</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_freq_hz</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">bandwidth_hz</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)]</span>

                <span class="n">far_field_sensor_settings</span><span class="o">.</span><span class="n">ExtractedFrequencies</span> <span class="o">=</span> <span class="n">extracted_frequencies_hz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Set extracted frequencies from </span><span class="si">{</span><span class="n">start_freq_hz</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2"> MHz to </span><span class="si">{</span><span class="n">end_freq_hz</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2"> MHz.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.setups.source_setup.SourceSetup.setup_source_and_sensors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_source_and_sensors</span><span class="p">(</span><span class="n">antenna_components</span><span class="p">)</span></code>

<a href="#src.setups.source_setup.SourceSetup.setup_source_and_sensors" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Sets up the excitation source and sensors.</p>


            <details class="quote">
              <summary>Source code in <code>src\setups\source_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_source_and_sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">antenna_components</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up the excitation source and sensors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Setting up source and sensors...&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

    <span class="n">source_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna</span><span class="o">.</span><span class="n">get_source_entity_name</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">source_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">antenna_components</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find source entity &#39;</span><span class="si">{</span><span class="n">source_name</span><span class="si">}</span><span class="s2">&#39; in antenna group.&quot;</span><span class="p">)</span>
    <span class="n">source_entity</span> <span class="o">=</span> <span class="n">antenna_components</span><span class="p">[</span><span class="n">source_name</span><span class="p">]</span>

    <span class="c1"># Source setup</span>
    <span class="n">edge_source_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">EdgeSourceSettings</span><span class="p">()</span>

    <span class="c1"># Get the enum for ExcitationType</span>
    <span class="n">excitation_enum</span> <span class="o">=</span> <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">ExcitationType</span><span class="o">.</span><span class="n">enum</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using Gaussian source for free-space simulation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">excitation_type</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
        <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">ExcitationType</span> <span class="o">=</span> <span class="n">excitation_enum</span><span class="o">.</span><span class="n">Gaussian</span>
        <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">CenterFrequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>
        <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">Bandwidth</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Using Harmonic source for phantom simulation.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">excitation_type</span> <span class="o">=</span> <span class="s1">&#39;harmonic&#39;</span>
        <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">ExcitationType</span> <span class="o">=</span> <span class="n">excitation_enum</span><span class="o">.</span><span class="n">Harmonic</span>
        <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">Frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>
        <span class="n">edge_source_settings</span><span class="o">.</span><span class="n">CenterFrequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">MHz</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">edge_source_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">source_entity</span><span class="p">])</span>

    <span class="c1"># Sensor setup</span>
    <span class="n">edge_sensor_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emfdtd</span><span class="o">.</span><span class="n">EdgeSensorSettings</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">edge_sensor_settings</span><span class="p">,</span> <span class="p">[</span><span class="n">source_entity</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_space</span><span class="p">:</span>
        <span class="n">far_field_sensor_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">AddFarFieldSensorSettings</span><span class="p">()</span>

        <span class="c1"># Configure extracted frequencies for Gaussian source</span>
        <span class="k">if</span> <span class="n">excitation_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
            <span class="n">center_freq_hz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mhz</span> <span class="o">*</span> <span class="mf">1e6</span>
            <span class="n">bandwidth_hz</span> <span class="o">=</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="mf">1e6</span>
            <span class="n">start_freq_hz</span> <span class="o">=</span> <span class="n">center_freq_hz</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth_hz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">end_freq_hz</span> <span class="o">=</span> <span class="n">center_freq_hz</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth_hz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Create a list of 21 frequencies, including the center frequency</span>
            <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">21</span>
            <span class="n">extracted_frequencies_hz</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_freq_hz</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">bandwidth_hz</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)]</span>

            <span class="n">far_field_sensor_settings</span><span class="o">.</span><span class="n">ExtractedFrequencies</span> <span class="o">=</span> <span class="n">extracted_frequencies_hz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Hz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Set extracted frequencies from </span><span class="si">{</span><span class="n">start_freq_hz</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2"> MHz to </span><span class="si">{</span><span class="n">end_freq_hz</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2"> MHz.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.simulation_runner" class="doc doc-heading">
            <code>simulation_runner</code>


<a href="#src.simulation_runner" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.simulation_runner.SimulationRunner" class="doc doc-heading">
            <code>SimulationRunner</code>


<a href="#src.simulation_runner.SimulationRunner" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LoggingMixin (src.logging_manager.LoggingMixin)" href="#src.logging_manager.LoggingMixin">LoggingMixin</a></code></p>


        <p>Manages the execution of the simulation, either through the Sim4Life API
or by calling the iSolve.exe solver manually.</p>








              <details class="quote">
                <summary>Source code in <code>src\simulation_runner.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SimulationRunner</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the execution of the simulation, either through the Sim4Life API</span>
<span class="sd">    or by calling the iSolve.exe solver manually.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">project_path</span><span class="p">,</span> <span class="n">simulations</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">study</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">project_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulations</span> <span class="o">=</span> <span class="n">simulations</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simulations</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">simulations</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">verbose_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">progress_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">gui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study</span> <span class="o">=</span> <span class="n">study</span>
        <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span>


    <span class="k">def</span> <span class="nf">run_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs all simulations in the list, managing GUI animations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_sims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulations</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Running Simulation&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">total_sims</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Running simulation </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_sims</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sim</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

            <span class="c1"># Start animation before the run</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="s2">&quot;run_simulation_total&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

            <span class="c1"># End animation and update progress after the run</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_weighted_progress</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_sims</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Running Simulation&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_sims</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- All simulations finished ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a single simulation, wrapping the entire process in a single subtask</span>
<span class="sd">        for more accurate time estimation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running simulation: </span><span class="si">{</span><span class="n">simulation</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Simulation object not found.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_simulation_total&quot;</span><span class="p">):</span>
            <span class="n">server_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_server</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s2">&quot;WriteInputFile&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_write_input_file&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Writing solver input file...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
                        <span class="n">simulation</span><span class="o">.</span><span class="n">WriteInputFile</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span> <span class="c1"># Force a save to flush files</span>

                <span class="c1"># Stop here if we only want to write the input file</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_only_write_input_file</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;&#39;only_write_input_file&#39; is true, skipping simulation run.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_manual_isolve</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_run_isolve_manual</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">server_name</span> <span class="ow">and</span> <span class="n">server_name</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_run_osparc_direct</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Fallback to localhost if no server or localhost is specified</span>
                    <span class="n">simulation</span><span class="o">.</span><span class="n">RunSimulation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">server_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Simulation finished on localhost.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred during simulation run: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="c1"># Check if a cloud server was intended for the run</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_server</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_server</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;If you are running on the cloud, please ensure you are logged into Sim4Life via the GUI and your API credentials are correct.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">simulation</span>

    <span class="k">def</span> <span class="nf">_run_isolve_manual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds iSolve.exe, runs it in a non-blocking way, and logs its output in real-time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># --- 1. Setup: Find paths and prepare command ---</span>
        <span class="c1"># The input file is now written in the run() method before this is called.</span>

        <span class="n">python_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
        <span class="n">s4l_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">python_path</span><span class="p">))</span>
        <span class="n">isolve_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s4l_root</span><span class="p">,</span> <span class="s2">&quot;Solvers&quot;</span><span class="p">,</span> <span class="s2">&quot;iSolve.exe&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">isolve_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;iSolve.exe not found at the expected path: </span><span class="si">{</span><span class="n">isolve_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s1">&#39;GetInputFileName&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not get input file name from simulation object.&quot;</span><span class="p">)</span>

        <span class="n">relative_path</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">GetInputFileName</span><span class="p">()</span>
        <span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="n">input_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solver input file not found at: </span><span class="si">{</span><span class="n">input_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">solver_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_solver_settings</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kernel&#39;</span><span class="p">,</span> <span class="s1">&#39;Software&#39;</span><span class="p">)</span>
        <span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Running iSolve with </span><span class="si">{</span><span class="n">solver_kernel</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">isolve_path</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="n">input_file_path</span><span class="p">]</span>
        <span class="n">show_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_solver_settings</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_solver_output&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># --- 2. Non-blocking reader thread setup ---</span>
        <span class="k">def</span> <span class="nf">reader_thread</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Reads lines from a pipe and puts them on a queue.&quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                    <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">pipe</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_isolve_execution&quot;</span><span class="p">):</span>
                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">creationflags</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CREATE_NO_WINDOW</span><span class="p">)</span>

                <span class="n">output_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
                <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">reader_thread</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">output_queue</span><span class="p">))</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

                <span class="c1"># --- 3. Main loop: Monitor process and log output without blocking ---</span>
                <span class="k">while</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Read all available lines from the queue</span>
                        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">output_queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
                        <span class="c1"># No new output, sleep briefly to prevent a busy-wait</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

                <span class="c1"># Process has finished, get the return code</span>
                <span class="n">return_code</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span>
                <span class="c1"># Make sure the reader thread has finished and read all remaining output</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">output_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">output_queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">return_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;iSolve.exe failed with return code </span><span class="si">{</span><span class="n">return_code</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

            <span class="c1"># --- 4. Post-simulation steps ---</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_wait_for_results&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Waiting for 5 seconds to ensure results are written to disk...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                <span class="n">non_blocking_sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_reload_project&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Re-opening project to load results...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
                <span class="n">open_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>

            <span class="n">sim_name</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">simulation</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find simulation &#39;</span><span class="si">{</span><span class="n">sim_name</span><span class="si">}</span><span class="s2">&#39; after re-opening project.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Project reloaded and results are available.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred while running iSolve.exe: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_run_osparc_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">server_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a job directly to the oSPARC platform, bypassing server discovery.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">XOsparcApiClient</span>  <span class="c1"># Only available in Sim4Life v8.2.2 and later.</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Failed to import XOsparcApiClient. This module is required for direct oSPARC integration.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Please ensure you are using Sim4Life version 8.2.2 or higher.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not import XOsparcApiClient module, which is necessary for oSPARC runs.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Running simulation directly on oSPARC ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="c1"># 1. Get Credentials and Initialize Client</span>
        <span class="n">creds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_osparc_credentials</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">creds</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">,</span> <span class="s1">&#39;api_secret&#39;</span><span class="p">,</span> <span class="s1">&#39;api_server&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing oSPARC credentials in configuration.&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">XOsparcApiClient</span><span class="o">.</span><span class="n">OsparcApiClient</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">],</span>
            <span class="n">api_secret</span><span class="o">=</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;api_secret&#39;</span><span class="p">],</span>
            <span class="n">api_server</span><span class="o">=</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;api_server&#39;</span><span class="p">],</span>
            <span class="n">api_version</span><span class="o">=</span><span class="n">creds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_version&#39;</span><span class="p">,</span> <span class="s1">&#39;v0&#39;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;oSPARC client initialized.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

        <span class="c1"># 2. Prepare Job Submission Data</span>
        <span class="n">input_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">),</span> <span class="n">simulation</span><span class="o">.</span><span class="n">GetInputFileName</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solver input file not found at: </span><span class="si">{</span><span class="n">input_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">job_data</span> <span class="o">=</span> <span class="n">XOsparcApiClient</span><span class="o">.</span><span class="n">JobSubmissionData</span><span class="p">()</span>
        <span class="n">job_data</span><span class="o">.</span><span class="n">InputFilePath</span> <span class="o">=</span> <span class="n">input_file_path</span>
        <span class="n">job_data</span><span class="o">.</span><span class="n">ResourceName</span> <span class="o">=</span> <span class="n">server_name</span>
        <span class="n">job_data</span><span class="o">.</span><span class="n">SolverKey</span> <span class="o">=</span> <span class="s2">&quot;sim4life-isolve&quot;</span>
        <span class="n">job_data</span><span class="o">.</span><span class="n">SolverVersion</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># Let the API choose the default version</span>

        <span class="c1"># 3. Create and Start the Job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating job for input file: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">create_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">CreateJob</span><span class="p">(</span><span class="n">job_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">create_response</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create oSPARC job: </span><span class="si">{</span><span class="n">create_response</span><span class="o">.</span><span class="n">Content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">job_id</span> <span class="o">=</span> <span class="n">create_response</span><span class="o">.</span><span class="n">Content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;oSPARC API did not return a job ID after creation.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job created with ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">. Starting job...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="n">start_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">StartJob</span><span class="p">(</span><span class="n">job_data</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start_response</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to start oSPARC job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">start_response</span><span class="o">.</span><span class="n">Content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 4. Poll for Job Completion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Job started. Polling for status...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">status_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">GetJobStatus</span><span class="p">(</span><span class="n">job_data</span><span class="o">.</span><span class="n">SolverKey</span><span class="p">,</span> <span class="n">job_data</span><span class="o">.</span><span class="n">SolverVersion</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">status_response</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not get job status for </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">status</span> <span class="o">=</span> <span class="n">status_response</span><span class="o">.</span><span class="n">Content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Job &#39;</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&#39; status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="s2">&quot;ABORTED&quot;</span><span class="p">]:</span>
                <span class="n">log_type</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span> <span class="k">else</span> <span class="s1">&#39;error&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> finished with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="n">log_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;oSPARC job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># 5. Post-simulation steps (similar to _run_isolve_manual)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_wait_for_results&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Waiting for 5 seconds to ensure results are written to disk...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">non_blocking_sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_reload_project&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Re-opening project to load results...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
            <span class="n">open_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>

        <span class="n">sim_name</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">Name</span>
        <span class="n">simulation</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find simulation &#39;</span><span class="si">{</span><span class="n">sim_name</span><span class="si">}</span><span class="s2">&#39; after re-opening project.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Project reloaded and results are available.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.simulation_runner.SimulationRunner.run_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_all</span><span class="p">()</span></code>

<a href="#src.simulation_runner.SimulationRunner.run_all" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Runs all simulations in the list, managing GUI animations.</p>


            <details class="quote">
              <summary>Source code in <code>src\simulation_runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs all simulations in the list, managing GUI animations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_sims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulations</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Running Simulation&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">total_sims</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulations</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Running simulation </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_sims</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sim</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="c1"># Start animation before the run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="s2">&quot;run_simulation_total&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

        <span class="c1"># End animation and update progress after the run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_weighted_progress</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_sims</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Running Simulation&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_sims</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- All simulations finished ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.simulation_runner.SimulationRunner.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span></code>

<a href="#src.simulation_runner.SimulationRunner.run" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Runs a single simulation, wrapping the entire process in a single subtask
for more accurate time estimation.</p>


            <details class="quote">
              <summary>Source code in <code>src\simulation_runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a single simulation, wrapping the entire process in a single subtask</span>
<span class="sd">    for more accurate time estimation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running simulation: </span><span class="si">{</span><span class="n">simulation</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Simulation object not found.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_simulation_total&quot;</span><span class="p">):</span>
        <span class="n">server_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_server</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s2">&quot;WriteInputFile&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;run_write_input_file&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Writing solver input file...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
                    <span class="n">simulation</span><span class="o">.</span><span class="n">WriteInputFile</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span> <span class="c1"># Force a save to flush files</span>

            <span class="c1"># Stop here if we only want to write the input file</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_only_write_input_file</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;&#39;only_write_input_file&#39; is true, skipping simulation run.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_manual_isolve</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_isolve_manual</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">server_name</span> <span class="ow">and</span> <span class="n">server_name</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_osparc_direct</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">server_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Fallback to localhost if no server or localhost is specified</span>
                <span class="n">simulation</span><span class="o">.</span><span class="n">RunSimulation</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">server_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Simulation finished on localhost.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred during simulation run: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="c1"># Check if a cloud server was intended for the run</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_server</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_server</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;If you are running on the cloud, please ensure you are logged into Sim4Life via the GUI and your API credentials are correct.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">simulation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.studies" class="doc doc-heading">
            <code>studies</code>


<a href="#src.studies" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="src.studies.base_study" class="doc doc-heading">
            <code>base_study</code>


<a href="#src.studies.base_study" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.studies.base_study.BaseStudy" class="doc doc-heading">
            <code>BaseStudy</code>


<a href="#src.studies.base_study.BaseStudy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LoggingMixin (src.logging_manager.LoggingMixin)" href="#src.logging_manager.LoggingMixin">LoggingMixin</a></code></p>


        <p>Abstract base class for all studies (Near-Field, Far-Field).</p>








              <details class="quote">
                <summary>Source code in <code>src\studies\base_study.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseStudy</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for all studies (Near-Field, Far-Field).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_type</span><span class="p">,</span> <span class="n">config_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profiler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">=</span> <span class="n">study_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">gui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">config_filename</span> <span class="k">if</span> <span class="n">config_filename</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="si">}</span><span class="s2">_config.json&quot;</span><span class="p">)</span>

        <span class="c1"># Get study-specific profiling config</span>
        <span class="n">profiling_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_profiling_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">)</span>
        <span class="n">execution_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;do_setup&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;do_run&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;do_extract&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span><span class="p">(</span><span class="n">execution_control</span><span class="p">,</span> <span class="n">profiling_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">profiling_config_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_profiler</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span> <span class="o">=</span> <span class="n">ProjectManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_for_stop_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the GUI has requested a stop.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">is_stopped</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">StudyCancelledError</span><span class="p">(</span><span class="s2">&quot;Study cancelled by user.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a context manager that profiles a subtask, handling timing,</span>
<span class="sd">        GUI animations, and optional line-profiling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">profile_subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts the GUI animation for a stage.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">end_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ends the GUI animation for a stage.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main method to run the study.&quot;&quot;&quot;</span>
        <span class="n">ensure_s4l_running</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_study</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">StudyCancelledError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Study execution cancelled by user. ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- FATAL ERROR in study: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> Finished ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">save_estimates</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_profiler</span><span class="p">()</span> <span class="c1"># Send final profiler state</span>

    <span class="k">def</span> <span class="nf">_run_study</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method must be implemented by subclasses to execute the specific study.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;_run_study&#39; method must be implemented by a subclass.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_line_profiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtask_name</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the line profiler for a specific subtask if configured.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line_profiling_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_line_profiling_config</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">line_profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">subtask_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtasks&quot;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">func</span><span class="p">:</span> <span class="n">func</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Setting up line profiler for subtask: </span><span class="si">{</span><span class="n">subtask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>

        <span class="n">lp</span> <span class="o">=</span> <span class="n">LineProfiler</span><span class="p">()</span>
        <span class="n">functions_to_profile</span> <span class="o">=</span> <span class="n">line_profiling_config</span><span class="p">[</span><span class="s2">&quot;subtasks&quot;</span><span class="p">][</span><span class="n">subtask_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">func_path</span> <span class="ow">in</span> <span class="n">functions_to_profile</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module_path</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">func_name</span> <span class="o">=</span> <span class="n">func_path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Dynamically import the module and get the class</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span>
                <span class="n">class_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>

                <span class="c1"># Get the function object from the class</span>
                <span class="n">func_to_add</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">class_obj</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Adding function to profiler: </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
                <span class="n">lp</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">func_to_add</span><span class="p">)</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - WARNING: Could not find or parse function &#39;</span><span class="si">{</span><span class="n">func_path</span><span class="si">}</span><span class="s2">&#39; for line profiling. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lp</span><span class="p">,</span> <span class="n">lp</span><span class="o">.</span><span class="n">wrap_function</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="src.studies.base_study.BaseStudy.subtask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">subtask</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.studies.base_study.BaseStudy.subtask" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Returns a context manager that profiles a subtask, handling timing,
GUI animations, and optional line-profiling.</p>


            <details class="quote">
              <summary>Source code in <code>src\studies\base_study.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a context manager that profiles a subtask, handling timing,</span>
<span class="sd">    GUI animations, and optional line-profiling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">profile_subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.studies.base_study.BaseStudy.start_stage_animation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">)</span></code>

<a href="#src.studies.base_study.BaseStudy.start_stage_animation" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Starts the GUI animation for a stage.</p>


            <details class="quote">
              <summary>Source code in <code>src\studies\base_study.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts the GUI animation for a stage.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.studies.base_study.BaseStudy.end_stage_animation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_stage_animation</span><span class="p">()</span></code>

<a href="#src.studies.base_study.BaseStudy.end_stage_animation" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Ends the GUI animation for a stage.</p>


            <details class="quote">
              <summary>Source code in <code>src\studies\base_study.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">end_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ends the GUI animation for a stage.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.studies.base_study.BaseStudy.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#src.studies.base_study.BaseStudy.run" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Main method to run the study.</p>


            <details class="quote">
              <summary>Source code in <code>src\studies\base_study.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main method to run the study.&quot;&quot;&quot;</span>
    <span class="n">ensure_s4l_running</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_study</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">StudyCancelledError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;--- Study execution cancelled by user. ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- FATAL ERROR in study: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;fatal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> Finished ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">save_estimates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_profiler</span><span class="p">()</span> <span class="c1"># Send final profiler state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.studies.far_field_study" class="doc doc-heading">
            <code>far_field_study</code>


<a href="#src.studies.far_field_study" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.studies.far_field_study.FarFieldStudy" class="doc doc-heading">
            <code>FarFieldStudy</code>


<a href="#src.studies.far_field_study.FarFieldStudy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseStudy (src.studies.base_study.BaseStudy)" href="#src.studies.base_study.BaseStudy">BaseStudy</a></code></p>


        <p>Manages a far-field simulation study, including setup, execution, and results extraction.</p>








              <details class="quote">
                <summary>Source code in <code>src\studies\far_field_study.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FarFieldStudy</span><span class="p">(</span><span class="n">BaseStudy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages a far-field simulation study, including setup, execution, and results extraction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_filename</span><span class="o">=</span><span class="s2">&quot;far_field_config.json&quot;</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;far_field&#39;</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">,</span> <span class="n">gui</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_study</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the entire far-field study by iterating through each simulation case,</span>
<span class="sd">        creating a separate project for each.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Far-Field Study: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="n">do_setup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.do_setup&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">do_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.do_run&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">do_extract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.do_extract&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_setup</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_run</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_extract</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;All execution phases (setup, run, extract) are disabled in the config. Nothing to do.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_setup</span> <span class="ow">and</span> <span class="n">do_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;WARNING: Running simulations without setup is not a standard workflow and might lead to issues.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>

        <span class="n">phantoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;phantoms&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;frequencies_mhz&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">far_field_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;far_field_setup.environmental&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">incident_directions</span> <span class="o">=</span> <span class="n">far_field_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incident_directions&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">polarizations</span> <span class="o">=</span> <span class="n">far_field_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;polarizations&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">total_projects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phantoms</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="n">sims_per_project</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">incident_directions</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">polarizations</span><span class="p">)</span>
        <span class="n">total_simulations</span> <span class="o">=</span> <span class="n">total_projects</span> <span class="o">*</span> <span class="n">sims_per_project</span>

        <span class="c1"># Inform the profiler about the total number of simulations and projects for accurate ETA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">set_total_simulations</span><span class="p">(</span><span class="n">total_simulations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">set_project_scope</span><span class="p">(</span><span class="n">total_projects</span><span class="p">)</span>

        <span class="c1"># Give the profiler a hint about the first phase to avoid an initial &quot;N/A&quot; for ETA</span>
        <span class="k">if</span> <span class="n">do_setup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="s1">&#39;setup&#39;</span>
        <span class="k">elif</span> <span class="n">do_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="s1">&#39;run&#39;</span>
        <span class="k">elif</span> <span class="n">do_extract</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="s1">&#39;extract&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># Initialize GUI progress</span>

        <span class="n">current_sim_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">phantom_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phantoms</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># One phantom setup object can be reused for all frequencies</span>
                <span class="n">phantom_setup</span> <span class="o">=</span> <span class="n">PhantomSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Check for a stop signal from the GUI at the start of each major iteration.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_stop_signal</span><span class="p">()</span>

                        <span class="c1"># Create a new, clean project for each frequency to avoid performance degradation.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">create_or_open_project</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>

                        <span class="c1"># The phantom must be loaded into each new project.</span>
                        <span class="n">phantom_setup</span><span class="o">.</span><span class="n">ensure_phantom_is_loaded</span><span class="p">()</span>

                        <span class="n">project_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">set_current_project</span><span class="p">(</span><span class="n">project_index</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">completed_phases</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1"># Reset for the new project</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Processing Frequency </span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz for Phantom &#39;</span><span class="si">{</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39; ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

                        <span class="n">all_simulations</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="c1"># 1. Setup Phase</span>
                        <span class="k">if</span> <span class="n">do_setup</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;setup&quot;</span><span class="p">):</span>
                                <span class="n">total_setups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">incident_directions</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">polarizations</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Setup&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">total_setups</span><span class="p">)</span>

                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">direction_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">incident_directions</span><span class="p">):</span>
                                    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">polarization_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polarizations</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_stop_signal</span><span class="p">()</span>
                                        <span class="n">setup_index</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">polarizations</span><span class="p">)</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Setting up simulation </span><span class="si">{</span><span class="n">setup_index</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_setups</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">direction_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polarization_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

                                        <span class="n">setup</span> <span class="o">=</span> <span class="n">FarFieldSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">direction_name</span><span class="p">,</span> <span class="n">polarization_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>

                                        <span class="c1"># The context manager handles timing, GUI animations, and optional line profiling.</span>
                                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;setup_simulation&quot;</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="n">setup</span><span class="p">)</span> <span class="k">as</span> <span class="n">wrapper</span><span class="p">:</span>
                                            <span class="n">simulation</span> <span class="o">=</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">setup</span><span class="o">.</span><span class="n">run_full_setup</span><span class="p">)(</span><span class="n">phantom_setup</span><span class="p">)</span>

                                        <span class="k">if</span> <span class="n">simulation</span><span class="p">:</span>
                                            <span class="n">all_simulations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">simulation</span><span class="p">,</span> <span class="n">direction_name</span><span class="p">,</span> <span class="n">polarization_name</span><span class="p">))</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Setup failed for </span><span class="si">{</span><span class="n">direction_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polarization_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>

                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                                            <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_weighted_progress</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">,</span> <span class="n">setup_index</span> <span class="o">/</span> <span class="n">total_setups</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Setup&quot;</span><span class="p">,</span> <span class="n">setup_index</span><span class="p">,</span> <span class="n">total_setups</span><span class="p">)</span>

                                <span class="c1"># Save the project after the entire setup phase for this project is complete.</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - Saving project after setup phase...&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># If not setting up, filter simulations from the existing project based on the config</span>
                            <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
                            <span class="n">all_sims_in_doc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="p">)</span>

                            <span class="c1"># Get the desired simulation names from the config</span>
                            <span class="n">config_directions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;far_field_setup.environmental.incident_directions&#39;</span><span class="p">,</span> <span class="p">[])</span>
                            <span class="n">config_polarizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;far_field_setup.environmental.polarizations&#39;</span><span class="p">,</span> <span class="p">[])</span>

                            <span class="c1"># Reconstruct the expected simulation names from the config</span>
                            <span class="n">expected_sim_names_thelonious</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;EM_FDTD_</span><span class="si">{</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">config_directions</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">config_polarizations</span><span class="p">]</span>
                            <span class="n">expected_sim_names_thelonius</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;EM_FDTD_</span><span class="si">{</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;thelonious&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;thelonius&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">config_directions</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">config_polarizations</span><span class="p">]</span>
                            <span class="n">expected_sim_names</span> <span class="o">=</span> <span class="n">expected_sim_names_thelonious</span> <span class="o">+</span> <span class="n">expected_sim_names_thelonius</span>

                            <span class="c1"># Filter the simulations from the document</span>
                            <span class="n">sims_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim</span> <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">all_sims_in_doc</span> <span class="k">if</span> <span class="n">sim</span><span class="o">.</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">expected_sim_names</span><span class="p">]</span>

                            <span class="c1"># Recreate the all_simulations tuple structure</span>
                            <span class="n">all_simulations</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">sims_to_process</span><span class="p">:</span>
                                <span class="n">parts</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                                <span class="n">direction_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">polarization_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">all_simulations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sim</span><span class="p">,</span> <span class="n">direction_name</span><span class="p">,</span> <span class="n">polarization_name</span><span class="p">))</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_simulations</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  ERROR: No matching simulations found in the project for the current configuration. Skipping.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="c1"># 2. Run Phase</span>
                        <span class="k">if</span> <span class="n">do_run</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_stage</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">total_stages</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">all_simulations</span><span class="p">))</span>
                                <span class="n">sim_objects_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">all_simulations</span><span class="p">]</span>
                                <span class="n">runner</span> <span class="o">=</span> <span class="n">SimulationRunner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">sim_objects_only</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span> <span class="n">study</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                                <span class="n">runner</span><span class="o">.</span><span class="n">run_all</span><span class="p">()</span>
                                <span class="c1"># Manually complete the run phase after all its stages are done</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">complete_run_phase</span><span class="p">()</span>

                        <span class="c1"># 3. Extraction Phase</span>
                        <span class="k">if</span> <span class="n">do_extract</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;extract&quot;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Results&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_simulations</span><span class="p">))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">reload_project</span><span class="p">()</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_extract_results_for_project</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">all_simulations</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                                    <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_weighted_progress</span><span class="p">(</span><span class="s2">&quot;extract&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Results&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_simulations</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_simulations</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;  ERROR: An error occurred while processing frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz for phantom &#39;</span><span class="si">{</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                        <span class="c1"># Ensure the project is closed even if an error occurs within the frequency loop</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="k">continue</span> <span class="c1"># Continue to the next frequency</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="c1"># Ensure the project is closed after each frequency to release resources.</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">except</span> <span class="n">StudyCancelledError</span><span class="p">:</span>
                <span class="c1"># This is not an error, but a signal to stop. Re-raise it to be caught by the outer loop.</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ERROR: An error occurred while processing phantom &#39;</span><span class="si">{</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_results_for_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">simulations_to_extract</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts results for a given list of simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simulations_to_extract</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;  - No matching simulations to extract based on the current configuration.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Extracting results for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">simulations_to_extract</span><span class="p">)</span><span class="si">}</span><span class="s2"> simulation(s) matching the configuration.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sim</span><span class="p">,</span> <span class="n">direction_name</span><span class="p">,</span> <span class="n">polarization_name</span> <span class="ow">in</span> <span class="n">simulations_to_extract</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_stop_signal</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">placement_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;environmental_</span><span class="si">{</span><span class="n">direction_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polarization_name</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Extracting from simulation: </span><span class="si">{</span><span class="n">sim</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
                <span class="n">extractor</span> <span class="o">=</span> <span class="n">ResultsExtractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="s1">&#39;far_field&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span> <span class="n">study</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">extractor</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - ERROR: Failed to extract results for simulation &#39;</span><span class="si">{</span><span class="n">sim</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="src.studies.near_field_study" class="doc doc-heading">
            <code>near_field_study</code>


<a href="#src.studies.near_field_study" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="src.studies.near_field_study.NearFieldStudy" class="doc doc-heading">
            <code>NearFieldStudy</code>


<a href="#src.studies.near_field_study.NearFieldStudy" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseStudy (src.studies.base_study.BaseStudy)" href="#src.studies.base_study.BaseStudy">BaseStudy</a></code></p>


        <p>Manages and runs a full near-field simulation campaign.</p>








              <details class="quote">
                <summary>Source code in <code>src\studies\near_field_study.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NearFieldStudy</span><span class="p">(</span><span class="n">BaseStudy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages and runs a full near-field simulation campaign.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_filename</span><span class="o">=</span><span class="s2">&quot;near_field_config.json&quot;</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;near_field&#39;</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">,</span> <span class="n">gui</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_study</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the entire simulation campaign based on the configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Near-Field Study: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;study_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="n">do_setup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.do_setup&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">do_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.do_run&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">do_extract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;execution_control.do_extract&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_setup</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_run</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_extract</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;All execution phases (setup, run, extract) are disabled. Nothing to do.&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">phantoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;phantoms&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phantoms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">phantoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">phantoms</span><span class="p">]</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;antenna_config&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">all_scenarios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s1">&#39;placement_scenarios&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Calculate total number of simulations for the profiler</span>
        <span class="n">total_simulations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">phantom_name</span> <span class="ow">in</span> <span class="n">phantoms</span><span class="p">:</span>
            <span class="n">placements_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_phantom_placements</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">placements_config</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">scenario_details</span> <span class="ow">in</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;do_</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">positions</span> <span class="o">=</span> <span class="n">scenario_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;positions&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">orientations</span> <span class="o">=</span> <span class="n">scenario_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;orientations&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">total_simulations</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">orientations</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">set_total_simulations</span><span class="p">(</span><span class="n">total_simulations</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">simulation_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">phantom_name</span> <span class="ow">in</span> <span class="n">phantoms</span><span class="p">:</span>
            <span class="n">placements_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_phantom_placements</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">placements_config</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">enabled_placements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">scenario_details</span> <span class="ow">in</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">placements_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;do_</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">positions</span> <span class="o">=</span> <span class="n">scenario_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;positions&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">orientations</span> <span class="o">=</span> <span class="n">scenario_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;orientations&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="k">for</span> <span class="n">pos_name</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">orient_name</span> <span class="ow">in</span> <span class="n">orientations</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">enabled_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">pos_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">orient_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">freq_str</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_stop_signal</span><span class="p">()</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq_str</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">placement_name</span> <span class="ow">in</span> <span class="n">enabled_placements</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_stop_signal</span><span class="p">()</span>
                    <span class="n">simulation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Processing Simulation </span><span class="si">{</span><span class="n">simulation_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_simulations</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz, </span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_run_placement</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">do_setup</span><span class="p">,</span> <span class="n">do_run</span><span class="p">,</span> <span class="n">do_extract</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_placement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">do_setup</span><span class="p">,</span> <span class="n">do_run</span><span class="p">,</span> <span class="n">do_extract</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a full placement scenario, which may include multiple positions and orientations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">simulation</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># 1. Setup Simulation</span>
            <span class="k">if</span> <span class="n">do_setup</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;setup&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Setup&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">antenna</span> <span class="o">=</span> <span class="n">Antenna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
                    <span class="n">setup</span> <span class="o">=</span> <span class="n">NearFieldSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">)</span>

                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="s2">&quot;setup_simulation&quot;</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="n">setup</span><span class="p">)</span> <span class="k">as</span> <span class="n">wrapper</span><span class="p">:</span>
                        <span class="n">simulation</span> <span class="o">=</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">setup</span><span class="o">.</span><span class="n">run_full_setup</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Setup failed for </span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">. Cannot proceed.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1"># The first save is now critical after setup is complete.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                        <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_weighted_progress</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Setup&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">create_or_open_project</span><span class="p">(</span><span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">)</span>

            <span class="c1"># ALWAYS get a fresh simulation handle from the document before run/extract</span>
            <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
            <span class="k">if</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span><span class="p">:</span>
                <span class="c1"># First, try to find the simulation with the correct &quot;thelonious&quot; name.</span>
                <span class="n">sim_name_correct</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EM_FDTD_</span><span class="si">{</span><span class="n">phantom_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">simulation</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_name_correct</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># If not found, check for the old &quot;thelonius&quot; name.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
                    <span class="n">sim_name_old</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EM_FDTD_</span><span class="si">{</span><span class="n">phantom_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;thelonious&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;thelonius&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">MHz_</span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">simulation</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_name_old</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">simulation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: No simulation found or created for </span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">. Cannot proceed.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># 2. Run Simulation</span>
            <span class="k">if</span> <span class="n">do_run</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_stage</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">total_stages</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">runner</span> <span class="o">=</span> <span class="n">SimulationRunner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="p">[</span><span class="n">simulation</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="n">runner</span><span class="o">.</span><span class="n">run_all</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">complete_run_phase</span><span class="p">()</span>

            <span class="c1"># 3. Extract Results</span>
            <span class="k">if</span> <span class="n">do_extract</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;extract&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Results&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">reload_project</span><span class="p">()</span>

                    <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
                    <span class="n">sim_name</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">Name</span>
                    <span class="n">reloaded_simulation</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="c1"># If not found, check for the old &quot;thelonius&quot; name.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">reloaded_simulation</span><span class="p">:</span>
                        <span class="n">sim_name_old</span> <span class="o">=</span> <span class="n">sim_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;thelonious&#39;</span><span class="p">,</span> <span class="s1">&#39;thelonius&#39;</span><span class="p">)</span>
                        <span class="n">reloaded_simulation</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">AllSimulations</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">sim_name_old</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">reloaded_simulation</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find simulation &#39;</span><span class="si">{</span><span class="n">sim_name</span><span class="si">}</span><span class="s2">&#39; (or &#39;</span><span class="si">{</span><span class="n">sim_name_old</span><span class="si">}</span><span class="s2">&#39;) after reloading project.&quot;</span><span class="p">)</span>

                    <span class="n">extractor</span> <span class="o">=</span> <span class="n">ResultsExtractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">reloaded_simulation</span><span class="p">,</span> <span class="n">phantom_name</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">placement_name</span><span class="p">,</span> <span class="s1">&#39;near_field&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_logger</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span> <span class="n">study</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">extractor</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
                        <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_weighted_progress</span><span class="p">(</span><span class="s2">&quot;extract&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">progress</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="s2">&quot;Extracting Results&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: An error occurred during placement &#39;</span><span class="si">{</span><span class="n">placement_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;IsOpen&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">IsOpen</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="src.utils" class="doc doc-heading">
            <code>utils</code>


<a href="#src.utils" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="src.utils.StudyCancelledError" class="doc doc-heading">
            <code>StudyCancelledError</code>


<a href="#src.utils.StudyCancelledError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Custom exception to indicate that the study was cancelled by the user.</p>








              <details class="quote">
                <summary>Source code in <code>src\utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">StudyCancelledError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom exception to indicate that the study was cancelled by the user.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.utils.Profiler" class="doc doc-heading">
            <code>Profiler</code>


<a href="#src.utils.Profiler" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A simple profiler to track execution time and estimate remaining time for a series of runs.</p>








              <details class="quote">
                <summary>Source code in <code>src\utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Profiler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple profiler to track execution time and estimate remaining time for a series of runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">study_type</span><span class="o">=</span><span class="s1">&#39;sensitivity_analysis&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="o">=</span> <span class="n">study_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the profiling configuration for the specific study type.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">full_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">full_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;average_run_time&quot;</span><span class="p">:</span> <span class="mf">60.0</span><span class="p">}</span> <span class="c1"># Default value</span>

    <span class="k">def</span> <span class="nf">start_study</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_runs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts a new study, resetting counters.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">=</span> <span class="n">total_runs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marks the beginning of a single run.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">end_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marks the end of a single run and records its duration.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_average_run_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the average run time, prioritizing measured times over historical estimates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;average_run_time&quot;</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimates the time remaining for the entire study.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">avg_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_run_time</span><span class="p">()</span>
        <span class="n">remaining_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span>
        <span class="k">return</span> <span class="n">remaining_runs</span> <span class="o">*</span> <span class="n">avg_time</span>

    <span class="k">def</span> <span class="nf">save_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the new average run time to the configuration file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">:</span>
            <span class="k">return</span> <span class="c1"># Nothing to save</span>

        <span class="n">new_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_run_time</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">full_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
            <span class="n">full_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_config</span><span class="p">:</span>
            <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">][</span><span class="s1">&#39;average_run_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_avg</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">full_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_elapsed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A context manager to time a subtask.&quot;&quot;&quot;</span>
        <span class="c1"># This is a simplified version for the simple profiler, it does not need a stack.</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="c1"># We can just log the subtask time for now.</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subtask &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;verbose&#39;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.start_study" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_study</span><span class="p">(</span><span class="n">total_runs</span><span class="p">)</span></code>

<a href="#src.utils.Profiler.start_study" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Starts a new study, resetting counters.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_study</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_runs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts a new study, resetting counters.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">=</span> <span class="n">total_runs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.start_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_run</span><span class="p">()</span></code>

<a href="#src.utils.Profiler.start_run" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Marks the beginning of a single run.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Marks the beginning of a single run.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.end_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_run</span><span class="p">()</span></code>

<a href="#src.utils.Profiler.end_run" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Marks the end of a single run and records its duration.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">end_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Marks the end of a single run and records its duration.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_run_start_time</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.get_average_run_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_run_time</span><span class="p">()</span></code>

<a href="#src.utils.Profiler.get_average_run_time" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Gets the average run time, prioritizing measured times over historical estimates.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_average_run_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the average run time, prioritizing measured times over historical estimates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;average_run_time&quot;</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.get_time_remaining" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_time_remaining</span><span class="p">()</span></code>

<a href="#src.utils.Profiler.get_time_remaining" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Estimates the time remaining for the entire study.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimates the time remaining for the entire study.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">avg_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_run_time</span><span class="p">()</span>
    <span class="n">remaining_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_runs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">completed_runs</span>
    <span class="k">return</span> <span class="n">remaining_runs</span> <span class="o">*</span> <span class="n">avg_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.save_estimates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_estimates</span><span class="p">()</span></code>

<a href="#src.utils.Profiler.save_estimates" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Saves the new average run time to the configuration file.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves the new average run time to the configuration file.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_times</span><span class="p">:</span>
        <span class="k">return</span> <span class="c1"># Nothing to save</span>

    <span class="n">new_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_run_time</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">full_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
        <span class="n">full_config</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_config</span><span class="p">:</span>
        <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">full_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">][</span><span class="s1">&#39;average_run_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_avg</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">full_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="src.utils.Profiler.subtask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">subtask</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#src.utils.Profiler.subtask" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>A context manager to time a subtask.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager to time a subtask.&quot;&quot;&quot;</span>
    <span class="c1"># This is a simplified version for the simple profiler, it does not need a stack.</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="c1"># We can just log the subtask time for now.</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subtask &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;verbose&#39;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="src.utils.format_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span></code>

<a href="#src.utils.format_time" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Formats seconds into a human-readable string (e.g., 1m 23s).</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Formats seconds into a human-readable string (e.g., 1m 23s).&quot;&quot;&quot;</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">seconds</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
    <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">minutes</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
    <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">h </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.non_blocking_sleep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">non_blocking_sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span></code>

<a href="#src.utils.non_blocking_sleep" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>A non-blocking sleep that processes GUI events.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">non_blocking_sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A non-blocking sleep that processes GUI events.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">PySide6.QtCore</span> <span class="kn">import</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QTime</span><span class="p">,</span> <span class="n">QEventLoop</span>

    <span class="n">end_time</span> <span class="o">=</span> <span class="n">QTime</span><span class="o">.</span><span class="n">currentTime</span><span class="p">()</span><span class="o">.</span><span class="n">addSecs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">))</span>
    <span class="k">while</span> <span class="n">QTime</span><span class="o">.</span><span class="n">currentTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">(</span><span class="n">QEventLoop</span><span class="o">.</span><span class="n">AllEvents</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">profile</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">phase_name</span><span class="p">)</span></code>

<a href="#src.utils.profile" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>A context manager to profile a block of code (a 'phase').</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">phase_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A context manager to profile a block of code (a &#39;phase&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The &#39;run&#39; phase is further divided into stages (simulations), so we don&#39;t start a master stage for it.</span>
    <span class="k">if</span> <span class="n">phase_name</span> <span class="o">!=</span> <span class="s1">&#39;run&#39;</span><span class="p">:</span>
        <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_stage</span><span class="p">(</span><span class="n">phase_name</span><span class="p">)</span>
        <span class="c1"># Send the updated profiler to the GUI immediately so it knows the phase has started.</span>
        <span class="k">if</span> <span class="n">study</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="n">study</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_profiler</span><span class="p">()</span>

    <span class="n">study</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting: </span><span class="si">{</span><span class="n">phase_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">study</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Finished: </span><span class="si">{</span><span class="n">phase_name</span><span class="si">}</span><span class="s2"> (took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s) ---&quot;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>

        <span class="c1"># For &#39;setup&#39; and &#39;extract&#39;, ending the stage means ending the phase.</span>
        <span class="c1"># For &#39;run&#39;, the phase is completed manually after the simulation loop.</span>
        <span class="k">if</span> <span class="n">phase_name</span> <span class="o">!=</span> <span class="s1">&#39;run&#39;</span><span class="p">:</span>
            <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">end_stage</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This ensures the &#39;run&#39; phase duration is recorded correctly</span>
            <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">complete_run_phase</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">study</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="n">study</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">update_profiler</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.profile_subtask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">profile_subtask</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.utils.profile_subtask" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>A comprehensive context manager for a 'subtask'. It handles:
- High-level timing via study.profiler.
- GUI stage animation.
- Optional, detailed line-by-line profiling if configured.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">profile_subtask</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A comprehensive context manager for a &#39;subtask&#39;. It handles:</span>
<span class="sd">    - High-level timing via study.profiler.</span>
<span class="sd">    - GUI stage animation.</span>
<span class="sd">    - Optional, detailed line-by-line profiling if configured.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">study</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">subtask_stack</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">task_name</span><span class="p">,</span> <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()})</span>

    <span class="n">lp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">wrapper</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Check if line profiling is enabled for this specific subtask</span>
    <span class="n">line_profiling_config</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_line_profiling_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">instance_to_profile</span> <span class="ow">and</span>
        <span class="n">line_profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">task_name</span> <span class="ow">in</span> <span class="n">line_profiling_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtasks&quot;</span><span class="p">,</span> <span class="p">{})):</span>

        <span class="n">study</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Activating line profiler for subtask: </span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="n">lp</span><span class="p">,</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">_setup_line_profiler</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">instance_to_profile</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># If line profiler is active, yield its wrapper. Otherwise, yield a dummy function.</span>
        <span class="k">if</span> <span class="n">lp</span> <span class="ow">and</span> <span class="n">wrapper</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">wrapper</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="k">lambda</span> <span class="n">func</span><span class="p">:</span> <span class="n">func</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">subtask</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">subtask_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">subtask</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
        <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">subtask_times</span><span class="p">[</span><span class="n">subtask</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">study</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Subtask &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; done in </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>

        <span class="c1"># Update and save estimates after each subtask</span>
        <span class="n">study</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">update_and_save_estimates</span><span class="p">()</span>

        <span class="c1"># If the line profiler was active, print its stats</span>
        <span class="k">if</span> <span class="n">lp</span><span class="p">:</span>
            <span class="n">study</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Line profiler stats for &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">log_type</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">lp</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="n">study</span><span class="o">.</span><span class="n">verbose_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

        <span class="n">study</span><span class="o">.</span><span class="n">end_stage_animation</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.ensure_s4l_running" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_s4l_running</span><span class="p">()</span></code>

<a href="#src.utils.ensure_s4l_running" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Ensures that the Sim4Life application is running.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_s4l_running</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures that the Sim4Life application is running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">s4l_v1._api</span> <span class="kn">import</span> <span class="n">application</span>

    <span class="k">if</span> <span class="n">application</span><span class="o">.</span><span class="n">get_app_safe</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Sim4Life application...&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;info&#39;</span><span class="p">})</span>
        <span class="n">application</span><span class="o">.</span><span class="n">run_application</span><span class="p">(</span><span class="n">disable_ui_plugins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sim4Life application started.&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.open_project" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_project</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span></code>

<a href="#src.utils.open_project" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Opens a Sim4Life project or creates a new one in memory.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open_project</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens a Sim4Life project or creates a new one in memory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">s4l_v1.document</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found at </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">, creating a new one.&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
        <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opening project: </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;info&#39;</span><span class="p">})</span>
        <span class="n">s4l_v1</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.delete_project_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_project_file</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span></code>

<a href="#src.utils.delete_project_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Deletes the project file if it exists.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_project_file</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes the project file if it exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting existing project file: </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;log_type&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">})</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.utils.suppress_stdout_stderr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">suppress_stdout_stderr</span><span class="p">()</span></code>

<a href="#src.utils.suppress_stdout_stderr" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>A context manager that redirects stdout and stderr to devnull.</p>


            <details class="quote">
              <summary>Source code in <code>src\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">suppress_stdout_stderr</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager that redirects stdout and stderr to devnull.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fnull</span><span class="p">:</span>
        <span class="n">saved_stdout</span><span class="p">,</span> <span class="n">saved_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">fnull</span><span class="p">,</span> <span class="n">fnull</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">saved_stdout</span><span class="p">,</span> <span class="n">saved_stderr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>