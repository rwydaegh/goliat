
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../COLORING_RULES/">
      
      
        <link rel="next" href="../api/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Legacy GUI/Profiling/Logger - GOLIAT Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#codebase-features-a-comprehensive-deep-dive" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GOLIAT Documentation" class="md-header__button md-logo" aria-label="GOLIAT Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GOLIAT Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Legacy GUI/Profiling/Logger
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../architecture_overview/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../COLORING_RULES/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../api/" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../uml/" class="md-tabs__link">
        
  
  
    
  
  UML Diagram

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GOLIAT Documentation" class="md-nav__button md-logo" aria-label="GOLIAT Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GOLIAT Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../COLORING_RULES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coloring rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Legacy GUI/Profiling/Logger
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Legacy GUI/Profiling/Logger
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-high-level-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      1. High-Level Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-gui-gui_managerpy" class="md-nav__link">
    <span class="md-ellipsis">
      2. GUI (gui_manager.py)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. GUI (gui_manager.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Message Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-animation-system-a-closer-look" class="md-nav__link">
    <span class="md-ellipsis">
      The Animation System: A Closer Look
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-logging-logging_managerpy" class="md-nav__link">
    <span class="md-ellipsis">
      3. Logging (logging_manager.py)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Logging (logging_manager.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loggers" class="md-nav__link">
    <span class="md-ellipsis">
      Loggers:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-profiling-and-timing-utilspy-profiling_configjson" class="md-nav__link">
    <span class="md-ellipsis">
      4. Profiling and Timing (utils.py, profiling_config.json)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Profiling and Timing (utils.py, profiling_config.json)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-configuration-configpy" class="md-nav__link">
    <span class="md-ellipsis">
      5. Configuration (config.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-project-management" class="md-nav__link">
    <span class="md-ellipsis">
      6. Project Management
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../uml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UML Diagram
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="codebase-features-a-comprehensive-deep-dive">Codebase Features: A Comprehensive Deep-Dive<a class="headerlink" href="#codebase-features-a-comprehensive-deep-dive" title="Permanent link">&para;</a></h1>
<p>This document details the architecture and workflow of the key operational features of the codebase, focusing on the graphical user interface (GUI), logging, session management, and the profiling/timing system.</p>
<h2 id="1-high-level-workflow">1. High-Level Workflow<a class="headerlink" href="#1-high-level-workflow" title="Permanent link">&para;</a></h2>
<p>The application is designed to run scientific studies (e.g., Near-Field, Far-Field) which can be time-consuming. To provide user feedback and manage complexity, the system employs a multi-process architecture.</p>
<ol>
<li><strong>Main Process</strong>: A lightweight PySide6 GUI (<code>ProgressGUI</code>) is launched. This GUI is responsible for displaying progress, logs, and timing information.</li>
<li><strong>Study Process</strong>: The actual study (<code>NearFieldStudy</code> or <code>FarFieldStudy</code>) is executed in a separate process using Python's <code>multiprocessing</code> module. This prevents the GUI from freezing during intensive calculations.</li>
<li><strong>Communication</strong>: The study process communicates with the GUI process through a <code>multiprocessing.Queue</code>. It sends messages containing status updates, progress information, and timing data.</li>
</ol>
<p>The entry point for the study process is the <code>study_process_wrapper</code> function, which sets up a special <code>QueueGUI</code> object. This object mimics the real GUI's interface but directs all its output to the shared queue.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># from src/gui_manager.py</span>
<span class="k">def</span> <span class="nf">study_process_wrapper</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">study_type</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">session_timestamp</span><span class="p">,</span> <span class="n">execution_control</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function runs in a separate process and executes the study.</span>
<span class="sd">    It communicates with the main GUI process via a queue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ... setup ...</span>
    <span class="k">class</span> <span class="nc">QueueGUI</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;progress&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>

        <span class="k">def</span> <span class="nf">update_overall_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;overall_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="n">current_step</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_steps</span><span class="p">})</span>
        <span class="c1"># ... other methods ...</span>

    <span class="k">if</span> <span class="n">study_type</span> <span class="o">==</span> <span class="s1">&#39;near_field&#39;</span><span class="p">:</span>
        <span class="n">study</span> <span class="o">=</span> <span class="n">NearFieldStudy</span><span class="p">(</span><span class="n">config_filename</span><span class="o">=</span><span class="n">config_filename</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="n">QueueGUI</span><span class="p">(</span><span class="n">queue</span><span class="p">))</span>
    <span class="c1"># ...</span>
    <span class="n">study</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;finished&#39;</span><span class="p">})</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>graph TD
    A[Main Process: ProgressGUI] -- Spawns --&gt; B[Study Process: study_process_wrapper];
    B -- Instantiates --&gt; Study[NearFieldStudy/FarFieldStudy];
    Study -- Uses --&gt; QueueGUI[QueueGUI object];
    QueueGUI -- Puts messages --&gt; C{multiprocessing.Queue};
    C -- Polled by QTimer --&gt; A;
    A -- Updates UI --&gt; D[User];
</code></pre></div>
<h2 id="2-gui-gui_managerpy">2. GUI (<code>gui_manager.py</code>)<a class="headerlink" href="#2-gui-gui_managerpy" title="Permanent link">&para;</a></h2>
<p>The GUI provides a real-time view of the study's progress. It runs in the main process and is designed to be responsive, even while the heavy computation happens elsewhere.</p>
<h3 id="message-processing">Message Processing<a class="headerlink" href="#message-processing" title="Permanent link">&para;</a></h3>
<p>The <code>ProgressGUI</code> uses a <code>QTimer</code> that fires every 100ms, calling the <code>process_queue</code> method. This method drains the queue of any pending messages from the study process and updates the UI accordingly.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># from src/gui_manager.py</span>
<span class="k">class</span> <span class="nc">ProgressGUI</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">process_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
                <span class="n">msg_type</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;overall_progress&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_overall_progress</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;stage_progress&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_stage_progress</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;start_animation&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;estimate&#39;</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;end_value&#39;</span><span class="p">])</span>
                <span class="c1"># ... other message types ...</span>
            <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
                <span class="k">break</span>
</code></pre></div>
<h3 id="the-animation-system-a-closer-look">The Animation System: A Closer Look<a class="headerlink" href="#the-animation-system-a-closer-look" title="Permanent link">&para;</a></h3>
<p>A key feature for user experience is the smooth animation of the stage progress bar. This is used for tasks where the simulation software doesn't provide real-time progress feedback, but we have a historical estimate of how long it should take.</p>
<p><strong>How it works:</strong></p>
<ol>
<li>
<p><strong>Initiation</strong>: The study process, before starting a long-running subtask (like <code>run_simulation_total</code>), gets an estimated duration from the <code>Profiler</code>. It then sends a <code>start_animation</code> message to the GUI, containing this estimated duration.
    <div class="highlight"><pre><span></span><code><span class="c1"># from src/studies/far_field_study.py (conceptual)</span>
<span class="k">def</span> <span class="nf">run_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
        <span class="c1"># Tell the GUI to start an animation for the next step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">start_stage_animation</span><span class="p">(</span><span class="s2">&quot;run_simulation_total&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simulation_runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
</code></pre></div>
    The <code>QueueGUI</code> object in the study process gets the estimate from its profiler instance and puts the message on the queue.
    <div class="highlight"><pre><span></span><code><span class="c1"># from src/gui_manager.py</span>
<span class="k">class</span> <span class="nc">QueueGUI</span><span class="p">:</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">end_value</span><span class="p">):</span>
        <span class="n">estimate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">get_subtask_estimate</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;start_animation&#39;</span><span class="p">,</span> <span class="s1">&#39;estimate&#39;</span><span class="p">:</span> <span class="n">estimate</span><span class="p">,</span> <span class="s1">&#39;end_value&#39;</span><span class="p">:</span> <span class="n">end_value</span><span class="p">})</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Animation Setup</strong>: When the <code>ProgressGUI</code> receives the <code>start_animation</code> message, it sets up the animation parameters. It records the <code>start_time</code>, the <code>duration</code> (from the profiler's estimate), the progress bar's <code>start_value</code>, and the <code>end_value</code> it needs to reach.
    <div class="highlight"><pre><span></span><code><span class="c1"># from src/gui_manager.py</span>
<span class="k">def</span> <span class="nf">start_stage_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimated_duration</span><span class="p">,</span> <span class="n">end_step</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span> <span class="o">=</span> <span class="n">estimated_duration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="c1"># ... calculate animation_end_value based on end_step ...</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">animation_active</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="c1"># Start the animation timer (50ms interval)</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Frame-by-Frame Update</strong>: A dedicated <code>QTimer</code> (<code>animation_timer</code>) calls the <code>update_animation</code> method every 50ms. This method calculates how much time has passed since the animation started, determines the corresponding progress percentage, and updates the progress bar's value. This creates the smooth visual effect.
    <div class="highlight"><pre><span></span><code><span class="c1"># from src/gui_manager.py</span>
<span class="k">def</span> <span class="nf">update_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_active</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_time</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">progress_ratio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">elapsed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_duration</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">progress_ratio</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">value_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span>
    <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_start_value</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_range</span> <span class="o">*</span> <span class="n">progress_ratio</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stage_progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Termination</strong>: Once the actual task is complete in the study process, it sends an <code>end_animation</code> message. This stops the animation timer and sets the progress bar to its final, accurate value, correcting for any deviation between the estimate and the actual time taken.</p>
</li>
</ol>
<h2 id="3-logging-logging_managerpy">3. Logging (<code>logging_manager.py</code>)<a class="headerlink" href="#3-logging-logging_managerpy" title="Permanent link">&para;</a></h2>
<p>The system uses Python's standard <code>logging</code> module, configured to provide two distinct streams of information.</p>
<h3 id="loggers">Loggers:<a class="headerlink" href="#loggers" title="Permanent link">&para;</a></h3>
<ol>
<li><strong><code>progress</code> logger</strong>: For high-level, user-facing messages. These are shown in the GUI and saved to <code>*.progress.log</code>.</li>
<li><strong><code>verbose</code> logger</strong>: For detailed, internal messages. These are saved to the main <code>*.log</code> file.</li>
</ol>
<h3 id="implementation-details">Implementation Details:<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Log Rotation</strong>: The <code>setup_loggers</code> function checks the number of log files in the <code>logs</code> directory. If it exceeds a limit (10 pairs), it deletes the oldest pair (<code>.log</code> and <code>.progress.log</code>) to prevent the directory from growing indefinitely.</li>
<li><strong>Handler Configuration</strong>: The function creates file handlers and stream (console) handlers for each logger, ensuring messages go to the right places. <code>propagate = False</code> is used to prevent messages from being handled by parent loggers, avoiding duplicate output.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># from src/logging_manager.py</span>
<span class="k">def</span> <span class="nf">setup_loggers</span><span class="p">(</span><span class="n">session_timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># ... log rotation logic ...</span>

    <span class="n">progress_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="c1"># Remove existing handlers to prevent duplicates</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">progress_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">progress_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># File handler for progress file</span>
    <span class="n">progress_file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">progress_log_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">progress_file_handler</span><span class="p">)</span>

    <span class="c1"># Stream handler for progress (console output)</span>
    <span class="n">progress_stream_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">progress_stream_handler</span><span class="p">)</span>
    <span class="n">progress_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ... similar setup for verbose_logger ...</span>
    <span class="k">return</span> <span class="n">progress_logger</span><span class="p">,</span> <span class="n">verbose_logger</span><span class="p">,</span> <span class="n">session_timestamp</span>
</code></pre></div>
<h2 id="4-profiling-and-timing-utilspy-profiling_configjson">4. Profiling and Timing (<code>utils.py</code>, <code>profiling_config.json</code>)<a class="headerlink" href="#4-profiling-and-timing-utilspy-profiling_configjson" title="Permanent link">&para;</a></h2>
<p>The <code>Profiler</code> class is the engine for the timing and progress estimation system.</p>
<h3 id="key-concepts">Key Concepts:<a class="headerlink" href="#key-concepts" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Phases and Weights</strong>: A study is divided into phases (<code>setup</code>, <code>run</code>, <code>extract</code>). <code>profiling_config.json</code> assigns a "weight" to each, representing its contribution to the total time.
    <div class="highlight"><pre><span></span><code><span class="c1">// from configs/profiling_config.json</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;phase_weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;setup&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.299</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;run&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.596</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;extract&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.105</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;subtask_estimates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;setup_simulation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">48.16</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;run_simulation_total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">107.54</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;extract_sar_statistics&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.09</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
<li><strong>Dynamic Weights</strong>: The profiler normalizes these weights based on which phases are active (controlled by <code>execution_control</code> in the config). If a user chooses to only run the <code>extract</code> phase, its weight becomes 1.0, and the progress for that phase represents 100% of the total work.</li>
<li><strong>Weighted Progress</strong>: The <code>get_weighted_progress</code> method provides a more accurate overall progress.
    <div class="highlight"><pre><span></span><code><span class="c1"># from src/utils.py</span>
<span class="k">def</span> <span class="nf">get_weighted_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_name</span><span class="p">,</span> <span class="n">phase_progress</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the overall progress based on phase weights.&quot;&quot;&quot;</span>
    <span class="n">total_progress</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">phase_name</span><span class="p">:</span>
            <span class="n">total_progress</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">phase_progress</span> <span class="c1"># Add partial progress of current phase</span>
        <span class="k">elif</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">completed_phases</span><span class="p">:</span>
            <span class="n">total_progress</span> <span class="o">+=</span> <span class="n">weight</span> <span class="c1"># Add full weight of completed phases</span>
    <span class="k">return</span> <span class="n">total_progress</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></li>
<li><strong>Time Estimation (ETA)</strong>: The <code>get_time_remaining</code> method is adaptive. Initially, it relies on the <code>subtask_estimates</code>. Once one or more stages have completed, it switches to a more accurate method based on the actual average time taken per stage.</li>
<li><strong>Self-Improving Estimates</strong>: After a run, <code>save_estimates</code> calculates the average time for each timed subtask and writes these new averages back to <code>profiling_config.json</code>. This makes future estimates more accurate.</li>
</ul>
<h2 id="5-configuration-configpy">5. Configuration (<code>config.py</code>)<a class="headerlink" href="#5-configuration-configpy" title="Permanent link">&para;</a></h2>
<p>The <code>Config</code> class uses a powerful inheritance mechanism to avoid duplicating settings.</p>
<ul>
<li>
<p><strong>Inheritance</strong>: A config can "extend" a base config. The <code>_load_config_with_inheritance</code> method recursively loads the base config and merges it with the child config. The child's values override the parent's.</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># from src/config.py</span>
<span class="k">def</span> <span class="nf">_load_config_with_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;extends&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">base_config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_config_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;extends&quot;</span><span class="p">])</span>
        <span class="n">base_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config_with_inheritance</span><span class="p">(</span><span class="n">base_config_path</span><span class="p">)</span>

        <span class="c1"># Merge the base configuration into the current one</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">deep_merge</span><span class="p">(</span><span class="n">base_config</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span>
</code></pre></div>
For example, <code>near_field_config.json</code> might only specify the settings that differ from the main <code>base_config.json</code>.</p>
</li>
</ul>
<h2 id="6-project-management">6. Project Management<a class="headerlink" href="#6-project-management" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><code>project_manager.py</code></strong>: This class is critical for reliability. The underlying <code>.smash</code> project files can become corrupted or locked. The <code>_is_valid_smash_file</code> method is a key defensive measure. It first attempts to rename the file to itself (a trick to check for file locks on Windows) and then uses <code>h5py</code> to ensure the file is a valid HDF5 container before attempting to open it in the simulation software. This prevents the application from crashing on a corrupted file.</li>
</ul>
<p>This integrated system of GUI, logging, profiling, and configuration management provides a robust and user-friendly framework for running complex scientific simulations.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>